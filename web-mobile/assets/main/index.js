System.register("chunks:///_virtual/AnimationConfig.ts",["cc"],(function(n){var e;return{setters:[function(n){e=n.cclegacy}],execute:function(){e._RF.push({},"07bc63vq1FLKout9v/5AOPu","AnimationConfig",void 0);var i=n("ANIMATION_PROFILES",{normal:{name:"normal",description:"Standard gameplay animation speed and feel.",reelConfigs:[{reelIndex:0,spinSpeed:5e3,spinDuration:2,accelerationDuration:.5,decelerationDuration:.5,delayReel:0,anticipationDistance:200,bounceIntensity:.2,bounceDuration:.2},{reelIndex:1,spinSpeed:5e3,spinDuration:2,accelerationDuration:.5,decelerationDuration:.5,delayReel:.1,anticipationDistance:200,bounceIntensity:.2,bounceDuration:.2},{reelIndex:2,spinSpeed:5e3,spinDuration:2,accelerationDuration:.5,decelerationDuration:.5,delayReel:.3,anticipationDistance:200,bounceIntensity:.2,bounceDuration:.2}],ui:{winAnimationDuration:.3,autoSpinDelay:1e3,buttonFeedbackDuration:.5,popupAnimationDuration:.25,transitionDuration:.2}},autoSpin:{name:"autoSpin",description:"Faster animations for auto-spin or turbo mode.",reelConfigs:[{reelIndex:0,spinSpeed:8e3,spinDuration:1,accelerationDuration:.25,decelerationDuration:.25,delayReel:0,anticipationDistance:150,bounceIntensity:.15,bounceDuration:.15},{reelIndex:1,spinSpeed:8e3,spinDuration:1,accelerationDuration:.25,decelerationDuration:.25,delayReel:.05,anticipationDistance:150,bounceIntensity:.15,bounceDuration:.15},{reelIndex:2,spinSpeed:8e3,spinDuration:1,accelerationDuration:.25,decelerationDuration:.25,delayReel:.15,anticipationDistance:150,bounceIntensity:.15,bounceDuration:.15}],ui:{winAnimationDuration:.15,autoSpinDelay:500,buttonFeedbackDuration:.25,popupAnimationDuration:.15,transitionDuration:.1}},suspense:{name:"suspense",description:"Suspenseful animation with slow final reel when first two reels match.",reelConfigs:[{reelIndex:0,spinSpeed:5e3,spinDuration:2,accelerationDuration:.5,decelerationDuration:.5,delayReel:0,anticipationDistance:200,bounceIntensity:.2,bounceDuration:.2},{reelIndex:1,spinSpeed:5e3,spinDuration:2,accelerationDuration:.5,decelerationDuration:.5,delayReel:.1,anticipationDistance:200,bounceIntensity:.2,bounceDuration:.2},{reelIndex:2,spinSpeed:5e3,spinDuration:4,accelerationDuration:.5,decelerationDuration:2,delayReel:.3,anticipationDistance:1e3,bounceIntensity:.3,bounceDuration:.4}],ui:{winAnimationDuration:.4,autoSpinDelay:1e3,buttonFeedbackDuration:.5,popupAnimationDuration:.3,transitionDuration:.2}}});n("AnimationConfig",function(){function n(){this._currentProfile=void 0,this._currentProfile=i.normal}n.getInstance=function(){return n._instance||(n._instance=new n),n._instance};var e=n.prototype;return e.setProfile=function(n){i[n]?this._currentProfile=i[n]:(console.warn("[AnimationConfig] Profile '"+n+"' not found. Using default."),this._currentProfile=i.normal)},e.getReelConfig=function(n){return this._currentProfile.reelConfigs.find((function(e){return e.reelIndex===n}))||this._currentProfile.reelConfigs[0]},e.getUIConfig=function(){return this._currentProfile.ui},e.getCurrentProfile=function(){return this._currentProfile},n}())._instance=void 0,e._RF.pop()}}}));

System.register("chunks:///_virtual/AttackView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./AttackViewModel.ts"],(function(t){var e,i,n,a,o,r,l,s,u,d,c,h,g,f,b,p,w,v,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,o=t.createForOfIteratorHelperLoose,r=t.asyncToGenerator,l=t.regeneratorRuntime},function(t){s=t.cclegacy,u=t._decorator,d=t.Label,c=t.Node,h=t.Sprite,g=t.Button,f=t.Color,b=t.tween,p=t.v3,w=t.director},function(t){v=t.BaseView},function(t){y=t.AttackViewModel}],execute:function(){var L,k,m,C,T,B,_,M,N,A,I,R,z,D,E,S,x,U,V,P,F,H,K,G,O,Y,W,j,q,J,Q,X,Z,$,tt,et,it,nt,at,ot,rt,lt,st,ut,dt,ct,ht,gt,ft,bt,pt;s._RF.push({},"61a85CfdqpJ3rYS52F9av3G","AttackView",void 0);var wt=u.ccclass,vt=u.property;t("AttackView",(L=wt("AttackView"),k=vt(d),m=vt(d),C=vt(c),T=vt(d),B=vt(d),_=vt(d),M=vt([c]),N=vt([h]),A=vt([d]),I=vt([d]),R=vt([d]),z=vt([g]),D=vt([c]),E=vt(g),S=vt(g),x=vt(c),U=vt(d),V=vt(c),P=vt(d),F=vt(d),H=vt(d),K=vt(g),G=vt(c),O=vt(d),L((j=e((W=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,n(e,"goldLabel",j,a(e)),n(e,"attacksRemainingLabel",q,a(e)),n(e,"targetInfoContainer",J,a(e)),n(e,"targetPlayerNameLabel",Q,a(e)),n(e,"targetPlayerLevelLabel",X,a(e)),n(e,"targetCityNameLabel",Z,a(e)),n(e,"buildingNodes",$,a(e)),n(e,"buildingSprites",tt,a(e)),n(e,"buildingNameLabels",et,a(e)),n(e,"buildingLevelLabels",it,a(e)),n(e,"rewardLabels",nt,a(e)),n(e,"attackButtons",at,a(e)),n(e,"destroyedOverlays",ot,a(e)),n(e,"newTargetButton",rt,a(e)),n(e,"backButton",lt,a(e)),n(e,"loadingContainer",st,a(e)),n(e,"loadingLabel",ut,a(e)),n(e,"resultContainer",dt,a(e)),n(e,"resultTitleLabel",ct,a(e)),n(e,"resultMessageLabel",ht,a(e)),n(e,"resultRewardLabel",gt,a(e)),n(e,"resultCloseButton",ft,a(e)),n(e,"notificationContainer",bt,a(e)),n(e,"notificationLabel",pt,a(e)),e._viewModel=null,e._currentTarget=null,e}i(e,t);var s=e.prototype;return s.setupUI=function(){this.updateHeaderDisplay(),this.hideTargetInfo(),this.hideAllBuildings(),this.hideResultUI(),this.hideNotification(),this.showLoading("Loading target...")},s.bindEvents=function(){var t=this;this.newTargetButton&&this.newTargetButton.node.on(g.EventType.CLICK,this.onNewTargetClicked,this),this.backButton&&this.backButton.node.on(g.EventType.CLICK,this.onBackClicked,this);for(var e=function(e){var i=t.attackButtons[e];i&&i.node.on(g.EventType.CLICK,(function(){return t.onAttackClicked(e)}),t)},i=0;i<this.attackButtons.length;i++)e(i);this.resultCloseButton&&this.resultCloseButton.node.on(g.EventType.CLICK,this.onResultCloseClicked,this)},s.updateUI=function(t,e,i){},s.refreshUI=function(){this.updateHeaderDisplay(),this.updateTargetDisplay(),this.updateBuildingsDisplay()},s.setViewModel=function(e){t.prototype.setViewModel.call(this,e),this._viewModel=e,this._viewModel&&this.setupViewModelEvents()},s.setupViewModelEvents=function(){this._viewModel&&(this._viewModel.on("loadingTarget",this.onLoadingTarget,this),this._viewModel.on("targetLoaded",this.onTargetLoaded,this),this._viewModel.on("targetLoadError",this.onTargetLoadError,this),this._viewModel.on("resourceUpdated",this.onResourceUpdated,this),this._viewModel.on("attackStarted",this.onAttackStarted,this),this._viewModel.on("attackCompleted",this.onAttackCompleted,this),this._viewModel.on("attackError",this.onAttackError,this),this._viewModel.on("buildingAlreadyDestroyed",this.onBuildingAlreadyDestroyed,this),this._viewModel.on("noAttacksRemaining",this.onNoAttacksRemaining,this),this._viewModel.on("navigateToScene",this.onNavigateToScene,this))},s.updateHeaderDisplay=function(){this._viewModel&&(this.goldLabel&&(this.goldLabel.string=this.formatNumber(this._viewModel.currentGold)),this.attacksRemainingLabel&&(this.attacksRemainingLabel.string="Attacks: "+this._viewModel.attacksRemaining))},s.updateTargetDisplay=function(){this._viewModel&&this._currentTarget?(this.showTargetInfo(),this.targetPlayerNameLabel&&(this.targetPlayerNameLabel.string=this._currentTarget.playerName),this.targetPlayerLevelLabel&&(this.targetPlayerLevelLabel.string="Level "+this._currentTarget.playerLevel),this.targetCityNameLabel&&(this.targetCityNameLabel.string=this._currentTarget.cityName)):this.hideTargetInfo()},s.updateBuildingsDisplay=function(){if(this._currentTarget){for(var t=this._currentTarget.buildings,e=0;e<t.length&&e<this.buildingNodes.length;e++){var i=t[e];this.updateBuildingUI(e,i)}for(var n=t.length;n<this.buildingNodes.length;n++)this.buildingNodes[n]&&(this.buildingNodes[n].active=!1)}else this.hideAllBuildings()},s.updateBuildingUI=function(t,e){var i,n;(this.buildingNodes[t]&&(this.buildingNodes[t].active=!0),this.buildingNameLabels[t]&&(this.buildingNameLabels[t].string=this.getBuildingDisplayName(e.buildingType)),this.buildingLevelLabels[t]&&(this.buildingLevelLabels[t].string="Level "+e.level),this.rewardLabels[t]&&(this.rewardLabels[t].string=this.formatNumber(e.potentialReward)+" Gold"),this.attackButtons[t])&&(this.attackButtons[t].interactable=!e.isDestroyed&&(null==(i=this._viewModel)?void 0:i.hasAttacksRemaining)&&!(null!=(n=this._viewModel)&&n.isAttacking));this.destroyedOverlays[t]&&(this.destroyedOverlays[t].active=e.isDestroyed),this.updateBuildingSprite(t,e)},s.updateBuildingSprite=function(t,e){if(this.buildingSprites[t]){var i=this.buildingSprites[t];if(e.isDestroyed)i.color=f.GRAY;else{var n=e.potentialReward;i.color=n>=400?f.YELLOW:n>=200?f.GREEN:f.WHITE}}},s.getBuildingDisplayName=function(t){return{house:"House",shop:"Shop",factory:"Factory",tower:"Tower",castle:"Castle"}[t]||"Building"},s.showLoading=function(t){this.loadingContainer&&(this.loadingContainer.active=!0),this.loadingLabel&&(this.loadingLabel.string=t)},s.hideLoading=function(){this.loadingContainer&&(this.loadingContainer.active=!1)},s.showTargetInfo=function(){this.targetInfoContainer&&(this.targetInfoContainer.active=!0)},s.hideTargetInfo=function(){this.targetInfoContainer&&(this.targetInfoContainer.active=!1)},s.hideAllBuildings=function(){for(var t,e=o(this.buildingNodes);!(t=e()).done;){var i=t.value;i&&(i.active=!1)}},s.showAttackResult=function(t){this.resultContainer&&(this.resultContainer.active=!0),this.resultTitleLabel&&(this.resultTitleLabel.string=t.success?"Attack Successful!":"Attack Failed!"),this.resultMessageLabel&&(this.resultMessageLabel.string=t.message),this.resultRewardLabel&&(t.goldEarned>0?(this.resultRewardLabel.string="+"+this.formatNumber(t.goldEarned)+" Gold",this.resultRewardLabel.node.active=!0):this.resultRewardLabel.node.active=!1)},s.hideResultUI=function(){this.resultContainer&&(this.resultContainer.active=!1)},s.showNotification=function(t,e){var i=this;void 0===e&&(e=3),this.notificationContainer&&this.notificationLabel&&(this.notificationLabel.string=t,this.notificationContainer.active=!0,this.scheduleOnce((function(){i.hideNotification()}),e))},s.hideNotification=function(){this.notificationContainer&&(this.notificationContainer.active=!1)},s.formatNumber=function(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()},s.animateBuildingAttack=function(t){if(!(t<0||t>=this.buildingNodes.length)){var e=this.buildingNodes[t];if(e){var i=e.position;b(e).to(.1,{position:p(i.x+10,i.y,i.z)}).to(.1,{position:p(i.x-10,i.y,i.z)}).to(.1,{position:p(i.x+5,i.y,i.z)}).to(.1,{position:p(i.x-5,i.y,i.z)}).to(.1,{position:i}).start()}}},s.onLoadingTarget=function(t){t?(this.showLoading("Loading target..."),this.hideTargetInfo(),this.hideAllBuildings()):this.hideLoading()},s.onTargetLoaded=function(t){this._currentTarget=t,this.hideLoading(),this.refreshUI()},s.onTargetLoadError=function(t){this.hideLoading(),this.showNotification("Failed to load target. Using offline mode.")},s.onResourceUpdated=function(t){this.updateHeaderDisplay()},s.onAttackStarted=function(t){var e,i=(null==(e=this._currentTarget)?void 0:e.buildings.findIndex((function(e){return e.buildingId===t.buildingId})))||-1;i>=0&&this.animateBuildingAttack(i),this.showNotification("Attacking "+t.targetPlayer+"..."),this.updateBuildingsDisplay()},s.onAttackCompleted=function(t){this.showAttackResult(t),this.updateHeaderDisplay(),this.updateBuildingsDisplay()},s.onAttackError=function(t){this.showNotification("Attack failed: "+t.error),this.updateBuildingsDisplay()},s.onBuildingAlreadyDestroyed=function(t){this.showNotification("Building is already destroyed!")},s.onNoAttacksRemaining=function(){this.showNotification("No attacks remaining! Get a new target.")},s.onNavigateToScene=function(t){w.loadScene(t)},s.onNewTargetClicked=function(){var t=r(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._viewModel){t.next=3;break}return t.next=3,this._viewModel.executeCommand("getNewTarget");case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.onBackClicked=function(){this._viewModel&&this._viewModel.executeCommand("goBack")},s.onAttackClicked=function(){var t=r(l().mark((function t(e){var i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._viewModel&&this._currentTarget){t.next=2;break}return t.abrupt("return");case 2:if(!(i=this._currentTarget.buildings[e])){t.next=6;break}return t.next=6,this._viewModel.executeCommand("attackBuilding",i.buildingId);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.onResultCloseClicked=function(){this.hideResultUI()},s.onShow=function(){t.prototype.onShow.call(this),this._viewModel||(this._viewModel=new y,this.setViewModel(this._viewModel),this._viewModel.initialize())},s.onDestroy=function(){this.newTargetButton&&this.newTargetButton.node.off(g.EventType.CLICK,this.onNewTargetClicked,this),this.backButton&&this.backButton.node.off(g.EventType.CLICK,this.onBackClicked,this);for(var e=0;e<this.attackButtons.length;e++){var i=this.attackButtons[e];i&&i.node.off(g.EventType.CLICK)}this.resultCloseButton&&this.resultCloseButton.node.off(g.EventType.CLICK,this.onResultCloseClicked,this),this._viewModel&&(this._viewModel.off("loadingTarget",this.onLoadingTarget,this),this._viewModel.off("targetLoaded",this.onTargetLoaded,this),this._viewModel.off("targetLoadError",this.onTargetLoadError,this),this._viewModel.off("resourceUpdated",this.onResourceUpdated,this),this._viewModel.off("attackStarted",this.onAttackStarted,this),this._viewModel.off("attackCompleted",this.onAttackCompleted,this),this._viewModel.off("attackError",this.onAttackError,this),this._viewModel.off("buildingAlreadyDestroyed",this.onBuildingAlreadyDestroyed,this),this._viewModel.off("noAttacksRemaining",this.onNoAttacksRemaining,this),this._viewModel.off("navigateToScene",this.onNavigateToScene,this)),t.prototype.onDestroy.call(this)},e}(v)).prototype,"goldLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(W.prototype,"attacksRemainingLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(W.prototype,"targetInfoContainer",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(W.prototype,"targetPlayerNameLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(W.prototype,"targetPlayerLevelLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(W.prototype,"targetCityNameLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(W.prototype,"buildingNodes",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tt=e(W.prototype,"buildingSprites",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),et=e(W.prototype,"buildingNameLabels",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),it=e(W.prototype,"buildingLevelLabels",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nt=e(W.prototype,"rewardLabels",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),at=e(W.prototype,"attackButtons",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ot=e(W.prototype,"destroyedOverlays",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rt=e(W.prototype,"newTargetButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=e(W.prototype,"backButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(W.prototype,"loadingContainer",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(W.prototype,"loadingLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(W.prototype,"resultContainer",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(W.prototype,"resultTitleLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(W.prototype,"resultMessageLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(W.prototype,"resultRewardLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(W.prototype,"resultCloseButton",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(W.prototype,"notificationContainer",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(W.prototype,"notificationLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=W))||Y));s._RF.pop()}}}));

System.register("chunks:///_virtual/AttackViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseViewModel.ts","./ServiceLocator.ts","./Logger.ts"],(function(t){var e,a,r,n,i,s,c,u;return{setters:[function(t){e=t.inheritsLoose,a=t.createClass,r=t.asyncToGenerator,n=t.regeneratorRuntime},function(t){i=t.cclegacy},function(t){s=t.BaseViewModel},function(t){c=t.ServiceLocator},function(t){u=t.logError}],execute:function(){i._RF.push({},"80ea6qkB3hNk5+Xy4zFn1kg","AttackViewModel",void 0);t("AttackViewModel",function(t){function i(){var e;return(e=t.call(this)||this)._gameService=null,e._resourceManager=null,e._attackTarget=null,e._isAttacking=!1,e._attacksRemaining=3,e}e(i,t);var s=i.prototype;return s.onInitialize=function(){this.setupServices(),this.setupEventListeners(),this.loadAttackTarget()},s.setupServices=function(){var t=c.getInstance();this._gameService=t.getService("GameService"),this._resourceManager=t.getService("ResourceManager"),this._gameService||u("GameService not found"),this._resourceManager||u("ResourceManager not found")},s.setupEventListeners=function(){this._resourceManager&&this._resourceManager.on("resourceChanged",this.onResourceChanged,this)},s.loadAttackTarget=function(){var t=r(n().mark((function t(){var e;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.emit("loadingTarget",!0),!this._gameService||!this._gameService.isReady){t.next=9;break}return t.next=5,this._gameService.getAttackTarget();case 5:e=t.sent,this._attackTarget=this.processTargetData(e),t.next=10;break;case 9:this._attackTarget=this.generateMockTarget();case 10:this.emit("targetLoaded",this._attackTarget),this.emit("loadingTarget",!1),t.next=21;break;case 14:t.prev=14,t.t0=t.catch(0),u("Failed to load attack target:",t.t0),this.emit("targetLoadError",t.t0),this.emit("loadingTarget",!1),this._attackTarget=this.generateMockTarget(),this.emit("targetLoaded",this._attackTarget);case 21:case"end":return t.stop()}}),t,this,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),s.processTargetData=function(t){var e;return{playerId:t.playerId||"unknown",playerName:t.playerName||"Unknown Player",playerLevel:t.playerLevel||1,cityName:t.cityName||"Unknown City",buildings:(null==(e=t.buildings)?void 0:e.map((function(t){return{buildingId:t.id||"",buildingType:t.type||"building",level:t.level||1,isDestroyed:t.isDestroyed||!1,potentialReward:t.potentialReward||100}})))||[]}},s.generateMockTarget=function(){for(var t=["Alice","Bob","Charlie","Diana","Eve"],e=["Village","Town","City","Metropolis","Capital"],a=["house","shop","factory","tower","castle"],r=t[Math.floor(Math.random()*t.length)],n=e[Math.floor(Math.random()*e.length)],i=Math.floor(10*Math.random())+1,s=[],c=0;c<5;c++)s.push({buildingId:"building_"+c,buildingType:a[c],level:Math.floor(3*Math.random())+1,isDestroyed:Math.random()<.2,potentialReward:Math.floor(500*Math.random())+100});return{playerId:"player_"+Date.now(),playerName:r,playerLevel:i,cityName:n,buildings:s}},s.executeCommand=function(){var t=r(n().mark((function t(e){var a=arguments;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="attackBuilding"===t.t0?3:"getNewTarget"===t.t0?4:"goBack"===t.t0?5:"refreshTarget"===t.t0?6:7;break;case 3:return t.abrupt("return",this.attackBuilding(a.length<=1?void 0:a[1]));case 4:return t.abrupt("return",this.getNewTarget());case 5:return t.abrupt("return",this.goBack());case 6:return t.abrupt("return",this.loadAttackTarget());case 7:throw new Error("Unknown command: "+e);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.attackBuilding=function(){var t=r(n().mark((function t(e){var a,r,i;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._attackTarget&&!this._isAttacking){t.next=2;break}return t.abrupt("return",null);case 2:if(a=this._attackTarget.buildings.find((function(t){return t.buildingId===e}))){t.next=6;break}return u("Building not found: "+e),t.abrupt("return",null);case 6:if(!a.isDestroyed){t.next=9;break}return this.emit("buildingAlreadyDestroyed",{buildingId:e}),t.abrupt("return",null);case 9:if(!(this._attacksRemaining<=0)){t.next=12;break}return this.emit("noAttacksRemaining"),t.abrupt("return",null);case 12:if(t.prev=12,this._isAttacking=!0,this.emit("attackStarted",{buildingId:e,targetPlayer:this._attackTarget.playerName}),!this._gameService||!this._gameService.isReady){t.next=22;break}return t.next=18,this._gameService.attackPlayer(this._attackTarget.playerId,e);case 18:i=t.sent,r=this.processAttackResult(i,e),t.next=23;break;case 22:r=this.generateMockAttackResult(e,a);case 23:return t.next=25,this.processAttackSuccess(r);case 25:return this._attacksRemaining--,this._isAttacking=!1,this.emit("attackCompleted",r),t.abrupt("return",r);case 31:return t.prev=31,t.t0=t.catch(12),u("Attack failed:",t.t0),this._isAttacking=!1,this.emit("attackError",{buildingId:e,error:t.t0.message}),t.abrupt("return",null);case 37:case"end":return t.stop()}}),t,this,[[12,31]])})));return function(e){return t.apply(this,arguments)}}(),s.processAttackResult=function(t,e){return{success:t.success||!1,buildingId:e,goldEarned:t.goldEarned||0,damageDealt:t.damageDealt||!1,message:t.message||"Attack completed"}},s.generateMockAttackResult=function(t,e){var a=Math.random()<.7,r=a?Math.floor(e.potentialReward*(.5+.5*Math.random())):0,n=a&&Math.random()<.3;return{success:a,buildingId:t,goldEarned:r,damageDealt:n,message:a?n?"Building destroyed! Great attack!":"Attack successful!":"Attack failed! Better luck next time."}},s.processAttackSuccess=function(){var t=r(n().mark((function t(e){var a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.success&&this._attackTarget){t.next=2;break}return t.abrupt("return");case 2:if(!(e.goldEarned>0&&this._resourceManager)){t.next=5;break}return t.next=5,this._resourceManager.addGold(e.goldEarned,"attack_reward");case 5:e.damageDealt&&(a=this._attackTarget.buildings.find((function(t){return t.buildingId===e.buildingId})))&&(a.isDestroyed=!0);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.getNewTarget=function(){var t=r(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._attackTarget=null,this._attacksRemaining=3,t.next=4,this.loadAttackTarget();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.goBack=function(){this.emit("navigateToScene","Main")},s.onResourceChanged=function(t){this.emit("resourceUpdated",t)},s.destroy=function(){this._resourceManager&&this._resourceManager.off("resourceChanged",this.onResourceChanged,this),this._gameService=null,this._resourceManager=null,this._attackTarget=null,this._isAttacking=!1,t.prototype.destroy.call(this)},a(i,[{key:"attackTarget",get:function(){return this._attackTarget}},{key:"currentGold",get:function(){return this._resourceManager?this._resourceManager.getGold():0}},{key:"isAttacking",get:function(){return this._isAttacking}},{key:"attacksRemaining",get:function(){return this._attacksRemaining}},{key:"hasAttacksRemaining",get:function(){return this._attacksRemaining>0}},{key:"targetPlayerName",get:function(){return this._attackTarget?this._attackTarget.playerName:""}},{key:"targetCityName",get:function(){return this._attackTarget?this._attackTarget.cityName:""}},{key:"targetPlayerLevel",get:function(){return this._attackTarget?this._attackTarget.playerLevel:1}},{key:"availableBuildings",get:function(){return this._attackTarget?this._attackTarget.buildings.filter((function(t){return!t.isDestroyed})):[]}},{key:"destroyedBuildings",get:function(){return this._attackTarget?this._attackTarget.buildings.filter((function(t){return t.isDestroyed})):[]}},{key:"totalPotentialReward",get:function(){return this._attackTarget?this.availableBuildings.reduce((function(t,e){return t+e.potentialReward}),0):0}}]),i}(s));i._RF.pop()}}}));

System.register("chunks:///_virtual/BaseModel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,a,n;return{setters:[function(t){e=t.inheritsLoose,i=t.extends},function(t){a=t.cclegacy,n=t.EventTarget}],execute:function(){a._RF.push({},"98eb43ZEzhKurU5Otb++Pg0","BaseModel",void 0);t("BaseModel",function(t){function a(){var e;return(e=t.call(this)||this)._data={},e}e(a,t);var n=a.prototype;return n.getData=function(t){return this._data[t]},n.setData=function(t,e){var i=this._data[t];i!==e&&(this._data[t]=e,this.emit("dataChanged",{key:t,value:e,oldValue:i}),this.emit(t+"Changed",{value:e,oldValue:i}))},n.initialize=function(t){this._data=i({},t),this.emit("initialized",this._data)},n.getAllData=function(){return i({},this._data)},n.reset=function(){this._data={},this.emit("reset")},n.toJSON=function(){return this.getAllData()},n.fromJSON=function(t){this.initialize(t)},a}(n));a._RF.pop()}}}));

System.register("chunks:///_virtual/BaseService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts"],(function(t){var e,n,i,r,c,s,o;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass,i=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){c=t.cclegacy,s=t.EventTarget},function(t){o=t.logError}],execute:function(){c._RF.push({},"ff8c2OV8JFBAIhJgSoFtCDP","BaseService",void 0);t("BaseService",function(t){function c(){var e;return(e=t.call(this)||this)._isInitialized=!1,e._isConnected=!1,e}e(c,t);var s=c.prototype;return s.initialize=function(){var t=i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isInitialized){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.onInitialize();case 5:this._isInitialized=!0,this.emit("initialized"),t.next=14;break;case 9:throw t.prev=9,t.t0=t.catch(2),o("Failed to initialize "+this.constructor.name+":",t.t0),this.emit("initializationFailed",t.t0),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(){return t.apply(this,arguments)}}(),s.connect=function(){var t=i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isConnected){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.onConnect();case 5:this._isConnected=!0,this.emit("connected"),t.next=14;break;case 9:throw t.prev=9,t.t0=t.catch(2),o("Failed to connect "+this.constructor.name+":",t.t0),this.emit("connectionFailed",t.t0),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(){return t.apply(this,arguments)}}(),s.disconnect=function(){var t=i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._isConnected){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.onDisconnect();case 5:this._isConnected=!1,this.emit("disconnected"),t.next=14;break;case 9:throw t.prev=9,t.t0=t.catch(2),o("Failed to disconnect "+this.constructor.name+":",t.t0),this.emit("disconnectionFailed",t.t0),t.t0;case 14:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(){return t.apply(this,arguments)}}(),s.destroy=function(){this._isConnected&&this.disconnect().catch(console.error),this._isInitialized=!1,this.targetOff(this)},n(c,[{key:"isInitialized",get:function(){return this._isInitialized}},{key:"isConnected",get:function(){return this._isConnected}}]),c}(s));c._RF.pop()}}}));

System.register("chunks:///_virtual/BaseView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts"],(function(e){var i,t,n,o,s,a,l;return{setters:[function(e){i=e.inheritsLoose,t=e.createClass,n=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,a=e.Component},function(e){l=e.logInfo}],execute:function(){s._RF.push({},"56b2ebPjTVDHKvVrG5T16ZC","BaseView",void 0);e("BaseView",function(e){function s(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this)._viewModel=null,i._isInitialized=!1,i}i(s,e);var a=s.prototype;return a.setViewModel=function(e){this._viewModel&&(this._viewModel.off("modelDataChanged",this.onViewModelDataChanged,this),this._viewModel.off("modelInitialized",this.onViewModelInitialized,this)),this._viewModel=e,this._viewModel&&(this._viewModel.on("modelDataChanged",this.onViewModelDataChanged,this),this._viewModel.on("modelInitialized",this.onViewModelInitialized,this))},a.getViewModel=function(){return this._viewModel},a.onLoad=function(){l("BaseView: onLoad called for "+this.constructor.name),this.initializeView()},a.initializeView=function(){l("BaseView: initializeView called for "+this.constructor.name),this._isInitialized=!0,this.setupUI(),this.bindEvents(),l("BaseView: initializeView completed for "+this.constructor.name)},a.onViewModelDataChanged=function(e){this.updateUI(e.key,e.value,e.oldValue)},a.onViewModelInitialized=function(e){this.refreshUI()},a.executeCommand=function(){var e=n(o().mark((function e(i){var t,n,s,a,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._viewModel){e.next=5;break}for(n=l.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=l[a];return e.next=4,(t=this._viewModel).executeCommand.apply(t,[i].concat(s));case 4:return e.abrupt("return",e.sent);case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e,this)})));return function(i){return e.apply(this,arguments)}}(),a.show=function(){this.node.active=!0,this.onShow()},a.hide=function(){this.node.active=!1,this.onHide()},a.onShow=function(){},a.onHide=function(){},a.onDestroy=function(){this._viewModel&&(this._viewModel.off("modelDataChanged",this.onViewModelDataChanged,this),this._viewModel.off("modelInitialized",this.onViewModelInitialized,this),this._viewModel.destroy()),this._viewModel=null,this._isInitialized=!1},t(s,[{key:"isInitialized",get:function(){return this._isInitialized}}]),s}(a));s._RF.pop()}}}));

System.register("chunks:///_virtual/BaseViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,o;return{setters:[function(i){t=i.inheritsLoose,e=i.createClass},function(i){n=i.cclegacy,o=i.EventTarget}],execute:function(){n._RF.push({},"55b46hrskpGdLofNgPAYLjo","BaseViewModel",void 0);i("BaseViewModel",function(i){function n(){var t;return(t=i.call(this)||this)._model=null,t._isInitialized=!1,t}t(n,i);var o=n.prototype;return o.setModel=function(i){this._model&&(this._model.off("dataChanged",this.onModelDataChanged,this),this._model.off("initialized",this.onModelInitialized,this)),this._model=i,this._model&&(this._model.on("dataChanged",this.onModelDataChanged,this),this._model.on("initialized",this.onModelInitialized,this))},o.getModel=function(){return this._model},o.initialize=function(){this._isInitialized=!0,this.onInitialize(),this.emit("initialized")},o.onInitialize=function(){},o.onModelDataChanged=function(i){this.emit("modelDataChanged",i)},o.onModelInitialized=function(i){this.emit("modelInitialized",i)},o.destroy=function(){this._model&&(this._model.off("dataChanged",this.onModelDataChanged,this),this._model.off("initialized",this.onModelInitialized,this)),this._model=null,this._isInitialized=!1,this.targetOff(this)},e(n,[{key:"isInitialized",get:function(){return this._isInitialized}}]),n}(o));n._RF.pop()}}}));

System.register("chunks:///_virtual/BuildingModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseModel.ts","./GameConfig.ts"],(function(t){var e,i,s,n,l;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){s=t.cclegacy},function(t){n=t.BaseModel},function(t){l=t.GameConfig}],execute:function(){s._RF.push({},"633f6BVZdtJtLlKywU7kdHc","BuildingModel",void 0);t("BuildingModel",function(t){function s(e,i){var s;(s=t.call(this)||this).DEFAULT_MAX_LEVEL=3,s.DEFAULT_COST_MULTIPLIER=1.5;var n=l.getInstance().getBuildingConfig(i,e);if(!n)throw new Error("Building config for id "+e+" in city level "+i+" not found");return s.initialize({id:e,name:n.name,level:0,maxLevel:n.maxLevel||s.DEFAULT_MAX_LEVEL,baseCost:n.baseCost,costMultiplier:n.costMultiplier||s.DEFAULT_COST_MULTIPLIER}),s}e(s,t);var n=s.prototype;return n.getUpgradeCost=function(){if(this.isMaxLevel())return 0;var t=this.level+1;return Math.floor(this.baseCost*Math.pow(this.costMultiplier,t-1))},n.isMaxLevel=function(){return this.level>=this.maxLevel},n.canUpgrade=function(){return!this.isMaxLevel()},n.upgrade=function(){return!!this.canUpgrade()&&(this.level+=1,this.emit("upgraded",{buildingId:this.id,newLevel:this.level,isMaxLevel:this.isMaxLevel()}),!0)},n.getUpgradeProgress=function(){return this.maxLevel>0?this.level/this.maxLevel:0},n.resetBuilding=function(){this.level=0,this.emit("reset",{buildingId:this.id})},n.validate=function(){var t=this.level,e=this.maxLevel,i=this.baseCost,s=this.costMultiplier,n=this.id;return n&&n.length>0&&t>=0&&e>0&&t<=e&&i>0&&s>=1},n.toJSON=function(){return{id:this.id,level:this.level,maxLevel:this.maxLevel,baseCost:this.baseCost,costMultiplier:this.costMultiplier}},n.fromJSON=function(t){this.initialize({id:t.id||"",level:t.level||0,maxLevel:t.maxLevel||this.DEFAULT_MAX_LEVEL,baseCost:t.baseCost||100,costMultiplier:t.costMultiplier||this.DEFAULT_COST_MULTIPLIER})},i(s,[{key:"id",get:function(){return this.getData("id")||""}},{key:"name",get:function(){return this.getData("name")||""},set:function(t){this.setData("name",t)}},{key:"level",get:function(){return this.getData("level")||0},set:function(t){var e=this.maxLevel;this.setData("level",Math.max(0,Math.min(t,e)))}},{key:"maxLevel",get:function(){return this.getData("maxLevel")||this.DEFAULT_MAX_LEVEL},set:function(t){this.setData("maxLevel",Math.max(1,t))}},{key:"baseCost",get:function(){return this.getData("baseCost")||100},set:function(t){this.setData("baseCost",Math.max(1,t))}},{key:"costMultiplier",get:function(){return this.getData("costMultiplier")||this.DEFAULT_COST_MULTIPLIER},set:function(t){this.setData("costMultiplier",Math.max(1,t))}}]),s}(n));s._RF.pop()}}}));

System.register("chunks:///_virtual/CheatComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ServiceLocator.ts"],(function(r){var e,n,t,i,o,u,a,l,c,s;return{setters:[function(r){e=r.applyDecoratedDescriptor,n=r.inheritsLoose,t=r.initializerDefineProperty,i=r.assertThisInitialized},function(r){o=r.cclegacy,u=r._decorator,a=r.EditBox,l=r.log,c=r.Component},function(r){s=r.ServiceLocator}],execute:function(){var d,v,f,p,g,y,E;o._RF.push({},"8ce81yCyoNLqrIyVJ1RA1ee","CheatComponent",void 0);var h=u.ccclass,m=u.property;r("CheatComponent",(d=h("CheatComponent"),v=m(a),f=m(a),d((y=e((g=function(r){function e(){for(var e,n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];return e=r.call.apply(r,[this].concat(o))||this,t(e,"inputEnergy",y,i(e)),t(e,"inputGold",E,i(e)),e}n(e,r);var o=e.prototype;return o.onClickBtnSetEnergy=function(){try{if(!this.inputEnergy)return void l("Error: Energy input field is not assigned");var r=this.inputEnergy.string.trim();if(!r)return void l("Error: Energy input is empty");var e=Number(r);if(isNaN(e))return void l("Error: Energy input is not a valid number");if(e<0)return void l("Error: Energy value cannot be negative");if(e>999999)return void l("Error: Energy value is too large (max: 999999)");var n=s.getInstance().getService("GameService");if(!n)return void l("Error: GameService not found");var t=n.getPlayerModel();if(!t)return void l("Error: PlayerModel not found");var i=t.resources;if(!i)return void l("Error: ResourceModel not found");i.energy=e,l("Energy successfully set to: "+e),this.inputEnergy.string=""}catch(r){l("Error in onClickBtnSetEnergy: "+r)}},o.onClickBtnSetGold=function(){try{if(!this.inputGold)return void l("Error: Gold input field is not assigned");var r=this.inputGold.string.trim();if(!r)return void l("Error: Gold input is empty");var e=Number(r);if(isNaN(e))return void l("Error: Gold input is not a valid number");if(e<0)return void l("Error: Gold value cannot be negative");if(e>999999999)return void l("Error: Gold value is too large (max: 999999999)");var n=s.getInstance().getService("GameService");if(!n)return void l("Error: GameService not found");var t=n.getPlayerModel();if(!t)return void l("Error: PlayerModel not found");var i=t.resources;if(!i)return void l("Error: ResourceModel not found");i.gold=e,l("Gold successfully set to: "+e),this.inputGold.string=""}catch(r){l("Error in onClickBtnSetGold: "+r)}},o.onClickBtnClose=function(){this.hide()},o.show=function(){this.node.active=!0},o.hide=function(){this.node.active=!1},e}(c)).prototype,"inputEnergy",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(g.prototype,"inputGold",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=g))||p));o._RF.pop()}}}));

System.register("chunks:///_virtual/CityModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseModel.ts","./BuildingModel.ts","./GameConfig.ts"],(function(e){var i,t,n,s,l,o,r;return{setters:[function(e){i=e.inheritsLoose,t=e.createForOfIteratorHelperLoose,n=e.createClass},function(e){s=e.cclegacy},function(e){l=e.BaseModel},function(e){o=e.BuildingModel},function(e){r=e.GameConfig}],execute:function(){s._RF.push({},"a76bbBagQFNAr+y6UZNWnbX","CityModel",void 0);e("CityModel",function(e){function s(i){var t;(t=e.call(this)||this)._buildings=new Map;var n=r.getInstance().getCityConfig(i);if(!n)throw new Error("City config for level "+i+" not found");return t.initialize({id:n.id,name:n.name,level:n.level,isCompleted:!1,completionReward:n.completionReward}),t.initializeBuildings(),t}i(s,e);var l=s.prototype;return l.initializeBuildings=function(){for(var e=r.getInstance().getCityConfig(this.level),i=0;i<e.buildings.length;i++){var t=e.buildings[i],n=new o(t.id,this.level);n.on("upgraded",this.onBuildingUpgraded,this),n.on("reset",this.onBuildingReset,this),this._buildings.set(t.id,n)}},l.getBuildings=function(){return Array.from(this._buildings.values())},l.getBuilding=function(e){return this._buildings.get(e)||null},l.getBuildingByIndex=function(e){return this.getBuildings()[e]||null},l.areAllBuildingsMaxLevel=function(){for(var e,i=t(this._buildings.values());!(e=i()).done;){if(!e.value.isMaxLevel())return!1}return!0},l.getCompletionProgress=function(){for(var e,i=0,n=0,s=t(this._buildings.values());!(e=s()).done;){var l=e.value;i+=l.level,n+=l.maxLevel}return n>0?i/n:0},l.getTotalUpgradeCost=function(){for(var e,i=0,n=t(this._buildings.values());!(e=n()).done;){var s=e.value;s.canUpgrade()&&(i+=s.getUpgradeCost())}return i},l.upgradeBuilding=function(e){var i=this._buildings.get(e);return!(!i||!i.canUpgrade())&&i.upgrade()},l.onBuildingUpgraded=function(e){this.emit("buildingUpgraded",e),this.areAllBuildingsMaxLevel()&&!this.isCompleted&&this.completeCity()},l.onBuildingReset=function(e){this.emit("buildingReset",e),this.isCompleted&&(this.setData("isCompleted",!1),this.emit("cityIncomplete",{cityId:this.id}))},l.completeCity=function(){this.setData("isCompleted",!0),this.emit("cityCompleted",{cityId:this.id,cityName:this.name,reward:this.completionReward})},l.resetCity=function(){for(var e,i=t(this._buildings.values());!(e=i()).done;){e.value.resetBuilding()}this.setData("isCompleted",!1),this.emit("cityReset",{cityId:this.id})},l.validate=function(){var e=this.id,i=this.name,n=this.level,s=this.completionReward;if(!e||!i||n<1||s<0)return!1;var l=r.getInstance().getCityConfig(this.level),o=l&&l.buildings?l.buildings.length:5;if(this._buildings.size!==o)return!1;for(var a,d=t(this._buildings.values());!(a=d()).done;){if(!a.value.validate())return!1}return!0},l.toJSON=function(){for(var e,i=[],n=t(this._buildings.values());!(e=n()).done;){var s=e.value;i.push(s.toJSON())}return{id:this.id,name:this.name,level:this.level,isCompleted:this.isCompleted,buildings:i,completionReward:this.completionReward}},l.fromJSON=function(e){this.initialize({id:e.id||"",name:e.name||"",level:e.level||1,isCompleted:e.isCompleted||!1,completionReward:e.completionReward||0});for(var i,n=t(this._buildings.values());!(i=n()).done;){i.value.targetOff(this)}if(this._buildings.clear(),e.buildings&&e.buildings.length>0)for(var s,l=t(e.buildings);!(s=l()).done;){var r=s.value,a=new o(r.id,this.level);a.fromJSON(r),a.on("upgraded",this.onBuildingUpgraded,this),a.on("reset",this.onBuildingReset,this),this._buildings.set(a.id,a)}},l.destroy=function(){for(var i,n=t(this._buildings.values());!(i=n()).done;){var s=i.value;s.targetOff(this),s.reset()}this._buildings.clear(),e.prototype.reset.call(this)},n(s,[{key:"id",get:function(){return this.getData("id")||""}},{key:"name",get:function(){return this.getData("name")||""},set:function(e){this.setData("name",e)}},{key:"level",get:function(){return this.getData("level")||1}},{key:"isCompleted",get:function(){return this.getData("isCompleted")||!1}},{key:"completionReward",get:function(){return this.getData("completionReward")||0}}]),s}(l));s._RF.pop()}}}));

System.register("chunks:///_virtual/CityView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./CityViewModel.ts","./Logger.ts"],(function(i){var e,t,n,o,a,l,r,s,u,d,c,h,p,g,b,f,m,v,w,y,C;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized,a=i.asyncToGenerator,l=i.regeneratorRuntime},function(i){r=i.cclegacy,s=i._decorator,u=i.Label,d=i.ProgressBar,c=i.Node,h=i.Sprite,p=i.Button,g=i.log,b=i.v3,f=i.Color,m=i.tween,v=i.director},function(i){w=i.BaseView},function(i){y=i.CityViewModel},function(i){C=i.logError}],execute:function(){var L,B,M,_,N,U,D,S,I,x,z,E,P,k,T,V,R,G,H,F,A,K,O,W,q,Z,j,J,X,Y,Q,$,ii,ei,ti,ni,oi;r._RF.push({},"b5969WZCAFGrZEV8MPqMTNc","CityView",void 0);var ai=s.ccclass,li=s.property;i("CityView",(L=ai("CityView"),B=li(u),M=li(u),_=li(d),N=li(u),U=li([c]),D=li([h]),S=li([u]),I=li([u]),x=li([p]),z=li([u]),E=li(p),P=li(c),k=li(u),T=li(u),V=li(p),R=li(c),G=li(u),L((A=e((F=function(i){function e(){for(var e,t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];return e=i.call.apply(i,[this].concat(a))||this,n(e,"cityNameLabel",A,o(e)),n(e,"goldLabel",K,o(e)),n(e,"cityProgressBar",O,o(e)),n(e,"cityProgressLabel",W,o(e)),n(e,"buildingNodes",q,o(e)),n(e,"buildingSprites",Z,o(e)),n(e,"buildingNameLabels",j,o(e)),n(e,"buildingLevelLabels",J,o(e)),n(e,"upgradeButtons",X,o(e)),n(e,"upgradeCostLabels",Y,o(e)),n(e,"backButton",Q,o(e)),n(e,"completionContainer",$,o(e)),n(e,"completionTitleLabel",ii,o(e)),n(e,"completionRewardLabel",ei,o(e)),n(e,"completionCloseButton",ti,o(e)),n(e,"notificationContainer",ni,o(e)),n(e,"notificationLabel",oi,o(e)),e._viewModel=null,e._buildingData=[],e}t(e,i);var r=e.prototype;return r.setupUI=function(){this.bindUI(),this.updateHeaderDisplay(),this.updateBuildingDisplay(),this.hideCompletionUI(),this.hideNotification()},r.bindUI=function(){for(var i=0;i<this.buildingNodes.length;i++){var e=this.buildingNodes[i],t=e.getChildByName("BuildingSprite"),n=e.getChildByName("BuildingNameLabel"),o=e.getChildByName("BuildingLevelLabel"),a=e.getChildByName("UpgradeButton"),l=a.getChildByName("UpgradeCostLabel");t&&this.buildingSprites.push(t.getComponent(h)),n&&this.buildingNameLabels.push(n.getComponent(u)),o&&this.buildingLevelLabels.push(o.getComponent(u)),a&&this.upgradeButtons.push(a.getComponent(p)),l&&this.upgradeCostLabels.push(l.getComponent(u))}},r.bindEvents=function(){var i=this;this.backButton&&this.backButton.node.on(p.EventType.CLICK,this.onBackClicked,this);for(var e=function(e){var t=i.upgradeButtons[e];t&&t.node.on(p.EventType.CLICK,(function(){return i.onUpgradeClicked(e)}),i)},t=0;t<this.upgradeButtons.length;t++)e(t);this.completionCloseButton&&this.completionCloseButton.node.on(p.EventType.CLICK,this.onCompletionCloseClicked,this)},r.updateUI=function(i,e,t){},r.refreshUI=function(){this.updateHeaderDisplay(),this.updateBuildingDisplay()},r.setViewModel=function(e){i.prototype.setViewModel.call(this,e),this._viewModel=e,this._viewModel&&this.setupViewModelEvents()},r.setupViewModelEvents=function(){this._viewModel&&(this._viewModel.on("cityDataLoaded",this.onCityDataLoaded,this),this._viewModel.on("resourceUpdated",this.onResourceUpdated,this),this._viewModel.on("buildingDataUpdated",this.onBuildingDataUpdated,this),this._viewModel.on("cityProgressUpdated",this.onCityProgressUpdated,this),this._viewModel.on("buildingUpgradeSuccess",this.onBuildingUpgradeSuccess,this),this._viewModel.on("buildingUpgradeError",this.onBuildingUpgradeError,this),this._viewModel.on("insufficientGold",this.onInsufficientGold,this),this._viewModel.on("buildingMaxLevel",this.onBuildingMaxLevel,this),this._viewModel.on("cityCompleted",this.onCityCompleted,this),this._viewModel.on("showCityCompletion",this.onShowCityCompletion,this),this._viewModel.on("navigateToScene",this.onNavigateToScene,this))},r.updateHeaderDisplay=function(){if(this._viewModel&&(this.cityNameLabel&&(this.cityNameLabel.string=this._viewModel.currentCityName||"City"),this.goldLabel&&(this.goldLabel.string=this.formatNumber(this._viewModel.currentGold)),this.cityProgressBar&&(this.cityProgressBar.progress=this._viewModel.cityCompletionProgress),this.cityProgressLabel)){var i=Math.round(100*this._viewModel.cityCompletionProgress);this.cityProgressLabel.string=i+"%"}},r.updateBuildingDisplay=function(){var i=this;this._viewModel&&this._viewModel.executeCommand("getAllBuildingsData").then((function(e){i._buildingData=e;for(var t=0;t<i._buildingData.length&&t<i.buildingNodes.length;t++){var n=i._buildingData[t];i.updateBuildingUI(t,n)}})).catch((function(i){C("Failed to get building data:",i)}))},r.updateBuildingUI=function(i,e){g("updateBuildingUI",i,e),this.buildingNameLabels[i]&&(this.buildingNameLabels[i].string=e.buildingName),this.buildingLevelLabels[i]&&(this.buildingLevelLabels[i].string="Level "+e.currentLevel+"/"+e.maxLevel),this.upgradeButtons[i]&&(this.upgradeButtons[i].interactable=e.canUpgrade),this.upgradeCostLabels[i]&&(e.isMaxLevel?this.upgradeCostLabels[i].string="MAX LEVEL":this.upgradeCostLabels[i].string=this.formatNumber(e.upgradeCost)),this.updateBuildingSprite(i,e)},r.updateBuildingSprite=function(i,e){if(this.buildingSprites[i]){var t=this.buildingSprites[i],n=.8+.4*(e.currentLevel/e.maxLevel);this.buildingNodes[i]&&(this.buildingNodes[i].scale=b(n,n,1)),e.isMaxLevel?t.color=f.YELLOW:e.currentLevel>0?t.color=f.GREEN:t.color=f.WHITE}},r.showCompletionUI=function(i,e){this.completionContainer&&(this.completionContainer.active=!0),this.completionTitleLabel&&(this.completionTitleLabel.string=i+" Completed!"),this.completionRewardLabel&&(this.completionRewardLabel.string="Reward: "+this.formatNumber(e)+" Gold")},r.hideCompletionUI=function(){this.completionContainer&&(this.completionContainer.active=!1)},r.showNotification=function(i,e){var t=this;void 0===e&&(e=3),this.notificationContainer&&this.notificationLabel&&(this.notificationLabel.string=i,this.notificationContainer.active=!0,this.scheduleOnce((function(){t.hideNotification()}),e))},r.hideNotification=function(){this.notificationContainer&&(this.notificationContainer.active=!1)},r.formatNumber=function(i){return i>=1e6?(i/1e6).toFixed(1)+"M":i>=1e3?(i/1e3).toFixed(1)+"K":i.toString()},r.animateBuildingUpgrade=function(i){if(!(i<0||i>=this.buildingNodes.length)){var e=this.buildingNodes[i];e&&m(e).to(.2,{scale:b(1.3,1.3,1)}).to(.2,{scale:b(1,1,1)}).start()}},r.onCityDataLoaded=function(){this.refreshUI()},r.onResourceUpdated=function(i){this.updateHeaderDisplay()},r.onBuildingDataUpdated=function(i){this._buildingData=i,this.updateBuildingDisplay()},r.onCityProgressUpdated=function(i){this.updateHeaderDisplay()},r.onBuildingUpgradeSuccess=function(i){var e=this._buildingData.findIndex((function(e){return e.buildingId===i.buildingId}));e>=0&&this.animateBuildingUpgrade(e),this.showNotification("Building upgraded to level "+i.newLevel+"!")},r.onBuildingUpgradeError=function(i){this.showNotification("Upgrade failed: "+i.error)},r.onInsufficientGold=function(i){this.showNotification("Need "+this.formatNumber(i.required)+" gold, have "+this.formatNumber(i.available))},r.onBuildingMaxLevel=function(i){this.showNotification("Building is already at maximum level!")},r.onCityCompleted=function(i){this.updateHeaderDisplay(),this.updateBuildingDisplay()},r.onShowCityCompletion=function(i){this.showCompletionUI(i.cityName,i.reward)},r.onNavigateToScene=function(i){v.loadScene(i)},r.onBackClicked=function(){this._viewModel&&this._viewModel.executeCommand("goBack")},r.onUpgradeClicked=function(){var i=a(l().mark((function i(e){var t;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(g("Upgrading building at index "+e+" _buildingData = "+JSON.stringify(this._buildingData)),this._viewModel&&!(e>=this._buildingData.length)){i.next=3;break}return i.abrupt("return");case 3:return t=this._buildingData[e],i.next=6,this._viewModel.executeCommand("upgradeBuilding",t.buildingId);case 6:case"end":return i.stop()}}),i,this)})));return function(e){return i.apply(this,arguments)}}(),r.onCompletionCloseClicked=function(){this.hideCompletionUI()},r.start=function(){this.onShow()},r.onShow=function(){i.prototype.onShow.call(this),this._viewModel||(this._viewModel=new y,this.setViewModel(this._viewModel),this._viewModel.initialize())},r.onDestroy=function(){this._viewModel&&(this._viewModel.off("cityDataLoaded",this.onCityDataLoaded,this),this._viewModel.off("resourceUpdated",this.onResourceUpdated,this),this._viewModel.off("buildingDataUpdated",this.onBuildingDataUpdated,this),this._viewModel.off("cityProgressUpdated",this.onCityProgressUpdated,this),this._viewModel.off("buildingUpgradeSuccess",this.onBuildingUpgradeSuccess,this),this._viewModel.off("buildingUpgradeError",this.onBuildingUpgradeError,this),this._viewModel.off("insufficientGold",this.onInsufficientGold,this),this._viewModel.off("buildingMaxLevel",this.onBuildingMaxLevel,this),this._viewModel.off("cityCompleted",this.onCityCompleted,this),this._viewModel.off("showCityCompletion",this.onShowCityCompletion,this),this._viewModel.off("navigateToScene",this.onNavigateToScene,this)),i.prototype.onDestroy.call(this)},e}(w)).prototype,"cityNameLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(F.prototype,"goldLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(F.prototype,"cityProgressBar",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(F.prototype,"cityProgressLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(F.prototype,"buildingNodes",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Z=e(F.prototype,"buildingSprites",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=e(F.prototype,"buildingNameLabels",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J=e(F.prototype,"buildingLevelLabels",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),X=e(F.prototype,"upgradeButtons",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Y=e(F.prototype,"upgradeCostLabels",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=e(F.prototype,"backButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(F.prototype,"completionContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=e(F.prototype,"completionTitleLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ei=e(F.prototype,"completionRewardLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ti=e(F.prototype,"completionCloseButton",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ni=e(F.prototype,"notificationContainer",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=e(F.prototype,"notificationLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=F))||H));r._RF.pop()}}}));

System.register("chunks:///_virtual/CityViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseViewModel.ts","./ServiceLocator.ts","./PlayerModel.ts","./Logger.ts"],(function(e){var t,r,i,n,s,a,u,o,c;return{setters:[function(e){t=e.inheritsLoose,r=e.createClass,i=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){s=e.cclegacy},function(e){a=e.BaseViewModel},function(e){u=e.ServiceLocator},function(e){o=e.PlayerModel},function(e){c=e.logError}],execute:function(){s._RF.push({},"6d06cDAGnNH/Yd34TjODrwn","CityViewModel",void 0);e("CityViewModel",function(e){function s(){var t;return(t=e.call(this)||this)._gameService=null,t._resourceManager=null,t._playerModel=null,t._currentCity=null,t}t(s,e);var a=s.prototype;return a.onInitialize=function(){this.setupServices(),this.setupModels(),this.setupEventListeners(),this.loadCityData()},a.setupServices=function(){var e=u.getInstance();this._gameService=e.getService("GameService"),this._resourceManager=e.getService("ResourceManager"),this._gameService||c("GameService not found"),this._resourceManager||c("ResourceManager not found")},a.setupModels=function(){var e=u.getInstance().getService("GameService");e&&(this._playerModel=e.getPlayerModel()),this._playerModel||(c("CityViewModel failed to get PlayerModel from GameService. This is a critical error."),this._playerModel=new o),this._playerModel&&(this._currentCity=this._playerModel.currentCity)},a.setupEventListeners=function(){this._resourceManager&&(this._resourceManager.on("resourceChanged",this.onResourceChanged,this),this._resourceManager.on("insufficientResources",this.onInsufficientResources,this)),this._currentCity&&(this._currentCity.on("buildingUpgraded",this.onBuildingUpgraded,this),this._currentCity.on("cityCompleted",this.onCityCompleted,this)),this._playerModel&&this._playerModel.on("currentCityChanged",this.onCurrentCityChanged,this)},a.loadCityData=function(){var e=i(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(this._gameService&&this._gameService.isReady&&this._currentCity)){e.next=5;break}return e.next=4,this._gameService.getCityData(this._currentCity.id);case 4:e.sent;case 5:this.emit("cityDataLoaded"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),c("Failed to load city data:",e.t0),this.emit("cityDataLoadError",e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),a.executeCommand=function(){var e=i(n().mark((function e(t){var r=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="upgradeBuilding"===e.t0?3:"getBuildingData"===e.t0?4:"getAllBuildingsData"===e.t0?5:"getCityProgress"===e.t0?6:"goBack"===e.t0?7:"refreshData"===e.t0?8:9;break;case 3:return e.abrupt("return",this.upgradeBuilding(r.length<=1?void 0:r[1]));case 4:return e.abrupt("return",this.getBuildingData(r.length<=1?void 0:r[1]));case 5:return e.abrupt("return",this.getAllBuildingsData());case 6:return e.abrupt("return",this.getCityProgress());case 7:return e.abrupt("return",this.goBack());case 8:return e.abrupt("return",this.loadCityData());case 9:throw new Error("Unknown command: "+t);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.upgradeBuilding=function(){var e=i(n().mark((function e(t){var r,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._currentCity&&this._resourceManager&&this._gameService){e.next=2;break}return e.abrupt("return",!1);case 2:if(r=this._currentCity.getBuilding(t)){e.next=6;break}return c("Building not found: "+t),e.abrupt("return",!1);case 6:if(r.canUpgrade()){e.next=9;break}return this.emit("buildingMaxLevel",{buildingId:t}),e.abrupt("return",!1);case 9:if(i=r.getUpgradeCost(),this._resourceManager.hasEnoughGold(i)){e.next=13;break}return this.emit("insufficientGold",{required:i,available:this._resourceManager.getGold(),buildingId:t}),e.abrupt("return",!1);case 13:if(e.prev=13,!this._gameService.isReady){e.next=17;break}return e.next=17,this._gameService.upgradeBuilding(this._currentCity.id,t);case 17:return e.next=19,this._resourceManager.spendGold(i,"building_upgrade");case 19:if(e.sent){e.next=22;break}throw new Error("Failed to spend gold for upgrade");case 22:if(r.upgrade()){e.next=27;break}return e.next=26,this._resourceManager.addGold(i,"upgrade_refund");case 26:throw new Error("Failed to upgrade building");case 27:return this.emit("buildingUpgradeSuccess",{buildingId:t,newLevel:r.level,costPaid:i,isMaxLevel:r.isMaxLevel()}),e.abrupt("return",!0);case 31:return e.prev=31,e.t0=e.catch(13),c("Building upgrade failed:",e.t0),this.emit("buildingUpgradeError",{buildingId:t,error:e.t0.message}),e.abrupt("return",!1);case 36:case"end":return e.stop()}}),e,this,[[13,31]])})));return function(t){return e.apply(this,arguments)}}(),a.getBuildingData=function(e){if(!this._currentCity)return null;var t=this._currentCity.getBuilding(e);if(!t)return null;var r=this._resourceManager?this._resourceManager.getGold():0,i=t.getUpgradeCost();return{buildingId:t.id,buildingName:t.name,currentLevel:t.level,maxLevel:t.maxLevel,upgradeCost:i,canUpgrade:t.canUpgrade()&&r>=i,isMaxLevel:t.isMaxLevel()}},a.getAllBuildingsData=function(){var e=this;return this._currentCity?this._currentCity.getBuildings().map((function(t){return e.getBuildingData(t.id)})).filter((function(e){return null!==e})):[]},a.getCityProgress=function(){return this._currentCity?{progress:this._currentCity.getCompletionProgress(),isCompleted:this._currentCity.isCompleted,completionReward:this._currentCity.completionReward,cityName:this._currentCity.name,cityLevel:this._currentCity.level}:{progress:0,isCompleted:!1,completionReward:0,cityName:"",cityLevel:1}},a.goBack=function(){this.emit("navigateToScene","Main")},a.onResourceChanged=function(e){this.emit("resourceUpdated",e),this.emit("buildingDataUpdated",this.getAllBuildingsData())},a.onInsufficientResources=function(e){this.emit("insufficientResources",e)},a.onBuildingUpgraded=function(e){this.emit("buildingUpgraded",e),this.emit("buildingDataUpdated",this.getAllBuildingsData()),this.emit("cityProgressUpdated",this.getCityProgress())},a.onCityCompleted=function(e){this.emit("cityCompleted",e),this.emit("showCityCompletion",{cityName:e.cityName,reward:e.reward})},a.onCurrentCityChanged=function(e){this._currentCity=e.city,this._currentCity&&(this._currentCity.on("buildingUpgraded",this.onBuildingUpgraded,this),this._currentCity.on("cityCompleted",this.onCityCompleted,this)),this.emit("currentCityChanged",e),this.loadCityData()},a.destroy=function(){this._resourceManager&&(this._resourceManager.off("resourceChanged",this.onResourceChanged,this),this._resourceManager.off("insufficientResources",this.onInsufficientResources,this)),this._currentCity&&(this._currentCity.off("buildingUpgraded",this.onBuildingUpgraded,this),this._currentCity.off("cityCompleted",this.onCityCompleted,this)),this._playerModel&&this._playerModel.off("currentCityChanged",this.onCurrentCityChanged,this),this._gameService=null,this._resourceManager=null,this._playerModel=null,this._currentCity=null,e.prototype.destroy.call(this)},r(s,[{key:"currentGold",get:function(){return this._resourceManager?this._resourceManager.getGold():0}},{key:"currentCityName",get:function(){return this._currentCity?this._currentCity.name:""}},{key:"currentCityLevel",get:function(){return this._currentCity?this._currentCity.level:1}},{key:"cityCompletionProgress",get:function(){return this._currentCity?this._currentCity.getCompletionProgress():0}},{key:"isCityCompleted",get:function(){return!!this._currentCity&&this._currentCity.isCompleted}},{key:"completionReward",get:function(){return this._currentCity?this._currentCity.completionReward:0}},{key:"totalUpgradeCost",get:function(){return this._currentCity?this._currentCity.getTotalUpgradeCost():0}},{key:"areAllBuildingsMaxLevel",get:function(){return!!this._currentCity&&this._currentCity.areAllBuildingsMaxLevel()}}]),s}(a));s._RF.pop()}}}));

System.register("chunks:///_virtual/ConfigScene.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,o,t,c,i;return{setters:[function(e){n=e.inheritsLoose},function(e){o=e.cclegacy,t=e._decorator,c=e.director,i=e.Component}],execute:function(){var r;o._RF.push({},"66d91NhnKdHrKQGSP28w7dY","ConfigScene",void 0);var u=t.ccclass;t.property,e("ConfigScene",u("ConfigScene")(r=function(e){function o(){return e.apply(this,arguments)||this}return n(o,e),o.prototype.onClickBtnPlay=function(){window.location.hostname.indexOf("onrender.com")>-1&&document.getElementById("fileSelectionContainer").remove();c.loadScene("Loading")},o}(i))||r);o._RF.pop()}}}));

System.register("chunks:///_virtual/DebugPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts"],(function(e){var o,t,n,i,l,s,r,a,g,u,c;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,s=e._decorator,r=e.Node,a=e.Label,g=e.Button,u=e.Component},function(e){c=e.logger}],execute:function(){var h,b,p,L,f,d,D,y,P,v,B,w,C,T,E;l._RF.push({},"ebfbcg9OqZACa/ny+s7m52s","DebugPanel",void 0);var x=s.ccclass,m=s.property;e("DebugPanel",(h=x("DebugPanel"),b=m(r),p=m(a),L=m(g),f=m(g),d=m(g),D=m(g),h((v=o((P=function(e){function o(){for(var o,t=arguments.length,l=new Array(t),s=0;s<t;s++)l[s]=arguments[s];return o=e.call.apply(e,[this].concat(l))||this,n(o,"debugContainer",v,i(o)),n(o,"logDisplay",B,i(o)),n(o,"showLogsButton",w,i(o)),n(o,"exportLogsButton",C,i(o)),n(o,"clearLogsButton",T,i(o)),n(o,"closeButton",E,i(o)),o._isVisible=!1,o}t(o,e);var l=o.prototype;return l.onLoad=function(){var e=this;this.setupUI(),this.bindEvents(),this.hidePanel(),globalThis.debugPanel=this,globalThis.showDebugPanel=function(){return e.showPanel()},globalThis.hideDebugPanel=function(){return e.hidePanel()},globalThis.exportLogs=function(){return e.exportLogs()},c.info("DebugPanel initialized - Use showDebugPanel() to open")},l.setupUI=function(){this.logDisplay&&(this.logDisplay.string="Debug logs will appear here...")},l.bindEvents=function(){this.showLogsButton&&this.showLogsButton.node.on(g.EventType.CLICK,this.refreshLogs,this),this.exportLogsButton&&this.exportLogsButton.node.on(g.EventType.CLICK,this.exportLogs,this),this.clearLogsButton&&this.clearLogsButton.node.on(g.EventType.CLICK,this.clearLogs,this),this.closeButton&&this.closeButton.node.on(g.EventType.CLICK,this.hidePanel,this)},l.showPanel=function(){this.debugContainer&&(this.debugContainer.active=!0,this._isVisible=!0,this.refreshLogs(),c.info("Debug panel opened"))},l.hidePanel=function(){this.debugContainer&&(this.debugContainer.active=!1,this._isVisible=!1,c.info("Debug panel closed"))},l.togglePanel=function(){this._isVisible?this.hidePanel():this.showPanel()},l.refreshLogs=function(){if(this.logDisplay){var e=c.getRecentLogs(20);this.logDisplay.string=e||"No logs available",c.info("Refreshed logs display ("+c.getLogsCount()+" total logs)")}},l.exportLogs=function(){try{c.exportToLocalStorage("coinmaster_debug_logs"),c.downloadLogs("coinmaster_debug.log");var e=c.getAllLogs();console.log("=== ALL DEBUG LOGS ==="),console.log(e),console.log("=== END DEBUG LOGS ==="),c.info("Logs exported successfully")}catch(e){c.error("Failed to export logs: "+e)}},l.clearLogs=function(){c.clear(),this.refreshLogs(),c.info("All logs cleared")},l.getLogsForCopy=function(){return c.getAllLogs()},l.onDestroy=function(){globalThis.debugPanel===this&&(delete globalThis.debugPanel,delete globalThis.showDebugPanel,delete globalThis.hideDebugPanel,delete globalThis.exportLogs)},o}(u)).prototype,"debugContainer",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=o(P.prototype,"logDisplay",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=o(P.prototype,"showLogsButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=o(P.prototype,"exportLogsButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=o(P.prototype,"clearLogsButton",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=o(P.prototype,"closeButton",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));globalThis.getDebugLogs=function(){var e=c.getAllLogs();return console.log("=== DEBUG LOGS ==="),console.log(e),console.log("=== END LOGS ==="),e},globalThis.getRecentDebugLogs=function(e){void 0===e&&(e=20);var o=c.getRecentLogs(e);return console.log("=== RECENT "+e+" DEBUG LOGS ==="),console.log(o),console.log("=== END LOGS ==="),o},l._RF.pop()}}}));

System.register("chunks:///_virtual/GameConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SlotMachineConfig.ts","./Logger.ts"],(function(n){var i,t,e,o,r,s,c,f,a,g,u;return{setters:[function(n){i=n.extends,t=n.createClass,e=n.asyncToGenerator,o=n.regeneratorRuntime},function(n){r=n.cclegacy,s=n.resources,c=n.JsonAsset},function(n){f=n.SlotMachineConfig},function(n){a=n.logError,g=n.logWarn,u=n.logInfo}],execute:function(){r._RF.push({},"4d9f60PXBJNyb5CfJnbSHGG","GameConfig",void 0),n("GameConfig",function(){function n(){this._config=void 0,this._isLoaded=!1}n.getInstance=function(){return n._instance||(n._instance=new n),n._instance};var r=n.prototype;return r.loadConfig=function(){var n=e(o().mark((function n(i){var t,e;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t=f.getInstance(),n.next=4,t.loadConfig();case 4:return n.next=6,this.loadDefaultConfig();case 6:e=n.sent,i?(this._config=this.mergeConfigs(e,i),u("Game config loaded from server")):(this._config=e,u("Using default game config")),this._config.slotMachine=t.getDefaultConfig(),this._isLoaded=!0,this.validateConfig(),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(0),a("Failed to load game config:",n.t0),this._config={},this._isLoaded=!0;case 18:case"end":return n.stop()}}),n,this,[[0,13]])})));return function(i){return n.apply(this,arguments)}}(),r.loadDefaultConfig=function(){return new Promise((function(n,i){s.load("config/game",c,(function(t,e){if(t)return a("Failed to load default game config:",t),i(t);n(e.json)}))}))},r.mergeConfigs=function(n,t){var e=i({},n);return Object.keys(t).forEach((function(n){void 0!==t[n]&&("object"!=typeof t[n]||Array.isArray(t[n])?e[n]=t[n]:e[n]=i({},e[n],t[n]))})),e},r.validateConfig=function(){if(!this._config.version)throw new Error("Config version is required");if(!this._config.slotMachine||!this._config.slotMachine.symbols||0===this._config.slotMachine.symbols.length)throw new Error("Slot machine configuration is invalid");if(!this._config.cities||0===this._config.cities.length)throw new Error("Cities configuration is required");var n=f.getInstance().validateConfig(this._config.slotMachine);n.isValid||g("Slot machine configuration validation failed:",n.errors)},r.getConfig=function(){return i({},this._config)},r.getSlotMachineConfig=function(){return i({},this._config.slotMachine)},r.getCityConfig=function(n){return this._config.cities.find((function(i){return i.level===n}))||null},r.getCityConfigs=function(){return[].concat(this._config.cities)},r.getBuildingConfig=function(n,i){var t=this.getCityConfig(n);return t&&t.buildings.find((function(n){return n.id===i}))||null},r.getAttackConfig=function(){return i({},this._config.attack)},r.getRaidConfig=function(){return i({},this._config.raid)},r.getMainEventConfigs=function(){return[].concat(this._config.mainEvents)},r.getActiveMainEvent=function(){var n=Date.now();return this._config.mainEvents.find((function(i){return i.isActive&&n>=i.startTime&&n<=i.endTime}))||null},r.getResourceConfig=function(){return i({},this._config.resources)},r.updateConfig=function(n){this._config=this.mergeConfigs(this._config,n),this.validateConfig()},r.resetToDefault=function(){var n=e(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.loadDefaultConfig();case 3:this._config=n.sent,this._isLoaded=!0,u("Game config reset to default"),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),a("Failed to reset game config to default:",n.t0);case 11:case"end":return n.stop()}}),n,this,[[0,8]])})));return function(){return n.apply(this,arguments)}}(),t(n,[{key:"isLoaded",get:function(){return this._isLoaded}},{key:"version",get:function(){return this._config.version}}]),n}())._instance=void 0,r._RF.pop()}}}));

System.register("chunks:///_virtual/GameService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseService.ts","./ServiceLocator.ts","./PlayerModel.ts","./GameConfig.ts","./Logger.ts"],(function(e){var t,r,n,a,i,o,s,c,u,l,p,d,h;return{setters:[function(e){t=e.inheritsLoose,r=e.createClass,n=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){i=e.cclegacy,o=e.log},function(e){s=e.BaseService},function(e){c=e.ServiceLocator},function(e){u=e.PlayerModel},function(e){l=e.GameConfig},function(e){p=e.logInfo,d=e.logError,h=e.logWarn}],execute:function(){i._RF.push({},"9752a1L7WVLfbHz4Q/KJfZp","GameService",void 0);var f=e("GameCommand",function(e){return e.GET_PLAYER_DATA="getPlayerData",e.UPDATE_PLAYER_DATA="updatePlayerData",e.SPIN_WHEEL="spinWheel",e.GET_SPIN_CONFIG="getSpinConfig",e.SPIN_SLOT_MACHINE="spinSlotMachine",e.GET_SLOT_MACHINE_CONFIG="getSlotMachineConfig",e.UPGRADE_BUILDING="upgradeBuilding",e.GET_CITY_DATA="getCityData",e.ATTACK_PLAYER="attackPlayer",e.GET_ATTACK_TARGET="getAttackTarget",e.RAID_PLAYER="raidPlayer",e.GET_RAID_TARGET="getRaidTarget",e.GET_MAIN_EVENT="getMainEvent",e.CLAIM_EVENT_MILESTONE="claimEventMilestone",e.COLLECT_RESOURCES="collectResources",e}({}));e("GameService",function(e){function i(){var t;return(t=e.call(this)||this)._networkService=null,t._playerModel=null,t._isOnline=!1,t._autoSaveInterval=null,t}t(i,e);var s=i.prototype;return s.getPlayerModel=function(){return this._playerModel},s.onInitialize=function(){var e=n(a().mark((function e(){var t,r,n,i=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p("Initializing Game Service..."),this._playerModel=new u,p("Player Model initialized in GameService"),n=c.getInstance(),this._networkService=n.getService("NetworkService"),this._networkService&&this._networkService.isConnected?(this._isOnline=!0,p("NetworkService found, starting in online mode"),this.setupNetworkEventListeners()):(this._isOnline=!1,h("NetworkService not found or not connected, starting in offline mode")),null==(t=this._networkService)||t.on("connection",(function(){return i.handleNetworkStatusChange(!0)})),null==(r=this._networkService)||r.on("connectionLost",(function(){return i.handleNetworkStatusChange(!1)})),e.next=10,this.loadPlayerData();case 10:this.startAutoSave(),p("Game Service initialized successfully");case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onConnect=function(){var e=n(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._networkService){e.next=2;break}throw new Error("NetworkService not available");case 2:p("Game Service ready for commands");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onDisconnect=function(){var e=n(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p("Game Service disconnected");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s.setupNetworkEventListeners=function(){this._networkService&&(this._networkService.on("extensionResponse",this.onExtensionResponse.bind(this)),this._networkService.on("connectionLost",this.onConnectionLost.bind(this)),this._networkService.on("loggedOut",this.onLoggedOut.bind(this)))},s.onExtensionResponse=function(e){switch(e.command){case"resourceUpdate":this.emit("resourceUpdate",e.data);break;case"eventUpdate":this.emit("eventUpdate",e.data);break;case"playerUpdate":this.emit("playerUpdate",e.data)}},s.onConnectionLost=function(e){this.emit("connectionLost",e)},s.onLoggedOut=function(){this.emit("loggedOut")},s.sendGameRequest=function(){var e=n(a().mark((function e(t,r,n){var i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p("Sending game command: "+t),this._networkService){e.next=4;break}return h("NetworkService not available, simulating response for command: "+t),e.abrupt("return",this.getMockResponse(t,r));case 4:return p("Sending game command: "+t+" passed"),i={command:t,data:r,timeout:n},e.next=8,this._networkService.sendRequest(i);case 8:if((o=e.sent).success){e.next=11;break}throw new Error(o.error||"Unknown server error");case 11:return e.abrupt("return",o.data);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),s.getMockResponse=function(e,t){switch(e){case f.GET_PLAYER_DATA:return{playerData:null};case f.SPIN_SLOT_MACHINE:return this.getMockSlotSpinResult((null==t?void 0:t.betMultiplier)||1);default:return{success:!0}}},s.getMockSlotSpinResult=function(e){for(var t=[{id:"gold1",type:"gold",value:10,weight:30},{id:"gold2",type:"gold",value:20,weight:25},{id:"energy1",type:"energy",value:5,weight:20}],r=[],n=0;n<3;n++){var a=Math.floor(Math.random()*t.length);r.push([t[a]])}var i=[],o=0,s=r[0][0],c=r.every((function(e){return e[0].type===s.type}));if(c){var u=3*s.value;o=u,i.push({paylineId:"line1",symbols:[s,r[1][0],r[2][0]],positions:[[0,0],[1,0],[2,0]],payout:u,multiplier:1})}var l=o*e,p="gold",d=l;return c?"attack"!==(p=s.type)&&"raid"!==p||(d=1):d=Math.floor(2*e),{slotSpinResult:{reelResults:r,winCombinations:i,totalPayout:l,betMultiplier:e,finalReward:{type:p,amount:d,multiplier:e}}}},s.getPlayerData=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_PLAYER_DATA);case 2:return t=e.sent,e.abrupt("return",t.playerData);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.updatePlayerData=function(){var e=n(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.UPDATE_PLAYER_DATA,{playerData:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.getSlotMachineConfig=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_SLOT_MACHINE_CONFIG);case 2:return t=e.sent,e.abrupt("return",t.slotMachineConfig);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.spinSlotMachine=function(){var e=n(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={betMultiplier:t},e.next=3,this.sendGameRequest(f.SPIN_SLOT_MACHINE,r);case 3:return n=e.sent,e.abrupt("return",n.slotSpinResult);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.upgradeBuilding=function(){var e=n(a().mark((function e(t,r){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={cityId:t,buildingId:r},e.next=3,this.sendGameRequest(f.UPGRADE_BUILDING,n);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s.getCityData=function(){var e=n(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_CITY_DATA,{cityId:t});case 2:return r=e.sent,e.abrupt("return",r.cityData);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.getAttackTarget=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_ATTACK_TARGET);case 2:return t=e.sent,e.abrupt("return",t.targetPlayer);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.attackPlayer=function(){var e=n(a().mark((function e(t,r){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={targetPlayerId:t,targetBuildingId:r},e.next=3,this.sendGameRequest(f.ATTACK_PLAYER,n);case 3:return i=e.sent,e.abrupt("return",i.attackResult);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s.getRaidTarget=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_RAID_TARGET);case 2:return t=e.sent,e.abrupt("return",t.targetPlayer);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.raidPlayer=function(){var e=n(a().mark((function e(t,r){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={targetPlayerId:t,chestIndex:r},e.next=3,this.sendGameRequest(f.RAID_PLAYER,n);case 3:return i=e.sent,e.abrupt("return",i.raidResult);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s.getMainEvent=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.GET_MAIN_EVENT);case 2:return t=e.sent,e.abrupt("return",t.mainEvent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.claimEventMilestone=function(){var e=n(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.CLAIM_EVENT_MILESTONE,{milestoneId:t});case 2:return r=e.sent,e.abrupt("return",r.claimResult);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.collectResources=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGameRequest(f.COLLECT_RESOURCES);case 2:return t=e.sent,e.abrupt("return",t.resources);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.handleNetworkStatusChange=function(e){this._isOnline!==e&&(this._isOnline=e,p("Network status changed. Online: "+e),e&&this.syncPlayerData())},s.syncPlayerData=function(){var e=n(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p("Syncing player data with server..."),this._playerModel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.getPlayerData();case 6:(t=e.sent)&&(this._playerModel.initializePlayerData(t),this.savePlayerDataToLocalStorage(t),p("Player data synced from server"),this.emit("playerDataSynced",t)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),d("Failed to sync player data from server:",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),s.startAutoSave=function(){var e=this;this._autoSaveInterval&&this.stopAutoSave();this._autoSaveInterval=window.setInterval((function(){e.savePlayerDataToLocalStorage()}),2e3),p("Auto-save started with frequency: 2000ms")},s.stopAutoSave=function(){this._autoSaveInterval&&(window.clearInterval(this._autoSaveInterval),this._autoSaveInterval=null,p("Auto-save stopped"))},s.savePlayerDataToLocalStorage=function(e){if(this._playerModel)try{var t=e||this._playerModel.toJSON();o("Player data to save:",t),t&&(localStorage.setItem("playerData",JSON.stringify(t)),p("Player data saved to local storage"))}catch(e){d("Failed to save player data to local storage:",e)}},s.loadPlayerDataFromLocalStorage=function(){try{var e=localStorage.getItem("playerData");if(e){var t=JSON.parse(e);return p("Player data loaded from local storage"),t}}catch(e){d("Failed to load player data from local storage:",e)}return null},s.loadPlayerData=function(){var e=n(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._playerModel){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this._isOnline){e.next=16;break}return p("Online mode: attempting to load player data from server..."),e.next=7,this.getPlayerData();case 7:if(!(t=e.sent)){e.next=15;break}return this._playerModel.initializePlayerData(t),this.savePlayerDataToLocalStorage(t),p("Player data loaded from server and saved to local storage"),e.abrupt("return");case 15:h("No player data found on server, falling back to local storage.");case 16:if(p("Offline mode or server fetch failed: attempting to load player data from local storage..."),!(r=this.loadPlayerDataFromLocalStorage())){e.next=22;break}return this._playerModel.initializePlayerData(r),p("Player data loaded from local storage"),e.abrupt("return");case 22:p("No local player data found, creating a new player."),this.createNewPlayer(),this.savePlayerDataToLocalStorage(),p("New player created and saved to local storage"),e.next=34;break;case 28:e.prev=28,e.t0=e.catch(2),d("An error occurred while loading player data:",e.t0),p("Falling back to creating a new player due to error."),this.createNewPlayer(),this.savePlayerDataToLocalStorage();case 34:case"end":return e.stop()}}),e,this,[[2,28]])})));return function(){return e.apply(this,arguments)}}(),s.createNewPlayer=function(){if(this._playerModel){var e=l.getInstance(),t=e.getResourceConfig(),r={id:this.generatePlayerId(),name:"Player",level:1,experience:0,resources:{gold:t.startingGold,energy:t.startingEnergy,maxEnergy:t.maxEnergy,lastEnergyRegenTime:Date.now()},currentCityId:"city_1",cities:[],mainEvent:e.getActiveMainEvent()||e.getMainEventConfigs()[0],lastLoginTime:Date.now(),createdTime:Date.now()};this._playerModel.initializePlayerData(r)}},s.generatePlayerId=function(){return"player_"+Date.now()+"_"+Math.floor(1e4*Math.random())},s.destroy=function(){this._networkService&&(this._networkService.off("extensionResponse",this.onExtensionResponse,this),this._networkService.off("connectionLost",this.onConnectionLost,this),this._networkService.off("loggedOut",this.onLoggedOut,this),this.stopAutoSave()),this._playerModel&&(this._playerModel.destroy(),this._playerModel=null),this._networkService=null,e.prototype.destroy.call(this)},r(i,[{key:"isReady",get:function(){return null!==this._networkService&&this._networkService.isConnectedToServer&&this._networkService.isLoggedIn}}]),i}(s));i._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc","./ResourceModel.ts","./BuildingModel.ts","./CityModel.ts","./MainEventModel.ts","./SlotMachineModel.ts","./PlayerModel.ts"],(function(e){var o;return{setters:[function(e){o=e.cclegacy},function(o){e("ResourceModel",o.ResourceModel)},function(o){e("BuildingModel",o.BuildingModel)},function(o){e("CityModel",o.CityModel)},function(o){e("MainEventModel",o.MainEventModel)},function(o){e("SlotMachineModel",o.SlotMachineModel)},function(o){e("PlayerModel",o.PlayerModel)}],execute:function(){o._RF.push({},"06454/e+ltIjrhCLhRcxKwZ","index",void 0),o._RF.pop()}}}));

System.register("chunks:///_virtual/index2.ts",["cc","./BaseModel.ts","./BaseViewModel.ts","./BaseView.ts","./BaseService.ts","./ServiceLocator.ts"],(function(e){var i;return{setters:[function(e){i=e.cclegacy},function(i){e("BaseModel",i.BaseModel)},function(i){e("BaseViewModel",i.BaseViewModel)},function(i){e("BaseView",i.BaseView)},function(i){e("BaseService",i.BaseService)},function(i){e("ServiceLocator",i.ServiceLocator)}],execute:function(){i._RF.push({},"b5bf01errtKNId1G/7OyEas","index",void 0),i._RF.pop()}}}));

System.register("chunks:///_virtual/index3.ts",["cc","./NetworkService.ts","./GameService.ts"],(function(e){var c;return{setters:[function(e){c=e.cclegacy},function(c){e("NetworkService",c.NetworkService)},function(c){var r={};r.GameCommand=c.GameCommand,r.GameService=c.GameService,e(r)}],execute:function(){c._RF.push({},"e9876k1nu5CMokcZ4rKNbYB","index",void 0),c._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./LoadingViewModel.ts","./Logger.ts"],(function(e){var i,o,t,n,r,a,s,l,d,g,u,h,p,c,L,w,b,f,M,v,V;return{setters:[function(e){i=e.applyDecoratedDescriptor,o=e.inheritsLoose,t=e.initializerDefineProperty,n=e.assertThisInitialized,r=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,d=e.Label,g=e.ProgressBar,u=e.Node,h=e.Button,p=e.director,c=e.Color},function(e){L=e.BaseView},function(e){w=e.LoadingStep,b=e.LoadingViewModel},function(e){f=e.logInfo,M=e.logWarn,v=e.logError,V=e.logDebug}],execute:function(){var m,y,C,_,E,I,U,P,S,R,B,z,D,k,T,x,H,O,A,F,G;s._RF.push({},"825f7fOjdlHnqNu8GP7dsDJ","LoadingView",void 0);var N=l.ccclass,j=l.property;e("LoadingView",(m=N("LoadingView"),y=j(d),C=j(d),_=j(d),E=j(g),I=j(u),U=j(u),P=j(d),S=j(h),R=j(u),m((D=i((z=function(e){function i(){var i;return i=e.call(this)||this,t(i,"titleLabel",D,n(i)),t(i,"messageLabel",k,n(i)),t(i,"progressLabel",T,n(i)),t(i,"progressBar",x,n(i)),t(i,"loadingContainer",H,n(i)),t(i,"errorContainer",O,n(i)),t(i,"errorLabel",A,n(i)),t(i,"retryButton",F,n(i)),t(i,"loadingSpinner",G,n(i)),i._viewModel=null,i._spinnerRotation=0,f("LoadingView: Constructor called"),i}o(i,e);var s=i.prototype;return s.onLoad=function(){f("LoadingView: onLoad called"),e.prototype.onLoad.call(this)},s.setupUI=function(){f("LoadingView: Setting up UI..."),this.showLoadingUI(),this.hideErrorUI(),this.titleLabel?(this.titleLabel.string="Coin Master",f("LoadingView: Title label set")):M("LoadingView: Title label not found"),this.messageLabel?(this.messageLabel.string="Initializing...",f("LoadingView: Message label set")):M("LoadingView: Message label not found"),this.progressLabel?(this.progressLabel.string="0%",f("LoadingView: Progress label set")):M("LoadingView: Progress label not found"),this.progressBar?(this.progressBar.progress=0,f("LoadingView: Progress bar set")):M("LoadingView: Progress bar not found"),this.startSpinnerAnimation(),f("LoadingView: UI setup complete")},s.bindEvents=function(){this.retryButton&&this.retryButton.node.on(h.EventType.CLICK,this.onRetryClicked,this)},s.updateUI=function(e,i,o){},s.refreshUI=function(){if(this._viewModel){var e=this._viewModel.getLoadingProgress();this.updateProgress(e)}},s.setViewModel=function(i){e.prototype.setViewModel.call(this,i),this._viewModel=i,this._viewModel&&(this._viewModel.on("progressUpdated",this.onProgressUpdated,this),this._viewModel.on("loadingComplete",this.onLoadingComplete,this),this._viewModel.on("loadingError",this.onLoadingError,this))},s.onProgressUpdated=function(e){f("LoadingView: Progress update received: "+e.step+" - "+Math.round(100*e.progress)+"% - "+e.message),this.updateProgress(e)},s.onLoadingComplete=function(e){this.hideLoadingUI(),this.scheduleOnce((function(){p.loadScene("Main",(function(e){e&&v("LoadingView: Failed to load Main scene:",e)}))}),.5)},s.onLoadingError=function(e){this.showErrorUI(),this.hideLoadingUI(),this.errorLabel&&(this.errorLabel.string=e.error||"An error occurred during loading")},s.updateProgress=function(e){var i=e.step,o=e.progress,t=e.message,n=e.error;f("LoadingView: Updating progress - "+i+" - "+Math.round(100*o)+"% - "+t),this.progressBar?(this.progressBar.progress=o,V("LoadingView: Progress bar updated to "+o)):M("LoadingView: Progress bar not available"),this.progressLabel?(this.progressLabel.string=Math.round(100*o)+"%",V("LoadingView: Progress label updated to "+Math.round(100*o)+"%")):M("LoadingView: Progress label not available"),this.messageLabel?(this.messageLabel.string=t,V("LoadingView: Message label updated to: "+t)):M("LoadingView: Message label not available"),i===w.ERROR&&n&&this.onLoadingError({error:n}),this.updateMessageColor(i)},s.updateMessageColor=function(e){if(this.messageLabel)switch(e){case w.ERROR:this.messageLabel.color=c.RED;break;case w.COMPLETE:this.messageLabel.color=c.GREEN;break;default:this.messageLabel.color=c.WHITE}},s.showLoadingUI=function(){this.loadingContainer&&(this.loadingContainer.active=!0)},s.hideLoadingUI=function(){this.loadingContainer&&(this.loadingContainer.active=!1)},s.showErrorUI=function(){this.errorContainer&&(this.errorContainer.active=!0)},s.hideErrorUI=function(){this.errorContainer&&(this.errorContainer.active=!1)},s.startSpinnerAnimation=function(){this.loadingSpinner&&this.schedule(this.updateSpinner,.016)},s.updateSpinner=function(){this.loadingSpinner&&this.loadingSpinner.active&&(this._spinnerRotation+=2.88,this._spinnerRotation>=360&&(this._spinnerRotation-=360),this.loadingSpinner.angle=-this._spinnerRotation)},s.onRetryClicked=function(){var e=r(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._viewModel){e.next=5;break}return this.showLoadingUI(),this.hideErrorUI(),e.next=5,this._viewModel.executeCommand("retry");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.start=function(){f("LoadingView: start() called"),this.onShow()},s.onShow=function(){f("LoadingView: onShow called"),e.prototype.onShow.call(this),this._viewModel?f("LoadingView: ViewModel already exists"):(f("LoadingView: Creating new LoadingViewModel"),this._viewModel=new b,this.setViewModel(this._viewModel),f("LoadingView: Initializing LoadingViewModel"),this._viewModel.initialize())},s.onHide=function(){e.prototype.onHide.call(this),this.unschedule(this.updateSpinner)},s.onDestroy=function(){this._viewModel&&(this._viewModel.off("progressUpdated",this.onProgressUpdated,this),this._viewModel.off("loadingComplete",this.onLoadingComplete,this),this._viewModel.off("loadingError",this.onLoadingError,this)),this.unschedule(this.updateSpinner),e.prototype.onDestroy.call(this)},i}(L)).prototype,"titleLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(z.prototype,"messageLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=i(z.prototype,"progressLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=i(z.prototype,"progressBar",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=i(z.prototype,"loadingContainer",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=i(z.prototype,"errorContainer",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=i(z.prototype,"errorLabel",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=i(z.prototype,"retryButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(z.prototype,"loadingSpinner",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=z))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseViewModel.ts","./ServiceLocator.ts","./NetworkService.ts","./GameService.ts","./ResourceManager.ts","./GameConfig.ts","./Logger.ts"],(function(e){var r,t,n,o,i,s,a,c,u,g,d,l,p;return{setters:[function(e){r=e.inheritsLoose,t=e.createClass,n=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){s=e.BaseViewModel},function(e){a=e.ServiceLocator},function(e){c=e.NetworkService},function(e){u=e.GameService},function(e){g=e.ResourceManager},function(e){d=e.GameConfig},function(e){l=e.logInfo,p=e.logError}],execute:function(){i._RF.push({},"1a2b2ZXLsVNQLsL8bEWOqXN","LoadingViewModel",void 0);var h=e("LoadingStep",function(e){return e.INITIALIZING="initializing",e.LOADING_RESOURCES="loading_resources",e.CONNECTING_SERVER="connecting_server",e.LOGGING_IN="logging_in",e.LOADING_CONFIG="loading_config",e.LOADING_PLAYER_DATA="loading_player_data",e.FINALIZING="finalizing",e.COMPLETE="complete",e.ERROR="error",e}({}));e("LoadingViewModel",function(e){function i(){var r;return(r=e.call(this)||this)._currentStep=h.INITIALIZING,r._progress=0,r._message="",r._error="",r._playerModel=null,r}r(i,e);var s=i.prototype;return s.onInitialize=function(){l("LoadingViewModel: onInitialize called");var e=new XMLHttpRequest;e.open("GET","https://github.com/temuchjn/remote-config-server/raw/refs/heads/main/paytable.json",!0),e.onload=function(){console.log(e.responseText)},e.send(),this.startLoadingProcess()},s.executeCommand=function(){var e=n(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next="retry"===e.t0?3:"getProgress"===e.t0?4:5;break;case 3:return e.abrupt("return",this.retryLoading());case 4:return e.abrupt("return",this.getLoadingProgress());case 5:throw new Error("Unknown command: "+r);case 6:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),s.startLoadingProcess=function(){var e=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l("LoadingViewModel: Starting loading process..."),e.prev=1,l("LoadingViewModel: Step 1 - Load resources"),e.next=5,this.loadResources();case 5:return l("LoadingViewModel: Step 2 - Load game config"),e.next=8,this.loadGameConfig();case 8:return l("LoadingViewModel: Step 3 - Initialize services"),e.next=11,this.initializeServices();case 11:return l("LoadingViewModel: Step 4 - Connect to server"),e.next=14,this.connectToServer();case 14:return l("LoadingViewModel: Step 5 - Login to server"),e.next=17,this.loginToServer();case 17:return l("LoadingViewModel: Step 6 - Load player data"),e.next=20,this.loadPlayerData();case 20:return l("LoadingViewModel: Step 7 - Finalize loading"),e.next=23,this.finalizeLoading();case 23:l("LoadingViewModel: Step 8 - Complete loading"),this.completeLoading(),e.next=31;break;case 27:e.prev=27,e.t0=e.catch(1),p("LoadingViewModel: Error in loading process:",e.t0),this.handleLoadingError(e.t0);case 31:case"end":return e.stop()}}),e,this,[[1,27]])})));return function(){return e.apply(this,arguments)}}(),s.initializeServices=function(){var e=n(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProgress(h.INITIALIZING,.3,"Initializing services..."),(r=a.getInstance()).registerService("NetworkService",new c),r.registerService("GameService",new u),r.registerService("ResourceManager",new g),e.next=7,r.initializeAllServices();case 7:this.updateProgress(h.INITIALIZING,.4,"Services initialized");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loadResources=function(){var e=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProgress(h.LOADING_RESOURCES,0,"Loading game resources..."),e.next=3,this.simulateAsyncOperation(1e3);case 3:this.updateProgress(h.LOADING_RESOURCES,.2,"Resources loaded");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.connectToServer=function(){var e=n(o().mark((function e(){var r,t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateProgress(h.CONNECTING_SERVER,.4,"Connecting to server..."),r=a.getInstance(),t=r.getService("NetworkService")){e.next=5;break}throw new Error("NetworkService not found");case 5:return n={host:"localhost",port:9933,zone:"CoinMaster",useSSL:!1,debug:!0},t.setConfig(n),e.next=9,t.connect();case 9:this.updateProgress(h.CONNECTING_SERVER,.55,"Connected to server");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loginToServer=function(){var e=n(o().mark((function e(){var r,t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateProgress(h.LOGGING_IN,.55,"Logging in..."),r=a.getInstance(),t=r.getService("NetworkService")){e.next=5;break}throw new Error("NetworkService not found");case 5:return n=this.generateUsername(),"",e.next=9,t.login(n,"");case 9:this.updateProgress(h.LOGGING_IN,.7,"Logged in successfully");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loadGameConfig=function(){var e=n(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateProgress(h.LOADING_CONFIG,.2,"Loading game configuration..."),(r=d.getInstance()).isLoaded){e.next=5;break}return e.next=5,r.loadConfig();case 5:this.updateProgress(h.LOADING_CONFIG,.3,"Configuration loaded");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.loadPlayerData=function(){var e=n(o().mark((function e(){var r,t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateProgress(h.LOADING_PLAYER_DATA,.7,"Loading player data..."),r=a.getInstance(),t=r.getService("GameService"),n=r.getService("ResourceManager"),this._playerModel=(null==t?void 0:t.getPlayerModel())||null,this._playerModel){e.next=8;break}throw p("Failed to get PlayerModel from GameService"),new Error("PlayerModel not available from GameService");case 8:if(!n){e.next=11;break}return e.next=11,n.connect();case 11:this.updateProgress(h.LOADING_PLAYER_DATA,.9,"Player data loaded");case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.finalizeLoading=function(){var e=n(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProgress(h.FINALIZING,.9,"Finalizing..."),r=a.getInstance(),e.next=4,r.connectAllServices();case 4:return e.next=6,this.simulateAsyncOperation(500);case 6:this.updateProgress(h.FINALIZING,1,"Ready to play!");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.completeLoading=function(){this.updateProgress(h.COMPLETE,1,"Loading complete!"),l("LoadingViewModel: Emitting loadingComplete event..."),this.emit("loadingComplete",{playerModel:this._playerModel}),l("LoadingViewModel: loadingComplete event emitted")},s.handleLoadingError=function(e){p("Loading error:",e),this._error=e.message||"Unknown error occurred",this.updateProgress(h.ERROR,this._progress,"Loading failed",this._error),this.emit("loadingError",{error:this._error})},s.retryLoading=function(){var e=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._error="",this._progress=0,this._currentStep=h.INITIALIZING,e.next=5,this.startLoadingProcess();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.updateProgress=function(e,r,t,n){this._currentStep=e,this._progress=r,this._message=t,n&&(this._error=n);var o={step:e,progress:r,message:t,error:n};l("LoadingViewModel: Emitting progressUpdated - "+e+" - "+Math.round(100*r)+"% - "+t),this.emit("progressUpdated",o),l("Loading: "+e+" - "+Math.round(100*r)+"% - "+t)},s.getLoadingProgress=function(){return{step:this._currentStep,progress:this._progress,message:this._message,error:this._error}},s.generateUsername=function(){return"Player_"+Date.now()+"_"+Math.floor(1e3*Math.random())},s.simulateAsyncOperation=function(e){return new Promise((function(r){setTimeout(r,e)}))},s.getPlayerModel=function(){return this._playerModel},t(i,[{key:"isComplete",get:function(){return this._currentStep===h.COMPLETE}},{key:"hasError",get:function(){return this._currentStep===h.ERROR}}]),i}(s));i._RF.pop()}}}));

System.register("chunks:///_virtual/Logger.ts",["cc"],(function(t){var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"3df77Qb219M0qX1GSsu2YDH","Logger",void 0);var o=t("Logger",function(){function t(){this._logs=[],this._maxLogs=1e3,this._enabled=!0}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var n=t.prototype;return n.log=function(t,n){if(void 0===n&&(n="INFO"),this._enabled){var o="["+(new Date).toISOString()+"] ["+n+"] "+t;this._logs.push(o),this._logs.length>this._maxLogs&&this._logs.shift(),console.log(o)}},n.info=function(t){this.log(t,"INFO")},n.warn=function(t){var n="";n="string"==typeof t?t:String(t);for(var o=arguments.length,e=new Array(o>1?o-1:0),r=1;r<o;r++)e[r-1]=arguments[r];e.length>0&&(n+=" "+e.map((function(t){return String(t)})).join(" ")),this.log(n,"WARN")},n.error=function(t){var n="";n="string"==typeof t?t:t instanceof Error?t.message:String(t);for(var o=arguments.length,e=new Array(o>1?o-1:0),r=1;r<o;r++)e[r-1]=arguments[r];e.length>0&&(n+=" "+e.map((function(t){return String(t)})).join(" ")),this.log(n,"ERROR")},n.debug=function(t){this.log(t,"DEBUG")},n.getAllLogs=function(){return this._logs.join("\n")},n.getRecentLogs=function(t){return void 0===t&&(t=50),this._logs.slice(-t).join("\n")},n.clear=function(){this._logs=[]},n.setEnabled=function(t){this._enabled=t},n.getLogsCount=function(){return this._logs.length},n.exportToLocalStorage=function(t){void 0===t&&(t="coinmaster_debug_logs");try{"undefined"!=typeof localStorage?(localStorage.setItem(t,this.getAllLogs()),this.info("Logs exported to localStorage with key: "+t)):this.warn("localStorage not available")}catch(t){this.error("Failed to export logs: "+t)}},n.downloadLogs=function(t){void 0===t&&(t="coinmaster_debug.log");try{var n=this.getAllLogs(),o=new Blob([n],{type:"text/plain"}),e=URL.createObjectURL(o),r=document.createElement("a");r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(e),this.info("Logs downloaded as: "+t)}catch(t){this.error("Failed to download logs: "+t)}},n.getLogsByCategory=function(t){return this._logs.filter((function(n){return n.includes("["+t+"]")})).join("\n")},n.searchLogs=function(t){return this._logs.filter((function(n){return n.toLowerCase().includes(t.toLowerCase())})).join("\n")},t}());o._instance=void 0;var e=t("logger",o.getInstance());t("logInfo",(function(t){return e.info(t)})),t("logWarn",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return e.warn.apply(e,[t].concat(o))})),t("logError",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return e.error.apply(e,[t].concat(o))})),t("logDebug",(function(t){return e.debug(t)}));n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./CheatComponent.ts","./ReelComponent.ts","./RevealWave.ts","./SlotMachineComponent.ts","./AnimationConfig.ts","./GameConfig.ts","./SlotMachineConfig.ts","./ResourceManagerExample.ts","./BaseModel.ts","./BaseService.ts","./BaseView.ts","./BaseViewModel.ts","./ServiceLocator.ts","./index2.ts","./ResourceManager.ts","./BuildingModel.ts","./CityModel.ts","./MainEventModel.ts","./PlayerModel.ts","./ResourceModel.ts","./SlotMachineModel.ts","./index.ts","./ConfigScene.ts","./PreviewDragonBone.ts","./AttackView.ts","./AttackViewModel.ts","./CityView.ts","./CityViewModel.ts","./LoadingView.ts","./LoadingViewModel.ts","./MainView.ts","./MainViewModel.ts","./RaidView.ts","./RaidViewModel.ts","./GameService.ts","./NetworkService.ts","./index3.ts","./SimpleCityModelTest.ts","./DebugPanel.ts","./Logger.ts","./SlotMachineUtils.ts","./StringUtils.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainEventModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseModel.ts"],(function(t){var e,i,n,s,r;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,n=t.createClass},function(t){s=t.cclegacy},function(t){r=t.BaseModel}],execute:function(){s._RF.push({},"05666IZHdRK264kHZAqXEKD","MainEventModel",void 0);t("MainEventModel",function(t){function s(){var e;return(e=t.call(this)||this).initializeDefaults(),e}e(s,t);var r=s.prototype;return r.initializeDefaults=function(){this.setData("id",""),this.setData("name",""),this.setData("description",""),this.setData("itemType",""),this.setData("currentItems",0),this.setData("milestones",[]),this.setData("isActive",!1),this.setData("startTime",0),this.setData("endTime",0)},r.addItems=function(t){this.isActive&&t>0&&(this.currentItems+=t,this.emit("itemsAdded",{amount:t,totalItems:this.currentItems,eventId:this.id}))},r.getCurrentMilestone=function(){for(var t,e=this.milestones,n=i(e);!(t=n()).done;){var s=t.value;if(!s.isClaimed)return s}return null},r.getNextMilestone=function(){for(var t,e=this.milestones,n=!1,s=i(e);!(t=s()).done;){var r=t.value;if(n&&!r.isClaimed)return r;r.isClaimed||(n=!0)}return null},r.canClaimCurrentMilestone=function(){var t=this.getCurrentMilestone();return null!==t&&this.currentItems>=t.requiredItems},r.claimCurrentMilestone=function(){var t=this.getCurrentMilestone();if(t&&this.canClaimCurrentMilestone()){var e=this.milestones,i=e.findIndex((function(e){return e.id===t.id}));if(i>=0)return e[i].isClaimed=!0,this.setData("milestones",[].concat(e)),this.emit("milestoneClaimed",{milestone:t,eventId:this.id}),t}return null},r.getCurrentMilestoneProgress=function(){var t=this.getCurrentMilestone();return t?Math.min(1,this.currentItems/t.requiredItems):1},r.getOverallProgress=function(){var t=this.milestones;return 0===t.length?0:t.filter((function(t){return t.isClaimed})).length/t.length},r.checkMilestoneProgress=function(){var t=this.getCurrentMilestone();t&&this.currentItems>=t.requiredItems&&this.emit("milestoneReached",{milestone:t,eventId:this.id})},r.getRemainingTime=function(){if(!this.isActive)return 0;var t=Date.now(),e=this.endTime;return Math.max(0,e-t)},r.hasExpired=function(){var t=Date.now(),e=this.endTime;return e>0&&t>e},r.initializeEvent=function(t){this.initialize(t),this.isActive&&this.emit("eventStarted",{eventId:this.id})},r.endEvent=function(){this.setData("isActive",!1),this.emit("eventEnded",{eventId:this.id})},r.validate=function(){var t=this.id,e=this.name,n=this.itemType,s=this.currentItems,r=this.milestones,a=this.startTime,u=this.endTime;if(!t||!e||!n||s<0)return!1;if(a>0&&u>0&&a>=u)return!1;if(!Array.isArray(r))return!1;for(var o,h=i(r);!(o=h()).done;){var m=o.value;if(!m.id||m.requiredItems<0||!m.reward)return!1}return!0},r.toJSON=function(){return{id:this.id,name:this.name,description:this.description,itemType:this.itemType,currentItems:this.currentItems,milestones:[].concat(this.milestones),isActive:this.getData("isActive")||!1,startTime:this.startTime,endTime:this.endTime}},r.fromJSON=function(t){this.initializeEvent(t)},n(s,[{key:"id",get:function(){return this.getData("id")||""}},{key:"name",get:function(){return this.getData("name")||""}},{key:"description",get:function(){return this.getData("description")||""}},{key:"itemType",get:function(){return this.getData("itemType")||""}},{key:"currentItems",get:function(){return this.getData("currentItems")||0},set:function(t){var e=this.currentItems;this.setData("currentItems",Math.max(0,t)),t>e&&this.checkMilestoneProgress()}},{key:"milestones",get:function(){return this.getData("milestones")||[]}},{key:"isActive",get:function(){var t=this.getData("isActive")||!1,e=Date.now(),i=this.getData("startTime")||0,n=this.getData("endTime")||0;return t&&e>=i&&e<=n}},{key:"startTime",get:function(){return this.getData("startTime")||0}},{key:"endTime",get:function(){return this.getData("endTime")||0}}]),s}(r));s._RF.pop()}}}));

System.register("chunks:///_virtual/MainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./MainViewModel.ts","./Logger.ts","./SlotMachineComponent.ts","./CheatComponent.ts"],(function(e){var t,i,n,o,a,r,s,l,c,u,h,d,f,p,v,w,g,y,M,b,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.SpriteAtlas,u=e.Label,h=e.Node,d=e.ProgressBar,f=e.Button,p=e.Tween,v=e.tween,w=e.director},function(e){g=e.BaseView},function(e){y=e.MainViewModel},function(e){M=e.logError},function(e){b=e.SlotMachineComponent},function(e){m=e.CheatComponent}],execute:function(){var R,C,_,L,E,k,N,B,T,D,z,S,V,x,P,U,I,A,F,G,K,q,Z,j,H,W,X,J,O,Q,Y,$,ee;s._RF.push({},"3976ax0WAxBZqcZXrh3/tDy","MainView",void 0);var te=l.ccclass,ie=l.property;e("MainView",(R=te("MainView"),C=ie([c]),_=ie(u),L=ie(u),E=ie(u),k=ie(u),N=ie(h),B=ie(h),T=ie(u),D=ie(u),z=ie(d),S=ie(f),V=ie(f),x=ie(h),P=ie(m),U=ie(u),R((F=t((A=function(e){function t(){var t;return t=e.call(this)||this,n(t,"spriteAtlases",F,o(t)),n(t,"goldLabel",G,o(t)),n(t,"energyLabel",K,o(t)),n(t,"energyRegenLabel",q,o(t)),n(t,"playerLevelLabel",Z,o(t)),n(t,"slotMachineNode",j,o(t)),n(t,"mainEventContainer",H,o(t)),n(t,"eventNameLabel",W,o(t)),n(t,"eventProgressLabel",X,o(t)),n(t,"eventProgressBar",J,o(t)),n(t,"claimMilestoneButton",O,o(t)),n(t,"cityButton",Q,o(t)),n(t,"notificationContainer",Y,o(t)),n(t,"cheatContainer",$,o(t)),n(t,"notificationLabel",ee,o(t)),t._viewModel=null,t._slotMachineComponent=null,t}i(t,e);var s=t.prototype;return s.onLoad=function(){e.prototype.onLoad.call(this),this._slotMachineComponent=this.slotMachineNode.getComponent(b)},s.start=function(){this.onShow()},s.setupUI=function(){try{this.updateResourceDisplay(),this.updateEventDisplay(),this.hideNotification(),this.startEnergyRegenTimer()}catch(e){M("MainView: Error during UI setup:",e)}},s.bindEvents=function(){this.claimMilestoneButton&&this.claimMilestoneButton.node.on(f.EventType.CLICK,this.onClaimMilestoneClicked,this),this.cityButton&&this.cityButton.node.on(f.EventType.CLICK,this.onCityClicked,this)},s.updateUI=function(e,t,i){},s.refreshUI=function(){this.updateResourceDisplay(),this.updateEventDisplay()},s.setViewModel=function(t){e.prototype.setViewModel.call(this,t),this._viewModel=t,this._viewModel&&(this.setupViewModelEvents(),this._slotMachineComponent&&this._slotMachineComponent.setViewModel(this._viewModel))},s.setupViewModelEvents=function(){this._viewModel&&(this._viewModel.on("dataLoaded",this.onDataLoaded,this),this._viewModel.on("resourceUpdated",this.onResourceUpdated,this),this._viewModel.on("milestoneReached",this.onMilestoneReached,this),this._viewModel.on("milestoneClaimed",this.onMilestoneClaimed,this),this._viewModel.on("insufficientEnergy",this.onInsufficientEnergy,this),this._viewModel.on("navigateToScene",this.onNavigateToScene,this),this._viewModel.on("attackRewardReceived",this.onAttackRewardReceived,this),this._viewModel.on("raidRewardReceived",this.onRaidRewardReceived,this),this._viewModel.on("spinCompleted",this.onSpinCompleted,this))},s.updateResourceDisplay=function(){if(this._viewModel){if(this.goldLabel&&(this.goldLabel.string=this.formatNumber(this._viewModel.currentGold)),this.energyLabel){var e=this._viewModel.currentEnergy>this._viewModel.maxEnergy?""+this._viewModel.currentEnergy:this._viewModel.currentEnergy+"/"+this._viewModel.maxEnergy;this.energyLabel.string=e}this.playerLevelLabel&&(this.playerLevelLabel.string=""+this._viewModel.playerLevel)}},s.updateEnergyRegenCountdown=function(){if(this._viewModel&&this.energyRegenLabel){var e=this._viewModel.getTimeUntilNextEnergyRegen();if(this._viewModel.currentEnergy>=this._viewModel.maxEnergy)this.energyRegenLabel.string="Full";else{var t=Math.ceil(e/1e3),i=Math.floor(t/60),n=t%60;this.energyRegenLabel.string=i>0?i+"m "+n+"s":n+"s"}}},s.startEnergyRegenTimer=function(){this.stopEnergyRegenTimer(),this.updateEnergyRegenCountdown(),this.schedule(this.updateEnergyRegenCountdown,1)},s.stopEnergyRegenTimer=function(){this.unschedule(this.updateEnergyRegenCountdown)},s.updateEventDisplay=function(){if(this._viewModel){if(this.eventProgressBar&&(this.eventProgressBar.progress=this._viewModel.eventProgress),this.eventProgressLabel){var e=Math.round(100*this._viewModel.eventProgress);this.eventProgressLabel.string=e+"%"}this.claimMilestoneButton&&(this.claimMilestoneButton.interactable=this._viewModel.canClaimMilestone)}},s.showNotification=function(e,t){var i=this;void 0===t&&(t=2),this.notificationContainer&&this.notificationLabel&&(this.notificationLabel.string=e,this.notificationContainer.active=!0,p.stopAllByTarget(this.notificationContainer),v(this.notificationContainer).delay(t).call((function(){i.hideNotification()})).start())},s.hideNotification=function(){this.notificationContainer&&(this.notificationContainer.active=!1)},s.formatNumber=function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},s.onDataLoaded=function(){this.refreshUI()},s.onResourceUpdated=function(){this.updateResourceDisplay(),this.startEnergyRegenTimer()},s.onSpinCompleted=function(e){var t=e.finalReward,i="";switch(t.type){case"gold":i="+"+t.amount+" Gold!";break;case"energy":i="+"+t.amount+" Energy!";break;case"event_item":i="+"+t.amount+" Event Items!";break;case"attack":i="Attack Unlocked!";break;case"raid":i="Raid Unlocked!"}this.showNotification(i),this.updateResourceDisplay()},s.onMilestoneReached=function(){this.showNotification("Milestone Reached! Claim your reward!"),this.updateEventDisplay()},s.onMilestoneClaimed=function(e){var t=e.milestone.reward;this.showNotification("Claimed: "+t.amount+" "+t.type+"!"),this.updateEventDisplay(),this.updateResourceDisplay()},s.onInsufficientEnergy=function(e){this.showNotification("Need "+e.required+" energy, have "+e.available)},s.onNavigateToScene=function(e){w.loadScene(e)},s.onAttackRewardReceived=function(){this.showNotification("Attack available! Tap Attack button!")},s.onRaidRewardReceived=function(){this.showNotification("Raid available! Tap Raid button!")},s.onClaimMilestoneClicked=function(){var e=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._viewModel){e.next=3;break}return e.next=3,this._viewModel.executeCommand("claimMilestone");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onCityClicked=function(){this._viewModel&&this._viewModel.executeCommand("navigateToCity")},s.onCheatClicked=function(){this.cheatContainer.show()},s.onShow=function(){e.prototype.onShow.call(this),this._viewModel||(this._viewModel=new y,this.setViewModel(this._viewModel),this._viewModel.initialize())},s.onDestroy=function(){this.stopEnergyRegenTimer(),this._viewModel&&(this._viewModel.off("dataLoaded",this.onDataLoaded,this),this._viewModel.off("resourceUpdated",this.onResourceUpdated,this),this._viewModel.off("milestoneReached",this.onMilestoneReached,this),this._viewModel.off("milestoneClaimed",this.onMilestoneClaimed,this),this._viewModel.off("insufficientEnergy",this.onInsufficientEnergy,this),this._viewModel.off("navigateToScene",this.onNavigateToScene,this),this._viewModel.off("attackRewardReceived",this.onAttackRewardReceived,this),this._viewModel.off("raidRewardReceived",this.onRaidRewardReceived,this),this._viewModel.off("spinCompleted",this.onSpinCompleted,this)),e.prototype.onDestroy.call(this)},t}(g)).prototype,"spriteAtlases",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),G=t(A.prototype,"goldLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(A.prototype,"energyLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(A.prototype,"energyRegenLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(A.prototype,"playerLevelLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(A.prototype,"slotMachineNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(A.prototype,"mainEventContainer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(A.prototype,"eventNameLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(A.prototype,"eventProgressLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(A.prototype,"eventProgressBar",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(A.prototype,"claimMilestoneButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(A.prototype,"cityButton",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(A.prototype,"notificationContainer",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(A.prototype,"cheatContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(A.prototype,"notificationLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=A))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/MainViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseViewModel.ts","./ServiceLocator.ts","./PlayerModel.ts","./SlotMachineModel.ts","./GameConfig.ts","./AnimationConfig.ts","./Logger.ts","./StringUtils.ts"],(function(e){var t,i,n,r,a,s,o,l,u,c,h,d,M,p;return{setters:[function(e){t=e.inheritsLoose,i=e.createClass,n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){a=e.cclegacy},function(e){s=e.BaseViewModel},function(e){o=e.ServiceLocator},function(e){l=e.PlayerModel},function(e){u=e.SlotMachineModel,c=e.SlotRewardType},function(e){h=e.GameConfig},function(e){d=e.AnimationConfig},function(e){M=e.logError},function(e){p=e.StringUtils}],execute:function(){a._RF.push({},"e4de49BZ0lFgpMLiS3rhzFI","MainViewModel",void 0);e("MainViewModel",function(e){function a(){var t;return(t=e.call(this)||this)._gameService=null,t._resourceManager=null,t._playerModel=null,t._slotMachineModel=null,t._mainEventModel=null,t._animationConfig=null,t}t(a,e);var s=a.prototype;return s.onInitialize=function(){this.setupServices(),this.setupModels(),this.setupEventListeners(),this.loadInitialData()},s.setupServices=function(){var e=o.getInstance();this._gameService=e.getService("GameService"),this._resourceManager=e.getService("ResourceManager"),this._animationConfig=d.getInstance(),this._gameService||M("GameService not found"),this._resourceManager||M("ResourceManager not found")},s.setupModels=function(){var e=o.getInstance().getService("GameService");e&&(this._playerModel=e.getPlayerModel()),this._playerModel||(M("MainViewModel failed to get PlayerModel from GameService. This is a critical error."),this._playerModel=new l),this._slotMachineModel=new u,this._playerModel&&(this._mainEventModel=this._playerModel.mainEvent)},s.setupEventListeners=function(){this._resourceManager&&(this._resourceManager.on("resourceChanged",this.onResourceChanged,this),this._resourceManager.on("insufficientResources",this.onInsufficientResources,this)),this._slotMachineModel&&(this._slotMachineModel.on("spinStarted",this.onSpinStarted,this),this._slotMachineModel.on("spinCompleted",this.onSpinCompleted,this),this._slotMachineModel.on("autoSpinStateChanged",this.onAutoSpinStateChanged,this)),this._mainEventModel&&(this._mainEventModel.on("itemsAdded",this.onEventItemsAdded,this),this._mainEventModel.on("milestoneReached",this.onMilestoneReached,this),this._mainEventModel.on("milestoneClaimed",this.onMilestoneClaimed,this)),this._playerModel&&(this._playerModel.on("levelUp",this.onPlayerLevelUp,this),this._playerModel.on("currentCityChanged",this.onCurrentCityChanged,this))},s.loadInitialData=function(){var e=n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadSlotMachineConfig();case 3:return e.next=5,this.refreshPlayerData();case 5:this.emit("dataLoaded"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),M("Failed to load initial data:",e.t0),this.emit("dataLoadError",e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),s.loadSlotMachineConfig=function(){var e=n(r().mark((function e(){var t,i,n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._slotMachineModel){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this._gameService||!this._gameService.isReady){e.next=9;break}return e.next=6,this._gameService.getSlotMachineConfig();case 6:t=e.sent,e.next=11;break;case 9:i=h.getInstance(),t=i.getSlotMachineConfig();case 11:this._slotMachineModel.loadConfiguration(t),this.emit("slotMachineConfigLoaded",t),e.next=21;break;case 15:e.prev=15,e.t0=e.catch(2),M("Failed to load slot machine config:",e.t0),n=h.getInstance(),a=n.getSlotMachineConfig(),this._slotMachineModel.loadConfiguration(a);case 21:case"end":return e.stop()}}),e,this,[[2,15]])})));return function(){return e.apply(this,arguments)}}(),s.refreshPlayerData=function(){var e=n(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._playerModel){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this._gameService||!this._gameService.isReady){e.next=8;break}return e.next=6,this._gameService.getPlayerData();case 6:t=e.sent,this._playerModel.initializePlayerData(t);case 8:this.emit("playerDataRefreshed"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),M("Failed to refresh player data:",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),s.executeCommand=function(){var e=n(r().mark((function e(t){var i=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="spin"===e.t0?3:"setBetMultiplier"===e.t0?4:"increaseBetMultiplier"===e.t0?5:"decreaseBetMultiplier"===e.t0?6:"changeBetMultiplier"===e.t0?7:"claimMilestone"===e.t0?8:"navigateToCity"===e.t0?9:"navigateToAttack"===e.t0?10:"navigateToRaid"===e.t0?11:"startAutoSpin"===e.t0?12:"stopAutoSpin"===e.t0?13:"refreshData"===e.t0?14:15;break;case 3:return e.abrupt("return",this.performSpin());case 4:return e.abrupt("return",this.setBetMultiplier(i.length<=1?void 0:i[1]));case 5:return e.abrupt("return",this.increaseBetMultiplier());case 6:return e.abrupt("return",this.decreaseBetMultiplier());case 7:return e.abrupt("return",this.changeBetMultiplier());case 8:return e.abrupt("return",this.claimEventMilestone());case 9:return e.abrupt("return",this.navigateToCity());case 10:return e.abrupt("return",this.navigateToAttack());case 11:return e.abrupt("return",this.navigateToRaid());case 12:return e.abrupt("return",this.startAutoSpin());case 13:return e.abrupt("return",this.stopAutoSpin());case 14:return e.abrupt("return",this.refreshPlayerData());case 15:throw new Error("Unknown command: "+t);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.performSpin=function(){var e=n(r().mark((function e(){var t,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._slotMachineModel&&this._resourceManager&&this._gameService){e.next=2;break}return e.abrupt("return",null);case 2:if(!this._slotMachineModel.isSpinning){e.next=4;break}return e.abrupt("return",null);case 4:if(t=this._slotMachineModel.getTotalEnergyCost(),this._resourceManager.hasEnoughEnergy(t)){e.next=8;break}return this.emit("insufficientEnergy",{required:t,available:this._resourceManager.getEnergy()}),e.abrupt("return",null);case 8:return e.prev=8,e.next=11,this._resourceManager.spendEnergy(t,"slot_machine");case 11:return i=this._slotMachineModel.generateSpinResult(),this._slotMachineModel.startSpin(i),e.abrupt("return",i);case 16:return e.prev=16,e.t0=e.catch(8),M("Spin failed:",e.t0),e.next=21,this._resourceManager.addEnergy(t,"spin_refund");case 21:return this._slotMachineModel.resetSpin(),this.emit("spinError",e.t0),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(){return e.apply(this,arguments)}}(),s.setBetMultiplier=function(e){return!!this._slotMachineModel&&(!!this._slotMachineModel.availableMultipliers.includes(e)&&(this._slotMachineModel.selectedMultiplier=e,this.emit("betMultiplierChanged",e),!0))},s.increaseBetMultiplier=function(){if(!this._slotMachineModel||!this._resourceManager)return!1;var e=[1,2,5,10,20,40,50,100,250],t=this._slotMachineModel.selectedMultiplier,i=e.indexOf(t);if(-1===i)return!1;if(i>=e.length-1)return!1;var n=e[i+1],r=this._slotMachineModel.energyCostPerSpin*n,a=this._resourceManager.getEnergy();return r>a?(this.emit("betMultiplierIncreaseBlocked",{requiredEnergy:r,availableEnergy:a,blockedMultiplier:n}),!1):(this._slotMachineModel.selectedMultiplier=n,this.emit("betMultiplierChanged",this._slotMachineModel.selectedMultiplier),!0)},s.decreaseBetMultiplier=function(){if(!this._slotMachineModel)return!1;var e=[1,2,5,10,20,40,50,100,250],t=this._slotMachineModel.selectedMultiplier,i=e.indexOf(t);return-1!==i&&(i>0&&(this._slotMachineModel.selectedMultiplier=e[i-1],this.emit("betMultiplierChanged",this._slotMachineModel.selectedMultiplier),!0))},s.changeBetMultiplier=function(){if(!this._slotMachineModel||!this._resourceManager)return!1;var e=[1,2,5,10,20,40,50,100,250],t=this._slotMachineModel.selectedMultiplier,i=e.indexOf(t);if(-1===i)return this._slotMachineModel.selectedMultiplier=e[0],this.emit("betMultiplierChanged",this._slotMachineModel.selectedMultiplier),!0;var n=e[(i+1)%e.length];return this._slotMachineModel.energyCostPerSpin*n>this._resourceManager.getEnergy()&&(n=e[0]),this._slotMachineModel.selectedMultiplier=n,this.emit("betMultiplierChanged",this._slotMachineModel.selectedMultiplier),!0},s.claimEventMilestone=function(){var e=n(r().mark((function e(){var t,i,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._mainEventModel&&this._gameService){e.next=2;break}return e.abrupt("return",!1);case 2:if((t=this._mainEventModel.getCurrentMilestone())&&this._mainEventModel.canClaimCurrentMilestone()){e.next=5;break}return e.abrupt("return",!1);case 5:return e.prev=5,e.next=8,this._gameService.claimEventMilestone(t.id);case 8:if(!(i=this._mainEventModel.claimCurrentMilestone())||!this._resourceManager){e.next=19;break}if("gold"!==(n=i.reward).type){e.next=16;break}return e.next=14,this._resourceManager.addGold(n.amount,"event_milestone");case 14:e.next=19;break;case 16:if("energy"!==n.type){e.next=19;break}return e.next=19,this._resourceManager.addEnergy(n.amount,"event_milestone");case 19:return e.abrupt("return",!0);case 22:return e.prev=22,e.t0=e.catch(5),M("Failed to claim milestone:",e.t0),this.emit("milestoneClaimError",e.t0),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(){return e.apply(this,arguments)}}(),s.navigateToCity=function(){this.emit("navigateToScene","City")},s.navigateToAttack=function(){this.emit("navigateToScene","Attack")},s.navigateToRaid=function(){this.emit("navigateToScene","Raid")},s.onResourceChanged=function(e){this.emit("resourceUpdated",e)},s.onInsufficientResources=function(e){this.emit("insufficientResources",e)},s.onSpinStarted=function(e){this.emit("spinStarted",e)},s.onSpinCompleted=function(e){var t,i=this;if(this.processSpinReward(e),this.emit("spinCompleted",e),null!=(t=this._slotMachineModel)&&t.isAutoSpinPending)if(this._resourceManager&&this._slotMachineModel.canAffordSpin(this._resourceManager.getEnergy())){if(this._slotMachineModel.activatePendingAutoSpin()){var n=this._animationConfig.getUIConfig().autoSpinDelay;setTimeout((function(){return i.performSpin()}),n)}}else this._slotMachineModel.clearPendingAutoSpin();else if(this.isAutoSpinning&&this._slotMachineModel&&this._resourceManager)if(this._slotMachineModel.canContinueAutoSpin(this._resourceManager.getEnergy())){var r=this._animationConfig.getUIConfig().autoSpinDelay;setTimeout((function(){return i.performSpin()}),r)}else this._slotMachineModel.stopAutoSpinDueToInsufficientEnergy()},s.startAutoSpin=function(){var e;if(this._slotMachineModel&&this._resourceManager&&(null==(e=this._slotMachineModel.autoSpinState)||!e.isActive)){var t=this._slotMachineModel.getTotalEnergyCost();this._resourceManager.hasEnoughEnergy(t)?this._slotMachineModel.isSpinning?this._slotMachineModel.queueAutoSpin():(this._slotMachineModel.startAutoSpin(),this.performSpin()):this._slotMachineModel.stopAutoSpinDueToInsufficientEnergy()}},s.stopAutoSpin=function(){this._slotMachineModel&&(this._slotMachineModel.clearPendingAutoSpin(),this._slotMachineModel.stopAutoSpin())},s.processSpinReward=function(){var e=n(r().mark((function e(t){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resourceManager&&this._mainEventModel){e.next=2;break}return e.abrupt("return");case 2:i=t.finalReward,e.prev=3,e.t0=i.type,e.next=e.t0===c.GOLD?7:e.t0===c.ENERGY?10:e.t0===c.TOKEN?13:e.t0===c.ATTACK?15:e.t0===c.STEAL?17:e.t0===c.SHIELD?19:20;break;case 7:return e.next=9,this._resourceManager.addGold(i.amount,"spin_reward");case 9:return e.abrupt("break",20);case 10:return e.next=12,this._resourceManager.addEnergy(i.amount,"spin_reward");case 12:return e.abrupt("break",20);case 13:return this._mainEventModel.addItems(i.amount),e.abrupt("break",20);case 15:return this.emit("attackRewardReceived"),e.abrupt("break",20);case 17:return this.emit("raidRewardReceived"),e.abrupt("break",20);case 19:return e.abrupt("break",20);case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(3),M("Failed to process spin reward:",e.t1);case 25:case"end":return e.stop()}}),e,this,[[3,22]])})));return function(t){return e.apply(this,arguments)}}(),s.onEventItemsAdded=function(e){this.emit("eventItemsAdded",e)},s.onMilestoneReached=function(e){this.emit("milestoneReached",e)},s.onMilestoneClaimed=function(e){this.emit("milestoneClaimed",e)},s.onPlayerLevelUp=function(e){this.emit("playerLevelUp",e)},s.onCurrentCityChanged=function(e){this.emit("currentCityChanged",e)},s.processSpinResultFromComponent=function(e){this._slotMachineModel&&this._slotMachineModel.processSpinResult(e)},s.onAutoSpinStateChanged=function(e){var t,i=e.reason;if("STARTED"===i)null==(t=this._animationConfig)||t.setProfile("autoSpin"),this.emit("animationProfileChanged","autoSpin");else if("STOPPED_USER"===i||"STOPPED_NO_ENERGY"===i){var n;null==(n=this._animationConfig)||n.setProfile("normal"),this.emit("animationProfileChanged","normal")}this.emit("autoSpinStateChanged",e)},s.getTimeUntilNextEnergyRegen=function(){return this._resourceManager?this._resourceManager.getTimeUntilNextEnergyRegen():0},s.getDisplayResultText=function(e){var t=p.formatNumberWithCommas(e.finalReward.amount)+" "+e.finalReward.type;return e.finalReward.type!=c.ATTACK&&e.finalReward.type!=c.STEAL||(t=(""+e.finalReward.type).toUpperCase()),t},s.destroy=function(){this._resourceManager&&(this._resourceManager.off("resourceChanged",this.onResourceChanged,this),this._resourceManager.off("insufficientResources",this.onInsufficientResources,this)),this._slotMachineModel&&(this._slotMachineModel.off("spinStarted",this.onSpinStarted,this),this._slotMachineModel.off("spinCompleted",this.onSpinCompleted,this),this._slotMachineModel.off("autoSpinStateChanged",this.onAutoSpinStateChanged,this)),this._mainEventModel&&(this._mainEventModel.off("itemsAdded",this.onEventItemsAdded,this),this._mainEventModel.off("milestoneReached",this.onMilestoneReached,this),this._mainEventModel.off("milestoneClaimed",this.onMilestoneClaimed,this)),this._playerModel&&(this._playerModel.off("levelUp",this.onPlayerLevelUp,this),this._playerModel.off("currentCityChanged",this.onCurrentCityChanged,this)),this._gameService=null,this._resourceManager=null,this._playerModel=null,this._slotMachineModel=null,this._mainEventModel=null,e.prototype.destroy.call(this)},i(a,[{key:"currentGold",get:function(){return this._resourceManager?this._resourceManager.getGold():0}},{key:"currentEnergy",get:function(){return this._resourceManager?this._resourceManager.getEnergy():0}},{key:"maxEnergy",get:function(){return this._resourceManager?this._resourceManager.getMaxEnergy():50}},{key:"currentBetMultiplier",get:function(){return this._slotMachineModel?this._slotMachineModel.selectedMultiplier:1}},{key:"availableBetMultipliers",get:function(){return this._slotMachineModel?this._slotMachineModel.availableMultipliers:[1]}},{key:"symbols",get:function(){return this._slotMachineModel?this._slotMachineModel.symbols:[]}},{key:"spinEnergyCost",get:function(){return this._slotMachineModel?this._slotMachineModel.getTotalEnergyCost():1}},{key:"isSpinning",get:function(){return!!this._slotMachineModel&&this._slotMachineModel.isSpinning}},{key:"lastSpinResult",get:function(){return this._slotMachineModel?this._slotMachineModel.lastSpinResult:null}},{key:"isAutoSpinning",get:function(){var e;return(null==(e=this._slotMachineModel)||null==(e=e.autoSpinState)?void 0:e.isActive)||!1}},{key:"isAutoSpinPending",get:function(){var e;return(null==(e=this._slotMachineModel)?void 0:e.isAutoSpinPending)||!1}},{key:"autoSpinState",get:function(){return this._slotMachineModel?this._slotMachineModel.autoSpinState:null}},{key:"eventProgress",get:function(){return this._mainEventModel?this._mainEventModel.getCurrentMilestoneProgress():0}},{key:"canClaimMilestone",get:function(){return!!this._mainEventModel&&this._mainEventModel.canClaimCurrentMilestone()}},{key:"playerLevel",get:function(){return this._playerModel?this._playerModel.level:1}}]),a}(s));a._RF.pop()}}}));

System.register("chunks:///_virtual/NetworkService.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseService.ts","./Logger.ts"],(function(e){var t,n,r,s,o,i,a,u,c,S;return{setters:[function(e){t=e.inheritsLoose,n=e.createForOfIteratorHelperLoose,r=e.createClass,s=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){a=e.BaseService},function(e){u=e.logInfo,c=e.logError,S=e.logWarn}],execute:function(){i._RF.push({},"ebba7QrxxFKZr7VmwX12Q9d","NetworkService",void 0);e("NetworkService",function(e){function i(){var t;return(t=e.call(this)||this)._sfs=null,t._config=null,t._pendingRequests=new Map,t._requestIdCounter=0,t}t(i,e);var a=i.prototype;return a.onInitialize=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u("Initializing Network Service..."),"undefined"!=typeof SFS2X?(this._sfs=new SFS2X.SmartFox,this.setupSmartFoxEvents(),u("SmartFox initialized successfully")):S("SmartFox library not found, running in offline mode");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.setupSmartFoxEvents=function(){this._sfs&&(this._sfs.addEventListener(SFS2X.SFSEvent.CONNECTION,this.onConnection.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.CONNECTION_LOST,this.onConnectionLost.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.LOGIN,this.onLogin.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.LOGIN_ERROR,this.onLoginError.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.LOGOUT,this.onLogout.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.EXTENSION_RESPONSE,this.onExtensionResponse.bind(this)),this._sfs.addEventListener(SFS2X.SFSEvent.SOCKET_ERROR,this.onSocketError.bind(this)))},a.onConnect=function(){var e=s(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(!t._sfs)return S("SmartFox not available, skipping connection"),void e();if(!t._config)return S("SmartFox config not set, skipping connection"),void e();u("Connecting to SmartFox server: "+t._config.host+":"+t._config.port);var r=setTimeout((function(){t._sfs.removeEventListener(SFS2X.SFSEvent.CONNECTION,s),t._sfs.removeEventListener(SFS2X.SFSEvent.SOCKET_ERROR,o),S("Connection timeout, continuing in offline mode"),e()}),5e3),s=function n(){clearTimeout(r),t._sfs.removeEventListener(SFS2X.SFSEvent.CONNECTION,n),t._sfs.removeEventListener(SFS2X.SFSEvent.SOCKET_ERROR,o),u("Successfully connected to SmartFox server"),e()},o=function n(o){clearTimeout(r),t._sfs.removeEventListener(SFS2X.SFSEvent.CONNECTION,s),t._sfs.removeEventListener(SFS2X.SFSEvent.SOCKET_ERROR,n),S("Connection failed: "+o.data+", continuing in offline mode"),e()};t._sfs.addEventListener(SFS2X.SFSEvent.CONNECTION,s),t._sfs.addEventListener(SFS2X.SFSEvent.SOCKET_ERROR,o);try{t._sfs.connect(t._config.host,t._config.port)}catch(t){clearTimeout(r),S("Connection error: "+t+", continuing in offline mode"),e()}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.onDisconnect=function(){var e=s(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(t._sfs&&t._sfs.isConnected){t._sfs.addEventListener(SFS2X.SFSEvent.CONNECTION_LOST,(function n(){t._sfs.removeEventListener(SFS2X.SFSEvent.CONNECTION_LOST,n),e()})),t._sfs.disconnect()}else e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.setConfig=function(e){this._config=e},a.login=function(){var e=s(o().mark((function e(t,n,r){var s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),e.abrupt("return",new Promise((function(e,o){var i;if(!s._sfs)return S("SmartFox not available, simulating login success"),void e({user:{name:t,id:Math.floor(1e4*Math.random()),isGuest:!0},zone:r||"CoinMaster"});if(!s._sfs.isConnected)return S("Not connected to server, simulating login success"),void e({user:{name:t,id:Math.floor(1e4*Math.random()),isGuest:!0},zone:r||"CoinMaster"});var a=r||(null==(i=s._config)?void 0:i.zone)||"BasicExamples",u=setTimeout((function(){s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN,c),s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN_ERROR,f),S("Login timeout, simulating login success"),e({user:{name:t,id:Math.floor(1e4*Math.random()),isGuest:!0},zone:a})}),5e3),c=function t(n){clearTimeout(u),s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN,t),s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN_ERROR,f),e(n.data)},f=function n(r){clearTimeout(u),s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN,c),s._sfs.removeEventListener(SFS2X.SFSEvent.LOGIN_ERROR,n),S("Login failed: "+r.data.errorMessage+", simulating login success"),e({user:{name:t,id:Math.floor(1e4*Math.random()),isGuest:!0},zone:a})};s._sfs.addEventListener(SFS2X.SFSEvent.LOGIN,c),s._sfs.addEventListener(SFS2X.SFSEvent.LOGIN_ERROR,f);try{s._sfs.send(new SFS2X.LoginRequest(t,n,null,a))}catch(n){clearTimeout(u),S("Login error: "+n+", simulating login success"),e({user:{name:t,id:Math.floor(1e4*Math.random()),isGuest:!0},zone:a})}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),a.sendRequest=function(){var e=s(o().mark((function e(t){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(n._sfs&&n._sfs.isConnected){var s=n.generateRequestId(),o=t.timeout||1e4,i=setTimeout((function(){n._pendingRequests.delete(s),r(new Error("Request timeout: "+t.command))}),o);n._pendingRequests.set(s,{resolve:function(t){clearTimeout(i),e(t)},reject:function(e){clearTimeout(i),r(e)},timeout:i});var a=new SFS2X.SFSObject;if(a.putUtfString("requestId",s),t.data)for(var u in t.data)n.putDataToSFSObject(a,u,t.data[u]);var c=new SFS2X.ExtensionRequest(t.command,a);n._sfs.send(c)}else r(new Error("Not connected to server"))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.generateRequestId=function(){return"req_"+ ++this._requestIdCounter+"_"+Date.now()},a.putDataToSFSObject=function(e,t,r){if(null!=r)switch(typeof r){case"string":e.putUtfString(t,r);break;case"number":Number.isInteger(r)?e.putInt(t,r):e.putDouble(t,r);break;case"boolean":e.putBool(t,r);break;case"object":if(Array.isArray(r)){for(var s,o=new SFS2X.SFSArray,i=n(r);!(s=i()).done;){var a=s.value;this.addDataToSFSArray(o,a)}e.putSFSArray(t,o)}else{var u=new SFS2X.SFSObject;for(var c in r)this.putDataToSFSObject(u,c,r[c]);e.putSFSObject(t,u)}}},a.addDataToSFSArray=function(e,t){if(null!=t)switch(typeof t){case"string":e.addUtfString(t);break;case"number":Number.isInteger(t)?e.addInt(t):e.addDouble(t);break;case"boolean":e.addBool(t);break;case"object":if(Array.isArray(t)){for(var r,s=new SFS2X.SFSArray,o=n(t);!(r=o()).done;){var i=r.value;this.addDataToSFSArray(s,i)}e.addSFSArray(s)}else{var a=new SFS2X.SFSObject;for(var u in t)this.putDataToSFSObject(a,u,t[u]);e.addSFSObject(a)}}},a.sfsObjectToPlainObject=function(e){if(!e)return null;for(var t,r={},s=e.getKeys(),o=n(s);!(t=o()).done;){var i=t.value,a=e.get(i);r[i]=this.convertSFSValue(a)}return r},a.convertSFSValue=function(e){if(!e)return null;if(e.getTypeId)switch(e.getTypeId()){case SFS2X.SFSDataType.SFS_OBJECT:return this.sfsObjectToPlainObject(e);case SFS2X.SFSDataType.SFS_ARRAY:return this.sfsArrayToPlainArray(e);default:return e}return e},a.sfsArrayToPlainArray=function(e){if(!e)return[];for(var t=[],n=e.size(),r=0;r<n;r++){var s=e.get(r);t.push(this.convertSFSValue(s))}return t},a.onConnection=function(e){u("Connected to SmartFox server"),this.emit("connected")},a.onConnectionLost=function(e){u("Connection lost: "+e.data),this.emit("connectionLost",e.data)},a.onLogin=function(e){u("Logged in successfully: "+e.data),this.emit("loggedIn",e.data)},a.onLoginError=function(e){c("Login error:",e.data),this.emit("loginError",e.data)},a.onLogout=function(e){u("Logged out"),this.emit("loggedOut")},a.onExtensionResponse=function(e){var t=e.data.cmd,n=e.data.params,r=n?n.getUtfString("requestId"):null,s=!!n&&n.getBool("success"),o=n?n.getUtfString("error"):null,i=n?n.getInt("errorCode"):0,a={success:s,command:t,data:n?this.sfsObjectToPlainObject(n):null,error:o,errorCode:i};if(r&&this._pendingRequests.has(r)){var u=this._pendingRequests.get(r);this._pendingRequests.delete(r),s?u.resolve(a):u.reject(new Error(o||"Unknown server error"))}this.emit("extensionResponse",a)},a.onSocketError=function(e){c("Socket error:",e.data),this.emit("socketError",e.data)},a.getCurrentUser=function(){return this._sfs?this._sfs.mySelf:null},a.destroy=function(){for(var t,r=n(this._pendingRequests);!(t=r()).done;){var s=t.value,o=(s[0],s[1]);clearTimeout(o.timeout),o.reject(new Error("Service destroyed"))}this._pendingRequests.clear(),this._sfs&&(this._sfs.isConnected&&this._sfs.disconnect(),this._sfs=null),e.prototype.destroy.call(this)},r(i,[{key:"isConnectedToServer",get:function(){return this._sfs&&this._sfs.isConnected}},{key:"isLoggedIn",get:function(){return this._sfs&&null!==this._sfs.mySelf}}]),i}(a));i._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseModel.ts","./ResourceModel.ts","./CityModel.ts","./MainEventModel.ts"],(function(e){var t,i,n,s,r,a,o,c;return{setters:[function(e){t=e.inheritsLoose,i=e.createForOfIteratorHelperLoose,n=e.createClass},function(e){s=e.cclegacy},function(e){r=e.BaseModel},function(e){a=e.ResourceModel},function(e){o=e.CityModel},function(e){c=e.MainEventModel}],execute:function(){s._RF.push({},"b07cbNahI5JBIJTWLWeGFgE","PlayerModel",void 0);e("PlayerModel",function(e){function s(){var t;return(t=e.call(this)||this)._resourceModel=void 0,t._currentCity=null,t._cities=new Map,t._mainEventModel=void 0,t._resourceModel=new a,t._mainEventModel=new c,t.initializeDefaults(),t.setupEventListeners(),t}t(s,e);var r=s.prototype;return r.initializeDefaults=function(){this.setData("id",""),this.setData("name",""),this.setData("level",1),this.setData("experience",0),this.setData("currentCityId",""),this.setData("lastLoginTime",Date.now()),this.setData("createdTime",Date.now())},r.setupEventListeners=function(){var e=this;this._resourceModel.on("dataChanged",(function(t){e.emit("resourceChanged",t)})),this._mainEventModel.on("itemsAdded",(function(t){e.emit("eventItemsAdded",t)})),this._mainEventModel.on("milestoneClaimed",(function(t){e.emit("eventMilestoneClaimed",t)})),this._mainEventModel.on("milestoneReached",(function(t){e.emit("eventMilestoneReached",t)}))},r.setCurrentCity=function(e){var t=this._cities.get(e);return!!t&&(this._currentCity=t,this.setData("currentCityId",e),this.emit("currentCityChanged",{cityId:e,city:t}),!0)},r.getCities=function(){return Array.from(this._cities.values())},r.getCity=function(e){return this._cities.get(e)||null},r.addCity=function(e){var t=this;this._cities.set(e.id,e),e.on("cityCompleted",(function(e){t.onCityCompleted(e)})),e.on("buildingUpgraded",(function(e){t.emit("buildingUpgraded",e)})),1===this._cities.size&&this.setCurrentCity(e.id),this.emit("cityAdded",{cityId:e.id,city:e})},r.onCityCompleted=function(e){var t=e.cityId,i=e.reward;this._resourceModel.addGold(i);var n=this._cities.get(t);if(n){var s=n.level+1,r=new o(s);this.addCity(r),this.setCurrentCity(r.id)}this.emit("cityCompleted",e)},r.updateLastLoginTime=function(){this.setData("lastLoginTime",Date.now())},r.addExperience=function(e){e>0&&(this.experience+=e,this.checkLevelUp())},r.checkLevelUp=function(){var e=this.getRequiredExperienceForLevel(this.level+1);this.experience>=e&&(this.level+=1,this.emit("levelUp",{newLevel:this.level,experience:this.experience}))},r.getRequiredExperienceForLevel=function(e){return 100*Math.pow(e,2)},r.getLevelProgress=function(){var e=this.getRequiredExperienceForLevel(this.level),t=this.getRequiredExperienceForLevel(this.level+1),i=this.experience-e,n=t-e;return Math.max(0,Math.min(1,i/n))},r.initializePlayerData=function(e){if(this.id=e.id||"",this.name=e.name||"",this.level=e.level||1,this.experience=e.experience||0,this.setData("lastLoginTime",e.lastLoginTime||Date.now()),this.setData("createdTime",e.createdTime||Date.now()),e.resources&&this._resourceModel.fromJSON(e.resources),this._cities.clear(),e.cities&&e.cities.length>0)for(var t,n=i(e.cities);!(t=n()).done;){var s=t.value,r=new o(s.level);r.fromJSON(s),this.addCity(r)}else{var a=new o(1);this.addCity(a)}e.currentCityId&&this.setCurrentCity(e.currentCityId),e.mainEvent&&this._mainEventModel.fromJSON(e.mainEvent),this.emit("playerDataInitialized",e)},r.validate=function(){var e=this.id,t=this.name,n=this.level,s=this.experience;if(!e||!t||n<1||s<0)return!1;if(!this._resourceModel.validate())return!1;if(!this._mainEventModel.validate())return!1;for(var r,a=i(this._cities.values());!(r=a()).done;){if(!r.value.validate())return!1}return!0},r.toJSON=function(){for(var e,t=[],n=i(this._cities.values());!(e=n()).done;){var s=e.value;t.push(s.toJSON())}return{id:this.id,name:this.name,level:this.level,experience:this.experience,resources:this._resourceModel.toJSON(),currentCityId:this.currentCityId,cities:t,mainEvent:this._mainEventModel.toJSON(),lastLoginTime:this.lastLoginTime,createdTime:this.createdTime}},r.fromJSON=function(e){this.initializePlayerData(e)},r.destroy=function(){this._resourceModel&&this._resourceModel.destroy(),this._mainEventModel&&this._mainEventModel.reset();for(var t,n=i(this._cities.values());!(t=n()).done;){t.value.destroy()}this._cities.clear(),this._currentCity=null,e.prototype.reset.call(this)},n(s,[{key:"id",get:function(){return this.getData("id")||""},set:function(e){this.setData("id",e)}},{key:"name",get:function(){return this.getData("name")||""},set:function(e){this.setData("name",e)}},{key:"level",get:function(){return this.getData("level")||1},set:function(e){this.setData("level",Math.max(1,e))}},{key:"experience",get:function(){return this.getData("experience")||0},set:function(e){this.setData("experience",Math.max(0,e))}},{key:"resources",get:function(){return this._resourceModel}},{key:"currentCityId",get:function(){return this.getData("currentCityId")||""}},{key:"currentCity",get:function(){return this._currentCity}},{key:"mainEvent",get:function(){return this._mainEventModel}},{key:"lastLoginTime",get:function(){return this.getData("lastLoginTime")||Date.now()}},{key:"createdTime",get:function(){return this.getData("createdTime")||Date.now()}}]),s}(r));s._RF.pop()}}}));

System.register("chunks:///_virtual/PreviewDragonBone.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,r,o,a,u,s,l,c,p,h,m,f,d,y,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,u=t.dragonBones,s=t.Node,l=t.EditBox,c=t.log,p=t.resources,h=t.Component,m=t.instantiate,f=t.Label,d=t.v3,y=t.UITransform,g=t.Button}],execute:function(){var v,A,T,b,D,B,C,N,E,w,_,L,z;o._RF.push({},"06e691DAuhIs7yTLNfN0A+f","PreviewDragonBone",void 0);var x=a.ccclass,P=a.property;t("PreviewDragonBone",(v=x("PreviewDragonBone"),A=P(u.ArmatureDisplay),T=P(s),b=P(l),D=P(s),B=P(s),v((E=e((N=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,i(e,"armatureDisplay",E,r(e)),i(e,"armatureNode",w,r(e)),i(e,"inputAnim",_,r(e)),i(e,"buttonsContainer",L,r(e)),i(e,"templateBtn",z,r(e)),e}n(e,t);var o=e.prototype;return o.start=function(){this.armatureDisplay.playAnimation("idle",0),this.armatureNode.on(s.EventType.TOUCH_START,this.onTouchStart,this),this.armatureNode.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),this.armatureNode.on(s.EventType.TOUCH_END,this.onTouchEnd,this),this.armatureNode.on(s.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.listAllAnimButton()},o.onTouchStart=function(){c("onTouchStart")},o.onTouchMove=function(t){var e=t.getUIDelta();this.armatureNode.x+=e.x,this.armatureNode.y+=e.y},o.onTouchEnd=function(){c("onTouchEnd")},o.listAllAnimButton=function(){var t=this,e=this.armatureDisplay.getAnimationNames(this.armatureDisplay.armatureName),n=this.templateBtn;c("templateBtn",n);for(var i=function(){var i=m(n);i.active=!0,i.name=e[r],i.getChildByName("Label").getComponent(f).string=e[r],t.buttonsContainer.addChild(i),i.position=d(n.x+r*(n.getComponent(y).width+10),0,0),i.on(g.EventType.CLICK,(function(){t.armatureDisplay.playAnimation(i.name,-1)}),t)},r=0;r<e.length;r++)i()},o.onClickLoad=function(){var t=this,e="fish/Fish"+this.inputAnim.string+"_tex";p.load(e,u.DragonBonesAtlasAsset,(function(e,n){if(e)c("load error",e);else{var i="fish/Fish"+t.inputAnim.string+"_ske";p.load(i,u.DragonBonesAsset,(function(e,i){e?c("load error",e):(t.armatureDisplay.dragonAsset=i,t.armatureDisplay.dragonAtlasAsset=n,t.listAllAnimButton())}))}}))},e}(h)).prototype,"armatureDisplay",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(N.prototype,"armatureNode",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(N.prototype,"inputAnim",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(N.prototype,"buttonsContainer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(N.prototype,"templateBtn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=N))||C));o._RF.pop()}}}));

System.register("chunks:///_virtual/RaidView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./RaidViewModel.ts"],(function(e){var t,i,n,o,a,r,s,l,h,d,u,c,f,g,p,b,w,v,C;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose,r=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){l=e.cclegacy,h=e._decorator,d=e.Label,u=e.Node,c=e.Sprite,f=e.Button,g=e.Color,p=e.tween,b=e.v3,w=e.director},function(e){v=e.BaseView},function(e){C=e.RaidViewModel}],execute:function(){var y,L,m,T,R,_,M,N,B,I,z,k,E,S,D,O,x,U,F,V,H,P,A,K,G,X,j,J,W,Y,q,Q,Z,$,ee,te,ie,ne,oe,ae,re,se,le,he,de,ue,ce,fe,ge;l._RF.push({},"cd871t1u4pK8JkaC6hobPDL","RaidView",void 0);var pe=h.ccclass,be=h.property;e("RaidView",(y=pe("RaidView"),L=be(d),m=be(d),T=be(u),R=be(d),_=be(d),M=be(d),N=be([u]),B=be([c]),I=be([d]),z=be([d]),k=be([f]),E=be([u]),S=be(f),D=be(f),O=be(u),x=be(d),U=be(u),F=be(d),V=be(d),H=be(d),P=be(f),A=be(u),K=be(d),y((j=t((X=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,n(t,"goldLabel",j,o(t)),n(t,"raidsRemainingLabel",J,o(t)),n(t,"targetInfoContainer",W,o(t)),n(t,"targetPlayerNameLabel",Y,o(t)),n(t,"targetPlayerLevelLabel",q,o(t)),n(t,"targetCityNameLabel",Q,o(t)),n(t,"chestNodes",Z,o(t)),n(t,"chestSprites",$,o(t)),n(t,"chestTypeLabels",ee,o(t)),n(t,"rewardLabels",te,o(t)),n(t,"raidButtons",ie,o(t)),n(t,"openedOverlays",ne,o(t)),n(t,"newTargetButton",oe,o(t)),n(t,"backButton",ae,o(t)),n(t,"loadingContainer",re,o(t)),n(t,"loadingLabel",se,o(t)),n(t,"resultContainer",le,o(t)),n(t,"resultTitleLabel",he,o(t)),n(t,"resultMessageLabel",de,o(t)),n(t,"resultRewardLabel",ue,o(t)),n(t,"resultCloseButton",ce,o(t)),n(t,"notificationContainer",fe,o(t)),n(t,"notificationLabel",ge,o(t)),t._viewModel=null,t._currentTarget=null,t}i(t,e);var l=t.prototype;return l.setupUI=function(){this.updateHeaderDisplay(),this.hideTargetInfo(),this.hideAllChests(),this.hideResultUI(),this.hideNotification(),this.showLoading("Loading target...")},l.bindEvents=function(){var e=this;this.newTargetButton&&this.newTargetButton.node.on(f.EventType.CLICK,this.onNewTargetClicked,this),this.backButton&&this.backButton.node.on(f.EventType.CLICK,this.onBackClicked,this);for(var t=function(t){var i=e.raidButtons[t];i&&i.node.on(f.EventType.CLICK,(function(){return e.onRaidClicked(t)}),e)},i=0;i<this.raidButtons.length;i++)t(i);this.resultCloseButton&&this.resultCloseButton.node.on(f.EventType.CLICK,this.onResultCloseClicked,this)},l.updateUI=function(e,t,i){},l.refreshUI=function(){this.updateHeaderDisplay(),this.updateTargetDisplay(),this.updateChestsDisplay()},l.setViewModel=function(t){e.prototype.setViewModel.call(this,t),this._viewModel=t,this._viewModel&&this.setupViewModelEvents()},l.setupViewModelEvents=function(){this._viewModel&&(this._viewModel.on("loadingTarget",this.onLoadingTarget,this),this._viewModel.on("targetLoaded",this.onTargetLoaded,this),this._viewModel.on("targetLoadError",this.onTargetLoadError,this),this._viewModel.on("resourceUpdated",this.onResourceUpdated,this),this._viewModel.on("raidStarted",this.onRaidStarted,this),this._viewModel.on("raidCompleted",this.onRaidCompleted,this),this._viewModel.on("raidError",this.onRaidError,this),this._viewModel.on("chestAlreadyOpened",this.onChestAlreadyOpened,this),this._viewModel.on("noRaidsRemaining",this.onNoRaidsRemaining,this),this._viewModel.on("navigateToScene",this.onNavigateToScene,this))},l.updateHeaderDisplay=function(){this._viewModel&&(this.goldLabel&&(this.goldLabel.string=this.formatNumber(this._viewModel.currentGold)),this.raidsRemainingLabel&&(this.raidsRemainingLabel.string="Raids: "+this._viewModel.raidsRemaining))},l.updateTargetDisplay=function(){this._viewModel&&this._currentTarget?(this.showTargetInfo(),this.targetPlayerNameLabel&&(this.targetPlayerNameLabel.string=this._currentTarget.playerName),this.targetPlayerLevelLabel&&(this.targetPlayerLevelLabel.string="Level "+this._currentTarget.playerLevel),this.targetCityNameLabel&&(this.targetCityNameLabel.string=this._currentTarget.cityName)):this.hideTargetInfo()},l.updateChestsDisplay=function(){if(this._currentTarget){for(var e=this._currentTarget.chests,t=0;t<e.length&&t<this.chestNodes.length;t++){var i=e[t];this.updateChestUI(t,i)}for(var n=e.length;n<this.chestNodes.length;n++)this.chestNodes[n]&&(this.chestNodes[n].active=!1)}else this.hideAllChests()},l.updateChestUI=function(e,t){var i,n;(this.chestNodes[e]&&(this.chestNodes[e].active=!0),this.chestTypeLabels[e]&&(this.chestTypeLabels[e].string=this.getChestDisplayName(t.chestType)),this.rewardLabels[e]&&(this.rewardLabels[e].string=this.formatNumber(t.potentialReward)+" Gold"),this.raidButtons[e])&&(this.raidButtons[e].interactable=!t.isOpened&&(null==(i=this._viewModel)?void 0:i.hasRaidsRemaining)&&!(null!=(n=this._viewModel)&&n.isRaiding));this.openedOverlays[e]&&(this.openedOverlays[e].active=t.isOpened),this.updateChestSprite(e,t)},l.updateChestSprite=function(e,t){if(this.chestSprites[e]){var i=this.chestSprites[e];if(t.isOpened)i.color=g.GRAY;else{var n={bronze:(new g).fromHEX("#CD7F32"),silver:(new g).fromHEX("#C0C0C0"),gold:(new g).fromHEX("#FFD700"),diamond:(new g).fromHEX("#B9F2FF")};i.color=n[t.chestType]||g.WHITE}}},l.getChestDisplayName=function(e){return{bronze:"Bronze Chest",silver:"Silver Chest",gold:"Gold Chest",diamond:"Diamond Chest"}[e]||"Chest"},l.showLoading=function(e){this.loadingContainer&&(this.loadingContainer.active=!0),this.loadingLabel&&(this.loadingLabel.string=e)},l.hideLoading=function(){this.loadingContainer&&(this.loadingContainer.active=!1)},l.showTargetInfo=function(){this.targetInfoContainer&&(this.targetInfoContainer.active=!0)},l.hideTargetInfo=function(){this.targetInfoContainer&&(this.targetInfoContainer.active=!1)},l.hideAllChests=function(){for(var e,t=a(this.chestNodes);!(e=t()).done;){var i=e.value;i&&(i.active=!1)}},l.showRaidResult=function(e){this.resultContainer&&(this.resultContainer.active=!0),this.resultTitleLabel&&(this.resultTitleLabel.string=e.success?"Raid Successful!":"Raid Failed!"),this.resultMessageLabel&&(this.resultMessageLabel.string=e.message),this.resultRewardLabel&&(e.goldEarned>0?(this.resultRewardLabel.string="+"+this.formatNumber(e.goldEarned)+" Gold",this.resultRewardLabel.node.active=!0):this.resultRewardLabel.node.active=!1)},l.hideResultUI=function(){this.resultContainer&&(this.resultContainer.active=!1)},l.showNotification=function(e,t){var i=this;void 0===t&&(t=3),this.notificationContainer&&this.notificationLabel&&(this.notificationLabel.string=e,this.notificationContainer.active=!0,this.scheduleOnce((function(){i.hideNotification()}),t))},l.hideNotification=function(){this.notificationContainer&&(this.notificationContainer.active=!1)},l.formatNumber=function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},l.animateChestOpening=function(e){if(!(e<0||e>=this.chestNodes.length)){var t=this.chestNodes[e];t&&(p(t).to(.2,{scale:b(1.2,1.2,1)}).to(.3,{scale:b(1,1,1)}).start(),p(t).to(.1,{angle:-10}).to(.1,{angle:10}).to(.1,{angle:-5}).to(.1,{angle:5}).to(.1,{angle:0}).start())}},l.onLoadingTarget=function(e){e?(this.showLoading("Loading target..."),this.hideTargetInfo(),this.hideAllChests()):this.hideLoading()},l.onTargetLoaded=function(e){this._currentTarget=e,this.hideLoading(),this.refreshUI()},l.onTargetLoadError=function(e){this.hideLoading(),this.showNotification("Failed to load target. Using offline mode.")},l.onResourceUpdated=function(e){this.updateHeaderDisplay()},l.onRaidStarted=function(e){this.animateChestOpening(e.chestIndex),this.showNotification("Raiding "+e.targetPlayer+"..."),this.updateChestsDisplay()},l.onRaidCompleted=function(e){this.showRaidResult(e),this.updateHeaderDisplay(),this.updateChestsDisplay()},l.onRaidError=function(e){this.showNotification("Raid failed: "+e.error),this.updateChestsDisplay()},l.onChestAlreadyOpened=function(e){this.showNotification("Chest is already opened!")},l.onNoRaidsRemaining=function(){this.showNotification("No raids remaining! Get a new target.")},l.onNavigateToScene=function(e){w.loadScene(e)},l.onNewTargetClicked=function(){var e=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._viewModel){e.next=3;break}return e.next=3,this._viewModel.executeCommand("getNewTarget");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.onBackClicked=function(){this._viewModel&&this._viewModel.executeCommand("goBack")},l.onRaidClicked=function(){var e=r(s().mark((function e(t){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._viewModel&&this._currentTarget){e.next=2;break}return e.abrupt("return");case 2:if(!(i=this._currentTarget.chests[t])){e.next=6;break}return e.next=6,this._viewModel.executeCommand("raidChest",i.chestIndex);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.onResultCloseClicked=function(){this.hideResultUI()},l.onShow=function(){e.prototype.onShow.call(this),this._viewModel||(this._viewModel=new C,this.setViewModel(this._viewModel),this._viewModel.initialize())},l.onDestroy=function(){this.newTargetButton&&this.newTargetButton.node.off(f.EventType.CLICK,this.onNewTargetClicked,this),this.backButton&&this.backButton.node.off(f.EventType.CLICK,this.onBackClicked,this);for(var t=0;t<this.raidButtons.length;t++){var i=this.raidButtons[t];i&&i.node.off(f.EventType.CLICK)}this.resultCloseButton&&this.resultCloseButton.node.off(f.EventType.CLICK,this.onResultCloseClicked,this),this._viewModel&&(this._viewModel.off("loadingTarget",this.onLoadingTarget,this),this._viewModel.off("targetLoaded",this.onTargetLoaded,this),this._viewModel.off("targetLoadError",this.onTargetLoadError,this),this._viewModel.off("resourceUpdated",this.onResourceUpdated,this),this._viewModel.off("raidStarted",this.onRaidStarted,this),this._viewModel.off("raidCompleted",this.onRaidCompleted,this),this._viewModel.off("raidError",this.onRaidError,this),this._viewModel.off("chestAlreadyOpened",this.onChestAlreadyOpened,this),this._viewModel.off("noRaidsRemaining",this.onNoRaidsRemaining,this),this._viewModel.off("navigateToScene",this.onNavigateToScene,this)),e.prototype.onDestroy.call(this)},t}(v)).prototype,"goldLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(X.prototype,"raidsRemainingLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(X.prototype,"targetInfoContainer",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(X.prototype,"targetPlayerNameLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(X.prototype,"targetPlayerLevelLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(X.prototype,"targetCityNameLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(X.prototype,"chestNodes",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$=t(X.prototype,"chestSprites",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ee=t(X.prototype,"chestTypeLabels",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),te=t(X.prototype,"rewardLabels",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ie=t(X.prototype,"raidButtons",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ne=t(X.prototype,"openedOverlays",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oe=t(X.prototype,"newTargetButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=t(X.prototype,"backButton",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=t(X.prototype,"loadingContainer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se=t(X.prototype,"loadingLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=t(X.prototype,"resultContainer",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he=t(X.prototype,"resultTitleLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(X.prototype,"resultMessageLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=t(X.prototype,"resultRewardLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=t(X.prototype,"resultCloseButton",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=t(X.prototype,"notificationContainer",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(X.prototype,"notificationLabel",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=X))||G));l._RF.pop()}}}));

System.register("chunks:///_virtual/RaidViewModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseViewModel.ts","./ServiceLocator.ts","./Logger.ts"],(function(e){var t,r,a,n,i,s,o,c;return{setters:[function(e){t=e.inheritsLoose,r=e.createClass,a=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){s=e.BaseViewModel},function(e){o=e.ServiceLocator},function(e){c=e.logError}],execute:function(){i._RF.push({},"4b62ce8dZVI3LLONEZ1oUWw","RaidViewModel",void 0);e("RaidViewModel",function(e){function i(){var t;return(t=e.call(this)||this)._gameService=null,t._resourceManager=null,t._raidTarget=null,t._isRaiding=!1,t._raidsRemaining=3,t}t(i,e);var s=i.prototype;return s.onInitialize=function(){this.setupServices(),this.setupEventListeners(),this.loadRaidTarget()},s.setupServices=function(){var e=o.getInstance();this._gameService=e.getService("GameService"),this._resourceManager=e.getService("ResourceManager"),this._gameService||c("GameService not found"),this._resourceManager||c("ResourceManager not found")},s.setupEventListeners=function(){this._resourceManager&&this._resourceManager.on("resourceChanged",this.onResourceChanged,this)},s.loadRaidTarget=function(){var e=a(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.emit("loadingTarget",!0),!this._gameService||!this._gameService.isReady){e.next=9;break}return e.next=5,this._gameService.getRaidTarget();case 5:t=e.sent,this._raidTarget=this.processTargetData(t),e.next=10;break;case 9:this._raidTarget=this.generateMockTarget();case 10:this.emit("targetLoaded",this._raidTarget),this.emit("loadingTarget",!1),e.next=21;break;case 14:e.prev=14,e.t0=e.catch(0),c("Failed to load raid target:",e.t0),this.emit("targetLoadError",e.t0),this.emit("loadingTarget",!1),this._raidTarget=this.generateMockTarget(),this.emit("targetLoaded",this._raidTarget);case 21:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),s.processTargetData=function(e){var t;return{playerId:e.playerId||"unknown",playerName:e.playerName||"Unknown Player",playerLevel:e.playerLevel||1,cityName:e.cityName||"Unknown City",chests:(null==(t=e.chests)?void 0:t.map((function(e,t){return{chestIndex:t,isOpened:e.isOpened||!1,potentialReward:e.potentialReward||100,chestType:e.chestType||"bronze"}})))||[]}},s.generateMockTarget=function(){for(var e=["Alice","Bob","Charlie","Diana","Eve"],t=["Village","Town","City","Metropolis","Capital"],r=["bronze","silver","gold","diamond"],a=e[Math.floor(Math.random()*e.length)],n=t[Math.floor(Math.random()*t.length)],i=Math.floor(10*Math.random())+1,s=[],o=0;o<3;o++){var c=r[Math.floor(Math.random()*r.length)],u=this.getChestBaseReward(c),d=Math.floor(u*(.5+1*Math.random()));s.push({chestIndex:o,isOpened:Math.random()<.1,potentialReward:d,chestType:c})}return{playerId:"player_"+Date.now(),playerName:a,playerLevel:i,cityName:n,chests:s}},s.getChestBaseReward=function(e){return{bronze:100,silver:250,gold:500,diamond:1e3}[e]||100},s.executeCommand=function(){var e=a(n().mark((function e(t){var r=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="raidChest"===e.t0?3:"getNewTarget"===e.t0?4:"goBack"===e.t0?5:"refreshTarget"===e.t0?6:7;break;case 3:return e.abrupt("return",this.raidChest(r.length<=1?void 0:r[1]));case 4:return e.abrupt("return",this.getNewTarget());case 5:return e.abrupt("return",this.goBack());case 6:return e.abrupt("return",this.loadRaidTarget());case 7:throw new Error("Unknown command: "+t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.raidChest=function(){var e=a(n().mark((function e(t){var r,a,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._raidTarget&&!this._isRaiding){e.next=2;break}return e.abrupt("return",null);case 2:if(r=this._raidTarget.chests.find((function(e){return e.chestIndex===t}))){e.next=6;break}return c("Chest not found: "+t),e.abrupt("return",null);case 6:if(!r.isOpened){e.next=9;break}return this.emit("chestAlreadyOpened",{chestIndex:t}),e.abrupt("return",null);case 9:if(!(this._raidsRemaining<=0)){e.next=12;break}return this.emit("noRaidsRemaining"),e.abrupt("return",null);case 12:if(e.prev=12,this._isRaiding=!0,this.emit("raidStarted",{chestIndex:t,targetPlayer:this._raidTarget.playerName}),!this._gameService||!this._gameService.isReady){e.next=22;break}return e.next=18,this._gameService.raidPlayer(this._raidTarget.playerId,t);case 18:i=e.sent,a=this.processRaidResult(i,t,r),e.next=23;break;case 22:a=this.generateMockRaidResult(t,r);case 23:return e.next=25,this.processRaidSuccess(a);case 25:return this._raidsRemaining--,this._isRaiding=!1,this.emit("raidCompleted",a),e.abrupt("return",a);case 31:return e.prev=31,e.t0=e.catch(12),c("Raid failed:",e.t0),this._isRaiding=!1,this.emit("raidError",{chestIndex:t,error:e.t0.message}),e.abrupt("return",null);case 37:case"end":return e.stop()}}),e,this,[[12,31]])})));return function(t){return e.apply(this,arguments)}}(),s.processRaidResult=function(e,t,r){return{success:e.success||!1,chestIndex:t,goldEarned:e.goldEarned||0,chestType:r.chestType,message:e.message||"Raid completed"}},s.generateMockRaidResult=function(e,t){var r=Math.random()<.6,a=r?Math.floor(t.potentialReward*(.3+.7*Math.random())):0;return{success:r,chestIndex:e,goldEarned:a,chestType:t.chestType,message:r?"Found "+a+" gold in the "+t.chestType+" chest!":"The chest was empty! Better luck next time."}},s.processRaidSuccess=function(){var e=a(n().mark((function e(t){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._raidTarget){e.next=2;break}return e.abrupt("return");case 2:if((r=this._raidTarget.chests.find((function(e){return e.chestIndex===t.chestIndex})))&&(r.isOpened=!0),!(t.success&&t.goldEarned>0&&this._resourceManager)){e.next=7;break}return e.next=7,this._resourceManager.addGold(t.goldEarned,"raid_reward");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.getNewTarget=function(){var e=a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._raidTarget=null,this._raidsRemaining=3,e.next=4,this.loadRaidTarget();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.goBack=function(){this.emit("navigateToScene","Main")},s.onResourceChanged=function(e){this.emit("resourceUpdated",e)},s.destroy=function(){this._resourceManager&&this._resourceManager.off("resourceChanged",this.onResourceChanged,this),this._gameService=null,this._resourceManager=null,this._raidTarget=null,this._isRaiding=!1,e.prototype.destroy.call(this)},r(i,[{key:"raidTarget",get:function(){return this._raidTarget}},{key:"currentGold",get:function(){return this._resourceManager?this._resourceManager.getGold():0}},{key:"isRaiding",get:function(){return this._isRaiding}},{key:"raidsRemaining",get:function(){return this._raidsRemaining}},{key:"hasRaidsRemaining",get:function(){return this._raidsRemaining>0}},{key:"targetPlayerName",get:function(){return this._raidTarget?this._raidTarget.playerName:""}},{key:"targetCityName",get:function(){return this._raidTarget?this._raidTarget.cityName:""}},{key:"targetPlayerLevel",get:function(){return this._raidTarget?this._raidTarget.playerLevel:1}},{key:"availableChests",get:function(){return this._raidTarget?this._raidTarget.chests.filter((function(e){return!e.isOpened})):[]}},{key:"openedChests",get:function(){return this._raidTarget?this._raidTarget.chests.filter((function(e){return e.isOpened})):[]}},{key:"totalPotentialReward",get:function(){return this._raidTarget?this.availableChests.reduce((function(e,t){return e+t.potentialReward}),0):0}},{key:"areAllChestsOpened",get:function(){return!!this._raidTarget&&this._raidTarget.chests.every((function(e){return e.isOpened}))}}]),i}(s));i._RF.pop()}}}));

System.register("chunks:///_virtual/ReelComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AnimationConfig.ts"],(function(i){var e,t,o,n,s,l,a,r,m,h,b,u,f,y,p,c,d,_,S;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,o=i.initializerDefineProperty,n=i.assertThisInitialized,s=i.createForOfIteratorHelperLoose},function(i){l=i.cclegacy,a=i._decorator,r=i.Node,m=i.Prefab,h=i.instantiate,b=i.v3,u=i.Sprite,f=i.Label,y=i.resources,p=i.SpriteFrame,c=i.tween,d=i.Vec3,_=i.Component},function(i){S=i.AnimationConfig}],execute:function(){var g,v,C,D,N,P,w,I,R,B,x,H,z,F,T;l._RF.push({},"0fadbUifFxBlKLJPjsen265","ReelComponent",void 0);var A=a.ccclass,M=a.property;i("ReelComponent",(g=A("ReelComponent"),v=M(r),C=M(m),D=M({tooltip:"The height of a single symbol. This determines the layout and stopping positions."}),N=M({tooltip:"The number of symbols visible in the final display area."}),P=M({tooltip:"Number of buffer symbols to instantiate above the visible area for smooth looping."}),w=M({tooltip:"Number of buffer symbols to instantiate below the visible area for smooth looping."}),g((B=e((R=function(i){function e(){for(var e,t=arguments.length,s=new Array(t),l=0;l<t;l++)s[l]=arguments[l];return e=i.call.apply(i,[this].concat(s))||this,o(e,"symbolContainer",B,n(e)),o(e,"symbolPrefab",x,n(e)),o(e,"symbolHeight",H,n(e)),o(e,"visibleSymbolCount",z,n(e)),o(e,"topBufferSymbols",F,n(e)),o(e,"bottomBufferSymbols",T,n(e)),e._symbolNodes=[],e._isSpinning=!1,e._reelIndex=0,e._symbols=[],e._finalSymbols=[],e._spinElapsedTime=0,e._spinDelay=0,e._spinPhase="acceleration",e._targetYPositions=[],e._anticipationSymbolsSet=!1,e._animationConfig=void 0,e._reelConfig=void 0,e}t(e,i);var l=e.prototype;return l.initialize=function(i,e){this._reelIndex=i,this._symbols=[].concat(e),this._animationConfig=S.getInstance(),this.updateConfig(),this.setupReel()},l.updateConfig=function(){this._animationConfig||(this._animationConfig=S.getInstance()),this._reelConfig=this._animationConfig.getReelConfig(this._reelIndex)},l.setupReel=function(){if(this.symbolContainer){this.symbolContainer.removeAllChildren(),this._symbolNodes=[];for(var i=this.visibleSymbolCount+this.topBufferSymbols+this.bottomBufferSymbols,e=0;e<i;e++){var t=this.createSymbolNode(e);if(t){this.symbolContainer.addChild(t),this._symbolNodes.push(t);var o=(this.visibleSymbolCount+this.topBufferSymbols-1-e)*this.symbolHeight;t.setPosition(0,o)}}this.populateWithRandomSymbols()}},l.createSymbolNode=function(i){if(!this.symbolPrefab)return null;var e=h(this.symbolPrefab);return e.name="Symbol_"+i,e},l.populateWithRandomSymbols=function(){if(0!==this._symbols.length)for(var i,e=s(this._symbolNodes);!(i=e()).done;){var t=i.value;this.setSymbolDisplay(t,this.getRandomSymbol())}},l.getRandomSymbol=function(){if(0===this._symbols.length)return{id:0,type:"?",name:"?",priority:0};var i=Math.floor(Math.random()*this._symbols.length);return this._symbols[i]},l.setSymbolDisplay=function(i,e,t){if(void 0===t&&(t=!1),i){i.scale=b(1,t?1.2:1,1);var o=i.getComponentInChildren(u);o&&this.setSymbolSprite(o,e,t);var n=i.getComponentInChildren(f);n&&(n.string=e.name),i.symbolData=e}},l.setSymbolSprite=function(i,e,t){var o=this,n="texture/symbol/"+(t?"blur/":"")+e.id+"/spriteFrame";y.load(n,p,(function(n,s){n?t?(console.warn("Failed to load blurred sprite for symbol ID "+e.id+", trying normal sprite.",n),o.setSymbolSprite(i,e,!1)):console.warn("Failed to load normal sprite for symbol ID "+e.id+":",n):i&&i.isValid&&(i.spriteFrame=s)}))},l.update=function(i){var e=this;if(this.updateCurve(),this._isSpinning&&(this._spinElapsedTime+=i,!(this._spinElapsedTime<this._spinDelay))){var t=this._spinElapsedTime-this._spinDelay,o=this._reelConfig,n=o.spinDuration,l=o.accelerationDuration,a=n-l-o.decelerationDuration;if(t<l)this._spinPhase="acceleration";else if(t<l+a)this._spinPhase="constant";else if("deceleration"!==this._spinPhase&&t<n){this._spinPhase="deceleration",this._targetYPositions=this._symbolNodes.map((function(i,t){return(e.visibleSymbolCount+e.topBufferSymbols-1-t)*e.symbolHeight}));for(var r,m=s(this._symbolNodes);!(r=m()).done;){var h=r.value,b=h.symbolData;b&&this.setSymbolDisplay(h,b,!1)}}var u=this.calculateCurrentSpeed(t);"deceleration"!==this._spinPhase||this._anticipationSymbolsSet||(this.setAnticipationSymbols(),this._anticipationSymbolsSet=!0),this.moveSymbols(u,i)}},l.calculateCurrentSpeed=function(i){var e=this._reelConfig,t=e.spinSpeed,o=e.spinDuration,n=e.accelerationDuration,s=e.decelerationDuration,l=o-n-s;switch(this._spinPhase){case"acceleration":var a=i/n;return t*this.easeInQuad(a);case"constant":return t;case"deceleration":var r=(i-(n+l))/s;return t*(1-this.easeOutCubic(r));default:return 0}},l.easeInQuad=function(i){return i*i},l.easeOutCubic=function(i){return 1-Math.pow(1-i,3)},l.setAnticipationSymbols=function(){for(var i=[].concat(this._symbolNodes).sort((function(i,e){return e.y-i.y})),e=this._reelConfig.anticipationDistance,t=0;t<Math.min(this._finalSymbols.length,i.length);t++){var o=Math.floor(t+this.topBufferSymbols+e/this.symbolHeight);i[o]&&this.setSymbolDisplay(i[o],this._finalSymbols[t])}},l.moveSymbols=function(i,e){var t=this;if("deceleration"===this._spinPhase)for(var o,n,l=function(){var o=n.value,s=o.y-i*e;if(void 0!==t._targetYPositions.find((function(i){return o.y>=i&&s<i})))return t.endSpin(),{v:void 0}},a=s(this._symbolNodes);!(n=a()).done;)if(o=l())return o.v;for(var r,m=this._symbolNodes.length*this.symbolHeight,h=-this.symbolHeight*(this.bottomBufferSymbols+1),b=s(this._symbolNodes);!(r=b()).done;){var u=r.value;if(u.y-=i*e,u.y<h&&(u.y+=m,"deceleration"!==this._spinPhase)){var f="constant"===this._spinPhase;this.setSymbolDisplay(u,this.getRandomSymbol(),f)}}},l.updateCurve=function(){if(0==this._reelIndex)for(var i=0;i<this._symbolNodes.length;i++){var e=this._symbolNodes[i],t=e.y;e.x=.1*t}else if(2==this._reelIndex)for(var o=0;o<this._symbolNodes.length;o++){var n=this._symbolNodes[o],s=n.y;n.x=.1*-s}},l.startSpin=function(i){this._isSpinning||(this._isSpinning=!0,this._spinElapsedTime=0,this._spinPhase="acceleration",this._anticipationSymbolsSet=!1,this._finalSymbols=[].concat(i),this._spinDelay=this._reelConfig.delayReel)},l.endSpin=function(){var i=this;this._isSpinning&&(this._isSpinning=!1,this._symbolNodes.sort((function(i,e){return e.y-i.y})),new Promise((function(e){var t=0,o=i._symbolNodes.length;if(0!==o)for(var n=function(){var n=i._symbolNodes[s],l=(i.visibleSymbolCount+i.topBufferSymbols-1-s)*i.symbolHeight;if(s>=i.topBufferSymbols&&s<i.topBufferSymbols+i.visibleSymbolCount){var a=s-i.topBufferSymbols;a<i._finalSymbols.length?i.setSymbolDisplay(n,i._finalSymbols[a]):i.setSymbolDisplay(n,i.getRandomSymbol())}else i.setSymbolDisplay(n,i.getRandomSymbol());var r=i._reelConfig,m=r.bounceDuration,h=r.bounceIntensity;c(n).to(m,{y:l},{easing:function(i){var e=5.67*h;return--i*i*((e+1)*i+e)+1}}).call((function(){++t===o&&e()})).start()},s=0;s<i._symbolNodes.length;s++)n();else e()})).then((function(){return i.onSpinComplete()})))},l.onSpinComplete=function(){this.node.emit("reelSpinComplete",{reelIndex:this._reelIndex,finalSymbols:this._finalSymbols})},l.highlightWinningSymbols=function(i){for(var e,t=this._animationConfig.getUIConfig().winAnimationDuration,o=s(i);!(e=o()).done;){var n=e.value;if(this._symbolNodes[n]){var l=this._symbolNodes[n];c(l).to(t,{scale:new d(1.2,1.2,1)}).to(t,{scale:new d(1,1,1)}).to(t,{scale:new d(1.2,1.2,1)}).to(t,{scale:new d(1,1,1)}).start()}}},l.onDestroy=function(){this.unscheduleAllCallbacks(),this._symbolNodes=[],this._symbols=[],this._finalSymbols=[]},e}(_)).prototype,"symbolContainer",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(R.prototype,"symbolPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(R.prototype,"symbolHeight",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),z=e(R.prototype,"visibleSymbolCount",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),F=e(R.prototype,"topBufferSymbols",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),T=e(R.prototype,"bottomBufferSymbols",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),I=R))||I));l._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseService.ts","./ResourceModel.ts","./ServiceLocator.ts","./Logger.ts"],(function(e){var r,t,n,s,i,o,a,c,u;return{setters:[function(e){r=e.inheritsLoose,t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){s=e.cclegacy},function(e){i=e.BaseService},function(e){o=e.ResourceType},function(e){a=e.ServiceLocator},function(e){c=e.logInfo,u=e.logError}],execute:function(){s._RF.push({},"6e1a5uynJpF36SgxNC+cet1","ResourceManager",void 0);e("ResourceManager",function(e){function s(){var r;return(r=e.call(this)||this)._resourceModel=null,r._gameService=null,r._playerModel=null,r._transactionHistory=[],r._syncTimer=0,r.SYNC_INTERVAL=3e4,r.MAX_TRANSACTION_HISTORY=100,r}r(s,e);var i=s.prototype;return i.onInitialize=function(){var e=t(n().mark((function e(){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c("Initializing Resource Manager..."),r=a.getInstance(),this._gameService=r.getService("GameService"),this._gameService){e.next=6;break}throw u("GameService not found - ResourceManager cannot initialize without it"),new Error("GameService instance required for ResourceManager initialization");case 6:if(this._playerModel=this._gameService.getPlayerModel(),this._playerModel){e.next=10;break}throw u("PlayerModel not found in GameService - ResourceManager cannot initialize without it"),new Error("PlayerModel instance required for ResourceManager initialization");case 10:this._resourceModel=this._playerModel.resources,c("ResourceManager using PlayerModel's ResourceModel as single source of truth"),this.setupResourceModelEvents(),this._gameService&&this.startPeriodicSync(),c("Resource Manager initialized successfully");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.onConnect=function(){var e=t(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._gameService||!this._gameService.isReady){e.next=3;break}return e.next=3,this.syncWithServer();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.onDisconnect=function(){var e=t(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stopPeriodicSync();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.setupResourceModelEvents=function(){var e=this;this._resourceModel&&(this._resourceModel.on("goldChanged",(function(r){e.onResourceChanged(o.GOLD,r.oldValue,r.value,"model_update")})),this._resourceModel.on("energyChanged",(function(r){e.onResourceChanged(o.ENERGY,r.oldValue,r.value,"model_update")})))},i.onResourceChanged=function(e,r,t,n){var s=t-r,i={type:e,oldValue:r,newValue:t,change:s,reason:n};this.emit("resourceChanged",i),Math.abs(s)>0&&c("Resource changed: "+e+" "+(s>0?"+":"")+s+" ("+r+" -> "+t+") - "+n)},i.startPeriodicSync=function(){var e=this;this._syncTimer=setInterval((function(){e._gameService&&e._gameService.isReady&&e.syncWithServer().catch((function(e){u("Periodic sync failed:",e)}))}),this.SYNC_INTERVAL)},i.stopPeriodicSync=function(){this._syncTimer&&(clearInterval(this._syncTimer),this._syncTimer=0)},i.syncWithServer=function(){var e=t(n().mark((function e(){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._gameService&&this._resourceModel&&this._playerModel){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._gameService.getPlayerData();case 5:(r=e.sent).resources&&(this._resourceModel.fromJSON(r.resources),this.emit("syncCompleted",r.resources),c("Resources synced with server successfully")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),u("Failed to sync resources with server:",e.t0),this.emit("syncFailed",e.t0);case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),i.getResourceModel=function(){return this._resourceModel},i.getGold=function(){return this._resourceModel?this._resourceModel.gold:0},i.getEnergy=function(){return this._resourceModel?this._resourceModel.energy:0},i.getMaxEnergy=function(){return this._resourceModel?this._resourceModel.maxEnergy:50},i.addGold=function(){var e=t(n().mark((function e(r,t){var s,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t="manual_add"),this._resourceModel&&!(r<=0)){e.next=3;break}return e.abrupt("return",!1);case 3:if(s=this._resourceModel.gold,this._resourceModel.addGold(r),i={type:o.GOLD,amount:r,reason:t,timestamp:Date.now(),success:!0},this.addTransaction(i),!this._gameService||!this._gameService.isReady){e.next=19;break}return e.prev=8,e.next=11,this._gameService.updatePlayerData({resources:this._resourceModel.toJSON()});case 11:e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(8),u("Failed to sync gold addition with server:",e.t0),this._resourceModel.gold=s,i.success=!1,e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this,[[8,13]])})));return function(r,t){return e.apply(this,arguments)}}(),i.spendGold=function(){var e=t(n().mark((function e(r,t){var s,i,a,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t="manual_spend"),this._resourceModel&&!(r<=0)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this._resourceModel.hasEnoughGold(r)){e.next=8;break}return s={type:o.GOLD,amount:-r,reason:t,timestamp:Date.now(),success:!1},this.addTransaction(s),this.emit("insufficientResources",{type:o.GOLD,required:r,available:this._resourceModel.gold}),e.abrupt("return",!1);case 8:if(i=this._resourceModel.gold,a=this._resourceModel.spendGold(r),c={type:o.GOLD,amount:-r,reason:t,timestamp:Date.now(),success:a},this.addTransaction(c),!(a&&this._gameService&&this._gameService.isReady)){e.next=24;break}return e.prev=13,e.next=16,this._gameService.updatePlayerData({resources:this._resourceModel.toJSON()});case 16:e.next=24;break;case 18:return e.prev=18,e.t0=e.catch(13),u("Failed to sync gold spending with server:",e.t0),this._resourceModel.gold=i,c.success=!1,e.abrupt("return",!1);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this,[[13,18]])})));return function(r,t){return e.apply(this,arguments)}}(),i.addEnergy=function(){var e=t(n().mark((function e(r,t){var s,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t="manual_add"),this._resourceModel&&!(r<=0)){e.next=3;break}return e.abrupt("return",!1);case 3:if(s=this._resourceModel.energy,this._resourceModel.addEnergy(r),i={type:o.ENERGY,amount:r,reason:t,timestamp:Date.now(),success:!0},this.addTransaction(i),!this._gameService||!this._gameService.isReady){e.next=19;break}return e.prev=8,e.next=11,this._gameService.updatePlayerData({resources:this._resourceModel.toJSON()});case 11:e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(8),u("Failed to sync energy addition with server:",e.t0),this._resourceModel.energy=s,i.success=!1,e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this,[[8,13]])})));return function(r,t){return e.apply(this,arguments)}}(),i.spendEnergy=function(){var e=t(n().mark((function e(r,t){var s,i,a,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t="manual_spend"),this._resourceModel&&!(r<=0)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this._resourceModel.hasEnoughEnergy(r)){e.next=8;break}return s={type:o.ENERGY,amount:-r,reason:t,timestamp:Date.now(),success:!1},this.addTransaction(s),this.emit("insufficientResources",{type:o.ENERGY,required:r,available:this._resourceModel.energy}),e.abrupt("return",!1);case 8:if(i=this._resourceModel.energy,a=this._resourceModel.spendEnergy(r),c={type:o.ENERGY,amount:-r,reason:t,timestamp:Date.now(),success:a},this.addTransaction(c),!(a&&this._gameService&&this._gameService.isReady)){e.next=24;break}return e.prev=13,e.next=16,this._gameService.updatePlayerData({resources:this._resourceModel.toJSON()});case 16:e.next=24;break;case 18:return e.prev=18,e.t0=e.catch(13),u("Failed to sync energy spending with server:",e.t0),this._resourceModel.energy=i,c.success=!1,e.abrupt("return",!1);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this,[[13,18]])})));return function(r,t){return e.apply(this,arguments)}}(),i.hasEnoughGold=function(e){return!!this._resourceModel&&this._resourceModel.hasEnoughGold(e)},i.hasEnoughEnergy=function(e){return!!this._resourceModel&&this._resourceModel.hasEnoughEnergy(e)},i.getTimeUntilNextEnergyRegen=function(){return this._resourceModel?this._resourceModel.getTimeUntilNextRegen():0},i.addTransaction=function(e){this._transactionHistory.push(e),this._transactionHistory.length>this.MAX_TRANSACTION_HISTORY&&this._transactionHistory.shift(),this.emit("transactionAdded",e)},i.getTransactionHistory=function(e,r){var t=this._transactionHistory;return e&&(t=t.filter((function(r){return r.type===e}))),r&&r>0&&(t=t.slice(-r)),[].concat(t)},i.clearTransactionHistory=function(){this._transactionHistory=[],this.emit("transactionHistoryCleared")},i.getResourceStats=function(){var e=this._transactionHistory.filter((function(e){return e.type===o.GOLD&&e.success})),r=this._transactionHistory.filter((function(e){return e.type===o.ENERGY&&e.success})),t=e.filter((function(e){return e.amount>0})).reduce((function(e,r){return e+r.amount}),0),n=e.filter((function(e){return e.amount<0})).reduce((function(e,r){return e+Math.abs(r.amount)}),0),s=r.filter((function(e){return e.amount>0})).reduce((function(e,r){return e+r.amount}),0),i=r.filter((function(e){return e.amount<0})).reduce((function(e,r){return e+Math.abs(r.amount)}),0);return{currentGold:this.getGold(),currentEnergy:this.getEnergy(),maxEnergy:this.getMaxEnergy(),goldEarned:t,goldSpent:n,goldNet:t-n,energyEarned:s,energySpent:i,energyNet:s-i,timeUntilNextEnergyRegen:this.getTimeUntilNextEnergyRegen(),transactionCount:this._transactionHistory.length}},i.destroy=function(){this.stopPeriodicSync(),this._resourceModel=null,this._playerModel=null,this._gameService=null,this._transactionHistory=[],e.prototype.destroy.call(this)},s}(i));s._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceManagerExample.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ServiceLocator.ts","./Logger.ts"],(function(e){var r,n,t,o,a;return{setters:[function(e){r=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){t=e.cclegacy},function(e){o=e.ServiceLocator},function(e){a=e.logInfo}],execute:function(){t._RF.push({},"dfe48Nm2WpDcbG8NfuDsnMS","ResourceManagerExample",void 0);e("ResourceManagerExample",function(){function e(){}return e.demonstrateCorrectArchitecture=function(){var e=r(n().mark((function e(){var r,t,c,s,u,l,i,d,g,R,f;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a("=== ResourceManager Architecture Demo ==="),r=o.getInstance(),t=r.getService("GameService")){e.next=6;break}return a("ERROR: GameService not initialized"),e.abrupt("return");case 6:if(c=t.getPlayerModel()){e.next=10;break}return a("ERROR: PlayerModel not found in GameService"),e.abrupt("return");case 10:if(s=r.getService("ResourceManager")){e.next=14;break}return a("ERROR: ResourceManager service not found"),e.abrupt("return");case 14:return a("✓ All components initialized successfully"),a("\n--- Demonstrating Single Source of Truth ---"),u=c.resources.gold,l=s.getGold(),a("Initial Gold - PlayerModel: "+u+", ResourceManager: "+l),a("Same instance? "+(c.resources===s.getResourceModel())),a("\n--- Adding 100 gold through ResourceManager ---"),e.next=23,s.addGold(100,"demo_reward");case 23:return e.sent?(i=c.resources.gold,d=s.getGold(),a("After adding gold - PlayerModel: "+i+", ResourceManager: "+d),a("✓ Both sources show same value: "+(i===d))):a("✗ Failed to add gold"),a("\n--- Testing Energy Operations ---"),g=s.getEnergy(),a("Initial Energy: "+g),e.next=30,s.spendEnergy(5,"demo_action");case 30:e.sent&&(R=s.getEnergy(),f=c.resources.energy,a("After spending 5 energy - ResourceManager: "+R+", PlayerModel: "+f),a("✓ Consistent values: "+(R===f))),a("\n=== Demo Complete ===");case 33:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.demonstrateBrokenArchitecture=function(){a("\n=== OLD BROKEN ARCHITECTURE (for comparison) ==="),a("In the old architecture:"),a("1. ResourceManager created: new ResourceModel() // Instance A"),a("2. PlayerModel created: new ResourceModel()     // Instance B"),a("3. ResourceManager.addGold(100) -> updates Instance A"),a("4. PlayerModel.resources.gold -> returns value from Instance B"),a("5. Result: INCONSISTENT DATA! Instance A ≠ Instance B"),a(""),a("NEW FIXED ARCHITECTURE:"),a("1. PlayerModel creates: new ResourceModel()     // Single Instance"),a("2. ResourceManager gets reference to PlayerModel.resources"),a("3. ResourceManager.addGold(100) -> updates Single Instance"),a("4. PlayerModel.resources.gold -> returns value from Same Instance"),a("5. Result: CONSISTENT DATA! ✓")},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameConfig.ts","./BaseModel.ts","./Logger.ts"],(function(e){var t,n,i,r,a,s;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){i=e.cclegacy},function(e){r=e.GameConfig},function(e){a=e.BaseModel},function(e){s=e.logInfo}],execute:function(){i._RF.push({},"abc9dw0OmhIvITLBBpLksiD","ResourceModel",void 0);e("ResourceType",function(e){return e.GOLD="gold",e.ENERGY="energy",e}({})),e("ResourceModel",function(e){function i(){var t;return(t=e.call(this)||this)._energyRegenTimer=0,t.RESOURCE_CONFIG=r.getInstance().getResourceConfig(),t.initializeDefaults(),t.startEnergyRegeneration(),t}t(i,e);var a=i.prototype;return a.initializeDefaults=function(){this.setData("gold",0),this.setData("energy",this.RESOURCE_CONFIG.maxEnergy),this.setData("maxEnergy",this.RESOURCE_CONFIG.maxEnergy),this.setData("lastEnergyRegenTime",Date.now())},a.addGold=function(e){this.gold+=e},a.spendGold=function(e){return this.gold>=e&&(this.gold-=e,!0)},a.addEnergy=function(e){this.energy+=e},a.spendEnergy=function(e){return this.energy>=e&&(this.energy-=e,!0)},a.hasEnoughGold=function(e){return this.gold>=e},a.hasEnoughEnergy=function(e){return this.energy>=e},a.startEnergyRegeneration=function(){var e=this;this.calculateMissedRegeneration(),this._energyRegenTimer=setInterval((function(){e.calculateMissedRegeneration()}),1e3)},a.calculateMissedRegeneration=function(){var e=this.getData("lastEnergyRegenTime")||Date.now(),t=Date.now(),n=t-e;if(n>=this.RESOURCE_CONFIG.energyRegenInterval){var i=Math.floor(n/this.RESOURCE_CONFIG.energyRegenInterval),r=Math.min(i,this.maxEnergy-this.energy);r>0&&(this.energy+=r,s("Regenerated "+r+" energy from missed time")),this.setData("lastEnergyRegenTime",t)}},a.getTimeUntilNextRegen=function(){if(this.energy>=this.maxEnergy)return 0;var e=(this.getData("lastEnergyRegenTime")||Date.now())+this.RESOURCE_CONFIG.energyRegenInterval,t=Date.now();return Math.max(0,e-t)},a.validate=function(){var e=this.gold,t=this.energy,n=this.maxEnergy;return e>=0&&t>=0&&n>0&&t<=2*n},a.destroy=function(){this._energyRegenTimer&&(clearInterval(this._energyRegenTimer),this._energyRegenTimer=0),e.prototype.reset.call(this)},a.toJSON=function(){return{gold:this.gold,energy:this.energy,lastEnergyRegenTime:this.getData("lastEnergyRegenTime")||Date.now()}},a.fromJSON=function(e){this.gold=e.gold||0,this.energy=e.energy||0,this.setData("lastEnergyRegenTime",e.lastEnergyRegenTime||Date.now()),this.calculateMissedRegeneration()},n(i,[{key:"gold",get:function(){return this.getData("gold")||0},set:function(e){this.setData("gold",Math.max(0,e))}},{key:"energy",get:function(){return this.getData("energy")||0},set:function(e){var t=this.maxEnergy;this.setData("energy",Math.max(0,e)),e>=t&&this.setData("lastEnergyRegenTime",Date.now())}},{key:"maxEnergy",get:function(){return this.getData("maxEnergy")||this.RESOURCE_CONFIG.maxEnergy},set:function(e){this.setData("maxEnergy",Math.max(1,e))}}]),i}(a));i._RF.pop()}}}));

System.register("chunks:///_virtual/RevealWave.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,a,n,s,o,l,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,s=e._decorator,o=e.Sprite,l=e.log,u=e.Component}],execute:function(){var p,c,h,m,v,f,y,d,b,_,w;n._RF.push({},"c60bbOCpWZGR7aIz78tdm2k","RevealWave",void 0);var g=s.ccclass,P=s.property;e("RevealWave",(p=g("RevealWave"),c=P(o),p((v=t((m=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return t=e.call.apply(e,[this].concat(n))||this,i(t,"sprite",v,a(t)),i(t,"duration",f,a(t)),i(t,"waveAmplitude",y,a(t)),i(t,"waveFrequency",d,a(t)),i(t,"roundness",b,a(t)),i(t,"edgeSoftness",_,a(t)),i(t,"waveSpeed",w,a(t)),t._mat=null,t._time=0,t}r(t,e);var n=t.prototype;return n.update=function(e){if(this._mat){this._time+=e;var t=Math.min(this._time/this.duration,1);if(this._mat.setProperty("reveal",t),l("reveal ",this._mat.getProperty("reveal"),t),t<1){var r=this._time*this.waveSpeed;this._mat.setProperty("wavePhase",r),l("wavePhase ",r)}else this._mat.setProperty("reveal",1),this._mat.setProperty("waveAmplitude",0),this._mat.setProperty("edgeSoftness",0),this.enabled=!1}},n.restart=function(){var e,t=null!=(e=this.sprite)?e:this.getComponent(o);if(t&&t.customMaterial){var r=t.material;!r&&t.getMaterialInstance&&(r=t.getMaterialInstance(0)),this._mat=r,this._mat.setProperty("reveal",0),this._mat.setProperty("waveAmplitude",this.waveAmplitude),this._mat.setProperty("waveFrequency",this.waveFrequency),this._mat.setProperty("roundness",this.roundness),this._mat.setProperty("edgeSoftness",this.edgeSoftness),this._mat.setProperty("wavePhase",0),this._time=0,this.enabled=!0}},n.stop=function(){this.enabled=!1},t}(u)).prototype,"sprite",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=t(m.prototype,"duration",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),y=t(m.prototype,"waveAmplitude",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.08}}),d=t(m.prototype,"waveFrequency",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),b=t(m.prototype,"roundness",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),_=t(m.prototype,"edgeSoftness",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),w=t(m.prototype,"waveSpeed",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),h=m))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/ServiceLocator.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts"],(function(e){var r,t,n,i,s,c;return{setters:[function(e){r=e.createForOfIteratorHelperLoose,t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){s=e.logWarn,c=e.logError}],execute:function(){i._RF.push({},"54db839dB1JkIxlZ3v2tUJ6","ServiceLocator",void 0),e("ServiceLocator",function(){function e(){this._services=new Map}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var i=e.prototype;return i.registerService=function(e,r){if(this._services.has(e)){s("Service "+e+" is already registered. Replacing existing service.");var t=this._services.get(e);t&&t.destroy()}this._services.set(e,r)},i.getService=function(e){return this._services.get(e)||null},i.hasService=function(e){return this._services.has(e)},i.unregisterService=function(e){var r=this._services.get(e);r&&(r.destroy(),this._services.delete(e))},i.initializeAllServices=function(){var e=t(n().mark((function e(){var t,i,s,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],i=n().mark((function e(){var r,i,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.value,i=r[0],(s=r[1]).isInitialized||t.push(s.initialize().catch((function(e){throw c("Failed to initialize service "+i+":",e),e})));case 2:case"end":return e.stop()}}),e)})),s=r(this._services);case 3:if((a=s()).done){e.next=7;break}return e.delegateYield(i(),"t0",5);case 5:e.next=3;break;case 7:return e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.connectAllServices=function(){var e=t(n().mark((function e(){var t,i,s,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],i=n().mark((function e(){var r,i,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.value,i=r[0],(s=r[1]).isInitialized&&!s.isConnected&&t.push(s.connect().catch((function(e){throw c("Failed to connect service "+i+":",e),e})));case 2:case"end":return e.stop()}}),e)})),s=r(this._services);case 3:if((a=s()).done){e.next=7;break}return e.delegateYield(i(),"t0",5);case 5:e.next=3;break;case 7:return e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.destroyAllServices=function(){for(var e,t=r(this._services);!(e=t()).done;){var n=e.value,i=n[0],s=n[1];try{s.destroy()}catch(e){c("Error destroying service "+i+":",e)}}this._services.clear()},i.getServiceNames=function(){return Array.from(this._services.keys())},e}())._instance=void 0,i._RF.pop()}}}));

System.register("chunks:///_virtual/SimpleCityModelTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CityModel.ts","./GameConfig.ts","./Logger.ts"],(function(e){var t,n,i,o,r,a,l;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){o=e.CityModel},function(e){r=e.GameConfig},function(e){a=e.logInfo,l=e.logError}],execute:function(){e("runSimpleCityModelTests",(function(){return c.apply(this,arguments)})),i._RF.push({},"e5f6g7h8-i9j0-1234-efgh-567890123456","SimpleCityModelTest",void 0);var s=e("SimpleCityModelTest",function(){function e(){}return e.testCityModelWithGameConfig=function(){var e=t(n().mark((function e(){var t,i,s,c,u,f,g,d,h,p;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a("Testing CityModel with GameConfig..."),t=r.getInstance(),e.next=5,t.loadConfig();case 5:if(i=new o("test_village","Test Village",1),s=i.getBuildings(),a("Level 1 Village: "+s.length+" buildings"),s.forEach((function(e,t){a("  "+(t+1)+". "+e.name+" ("+e.type+") - Cost: "+e.baseCost)})),c=new o("test_town","Test Town",2),u=c.getBuildings(),a("Level 2 Town: "+u.length+" buildings"),u.forEach((function(e,t){a("  "+(t+1)+". "+e.name+" ("+e.type+") - Cost: "+e.baseCost)})),f=["house","shop","factory","tower","castle"],5,5===s.length){e.next=17;break}throw new Error("Expected 5 buildings, got "+s.length);case 17:if(s.forEach((function(e,t){if(e.type!==f[t])throw new Error("Expected building type "+f[t]+", got "+e.type)})),g=s.find((function(e){return"house"===e.type})),d=u.find((function(e){return"house"===e.type})),!g||!d){e.next=25;break}if(a("Village house cost: "+g.baseCost),a("Town house cost: "+d.baseCost),!(d.baseCost<=g.baseCost)){e.next=25;break}throw new Error("Town buildings should cost more than village buildings");case 25:if(i.validate()){e.next=27;break}throw new Error("Village validation failed");case 27:if(c.validate()){e.next=29;break}throw new Error("Town validation failed");case 29:if(h=i.toJSON(),(p=new o("temp","temp",1)).fromJSON(h),p.getBuildings().length===i.getBuildings().length){e.next=34;break}throw new Error("Serialization failed - building count mismatch");case 34:a("✅ All tests passed! CityModel successfully uses GameConfig."),e.next=41;break;case 37:throw e.prev=37,e.t0=e.catch(0),l("❌ Test failed:",e.t0),e.t0;case 41:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(){return e.apply(this,arguments)}}(),e.testFallbackBehavior=function(){try{a("Testing fallback behavior...");var e=new o("unknown_city","Unknown City",99).getBuildings(),t=["house","shop","factory","tower","castle"];if(5!==e.length)throw new Error("Fallback failed: Expected 5 buildings, got "+e.length);e.forEach((function(e,n){if(e.type!==t[n])throw new Error("Fallback failed: Expected building type "+t[n]+", got "+e.type)})),a("✅ Fallback behavior works correctly.")}catch(e){throw l("❌ Fallback test failed:",e),e}},e}());function c(){return(c=t(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a("=== Running Simple CityModel Tests ==="),e.next=3,s.testCityModelWithGameConfig();case 3:s.testFallbackBehavior(),a("=== All Simple CityModel Tests Completed Successfully! ===");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i._RF.pop()}}}));

System.register("chunks:///_virtual/SlotMachineComponent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ReelComponent.ts","./AnimationConfig.ts","./RevealWave.ts"],(function(t){var e,n,i,o,s,a,r,u,l,p,h,c,d,f,v,S,B,_,g,b,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,s=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){u=t.cclegacy,l=t._decorator,p=t.Node,h=t.Button,c=t.Label,d=t.UIOpacity,f=t.Tween,v=t.tween,S=t.log,B=t.Vec3,_=t.Component},function(t){g=t.ReelComponent},function(t){b=t.AnimationConfig},function(t){w=t.RevealWave}],execute:function(){var C,M,m,y,A,E,T,I,R,L,P,D,U,k,O,x,N,z,G,H,W,F,K,Q,Y;u._RF.push({},"76923hm7JhMgLe6lmDG3Omp","SlotMachineComponent",void 0);var V=l.ccclass,j=l.property;t("SlotMachineComponent",(C=V("SlotMachineComponent"),M=j(p),m=j(h),y=j(c),A=j(h),E=j(h),T=j(c),I=j(h),R=j(c),L=j(h),P=j(d),D=j(w),C((O=e((k=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,i(e,"reelsContainer",O,o(e)),i(e,"spinButton",x,o(e)),i(e,"spinButtonLabel",N,o(e)),i(e,"betIncreaseButton",z,o(e)),i(e,"betDecreaseButton",G,o(e)),i(e,"betMultiplierLabel",H,o(e)),i(e,"betChangeButton",W,o(e)),i(e,"winLabel",F,o(e)),i(e,"autoSpinButton",K,o(e)),i(e,"autoSpinButtonOpacity",Q,o(e)),i(e,"autoSpinWave",Y,o(e)),e.reelComponents=[],e._viewModel=null,e._animationConfig=void 0,e._reelCompletionStates=[!1,!1,!1],e._currentSpinResult=null,e._suspenseSpinActive=!1,e._firstTwoReelsMatch=!1,e._originalBetButtonPos=null,e._originalSpinButtonPos=null,e._spinButtonState="idle",e}n(e,t);var u=e.prototype;return u.setViewModel=function(t){this._viewModel=t,this.setupEventListeners()},u.onLoad=function(){this.reelComponents=this.reelsContainer.getComponentsInChildren(g),this._animationConfig=b.getInstance(),this.betChangeButton&&(this._originalBetButtonPos=this.betChangeButton.node.position.clone()),this.spinButton&&(this._originalSpinButtonPos=this.spinButton.node.position.clone()),this.bindEvents()},u.onDestroy=function(){this.unbindEvents()},u.bindEvents=function(){this.spinButton&&(this.spinButton.node.on(p.EventType.TOUCH_START,this.onSpinTouchStart,this),this.spinButton.node.on(p.EventType.TOUCH_END,this.onSpinTouchEnd,this),this.spinButton.node.on(p.EventType.TOUCH_CANCEL,this.onSpinTouchEnd,this)),this.betIncreaseButton&&this.betIncreaseButton.node.on(h.EventType.CLICK,this.onBetIncreaseClicked,this),this.betDecreaseButton&&this.betDecreaseButton.node.on(h.EventType.CLICK,this.onBetDecreaseClicked,this),this.betChangeButton&&this.betChangeButton.node.on(p.EventType.TOUCH_START,this.onBetChangeTouchStart,this),this.autoSpinButton&&this.autoSpinButton.node.on(h.EventType.CLICK,this.onAutoSpinClicked,this)},u.unbindEvents=function(){this._viewModel&&(this._viewModel.off("dataLoaded",this.onDataLoaded,this),this._viewModel.off("spinStarted",this.onSpinStarted,this),this._viewModel.off("spinCompleted",this.onSpinCompleted,this),this._viewModel.off("betMultiplierChanged",this.updateUI,this),this._viewModel.off("betMultiplierIncreaseBlocked",this.onBetMultiplierIncreaseBlocked,this),this._viewModel.off("resourceUpdated",this.updateUI,this),this._viewModel.off("autoSpinStateChanged",this.onAutoSpinStateChanged,this))},u.setupEventListeners=function(){this._viewModel&&(this.unbindEvents(),this._viewModel.on("dataLoaded",this.onDataLoaded,this),this._viewModel.on("spinStarted",this.onSpinStarted,this),this._viewModel.on("spinCompleted",this.onSpinCompleted,this),this._viewModel.on("betMultiplierChanged",this.updateUI,this),this._viewModel.on("betMultiplierIncreaseBlocked",this.onBetMultiplierIncreaseBlocked,this),this._viewModel.on("resourceUpdated",this.updateUI,this),this._viewModel.on("autoSpinStateChanged",this.onAutoSpinStateChanged,this),this._viewModel.on("animationProfileChanged",this.onAnimationProfileChanged,this))},u.onDataLoaded=function(){if(this._viewModel){for(var t=this._viewModel.symbols,e=0;e<this.reelComponents.length;e++){var n=this.reelComponents[e];n.initialize(e,t),n.node.on("reelSpinComplete",this.onReelSpinComplete,this)}this.updateUI()}},u.onSpinStarted=function(t){if(this._viewModel){this._reelCompletionStates=[!1,!1,!1],this._currentSpinResult=t;var e=this._viewModel.isAutoSpinning;if(this._firstTwoReelsMatch=this.checkFirstTwoReelsMatch(t),this._suspenseSpinActive=!e&&this._firstTwoReelsMatch&&this.shouldTriggerSuspenseSpin(),this._suspenseSpinActive){this._animationConfig.setProfile("suspense");for(var n,i=s(this.reelComponents);!(n=i()).done;){n.value.updateConfig()}}var o=t.reelResults;if(o&&o.length>0)for(var a=o[0],r=0;r<this.reelComponents.length;r++){var u=this.reelComponents[r],l=a[r]?[a[r]]:[];u.startSpin(l)}this.updateUI()}},u.onReelSpinComplete=function(t){var e=t.reelIndex;e>=0&&e<this._reelCompletionStates.length&&(this._reelCompletionStates[e]=!0,this._reelCompletionStates.every((function(t){return t}))&&this.onAllReelsCompleted())},u.onAllReelsCompleted=function(){if(this._currentSpinResult&&this._viewModel){if(this._suspenseSpinActive){this._animationConfig.setProfile("normal");for(var t,e=s(this.reelComponents);!(t=e()).done;){t.value.updateConfig()}this._suspenseSpinActive=!1}this._viewModel.processSpinResultFromComponent(this._currentSpinResult),this._currentSpinResult=null}},u.checkFirstTwoReelsMatch=function(t){if(!t.reelResults||0===t.reelResults.length)return!1;var e=t.reelResults[0];if(e.length<2)return!1;var n=e[0],i=e[1];return n.type===i.type||n.id===i.id},u.shouldTriggerSuspenseSpin=function(){return!0},u.onSpinClicked=function(){var t=a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._viewModel){t.next=3;break}return t.next=3,this._viewModel.executeCommand("spin");case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.onSpinTouchStart=function(){var t=a(r().mark((function t(){var e=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._originalSpinButtonPos){t.next=2;break}return t.abrupt("return");case 2:if("idle"==this._spinButtonState){t.next=4;break}return t.abrupt("return");case 4:if(this._spinButtonState="down",v(this.spinButton.node).to(.2,{y:this._originalSpinButtonPos.y-45},{easing:"sineIn"}).call((function(){"up"!=e._spinButtonState&&e.hasEnoughEnergy()?e.activateAutoSpinButton():e.showSpinButtonUp()})).start(),!this._viewModel){t.next=9;break}return t.next=9,this._viewModel.executeCommand("spin");case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.showSpinButtonUp=function(){var t=this;f.stopAllByTarget(this.spinButton.node),this.spinButton.node.active=!0,v(this.spinButton.node).to(.2,{position:this._originalSpinButtonPos},{easing:"sineOut"}).call((function(){t._spinButtonState="idle"})).start()},u.activateAutoSpinButton=function(){var t=this;this._spinButtonState="prepare_auto",this.autoSpinButton.node.active=!0,this.autoSpinButtonOpacity.opacity=200,this.autoSpinWave.restart(),S("activateAutoSpinButton "),v(this.autoSpinButtonOpacity).to(1,{opacity:255}).call((function(){t.spinButton.node.active=!1,t._spinButtonState="auto",t.onAutoSpinClicked()})).start()},u.deactivateAutoSpinButton=function(){S("deactivateAutoSpinButton ",this._spinButtonState),f.stopAllByTarget(this.autoSpinButtonOpacity),this.autoSpinButton.node.active=!1,this._spinButtonState="up",this.showSpinButtonUp()},u.onSpinTouchEnd=function(){var t=a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._originalSpinButtonPos){t.next=2;break}return t.abrupt("return");case 2:"down"==this._spinButtonState?this._spinButtonState="up":"prepare_auto"==this._spinButtonState&&this.deactivateAutoSpinButton();case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),u.onBetIncreaseClicked=function(){this._viewModel&&this._viewModel.executeCommand("increaseBetMultiplier")},u.onBetDecreaseClicked=function(){this._viewModel&&this._viewModel.executeCommand("decreaseBetMultiplier")},u.onBetChangeTouchStart=function(){var t=this;this._originalBetButtonPos&&(f.stopAllByTarget(this.betChangeButton.node),v(this.betChangeButton.node).to(.1,{position:new B(this._originalBetButtonPos.x,this._originalBetButtonPos.y-16,this._originalBetButtonPos.z)}).call((function(){t._viewModel&&t._viewModel.executeCommand("changeBetMultiplier")})).to(.1,{position:this._originalBetButtonPos}).start())},u.onSpinCompleted=function(t){this.updateUI(),this.showWinResults(t)},u.onAutoSpinClicked=function(){this._viewModel&&(this._viewModel.isAutoSpinning||this._viewModel.isAutoSpinPending?this._viewModel.executeCommand("stopAutoSpin"):this._viewModel.executeCommand("startAutoSpin"))},u.onAutoSpinStateChanged=function(t){var e=this,n=t.reason;this.updateUI(),n&&S("onAutoSpinStateChanged on reason ",n,t),n&&"STARTED"!=n&&"QUEUED"!=n&&(S("deactivateAutoSpinButton on reason ",n,t),this.deactivateAutoSpinButton()),"STARTED"===n?this._animationConfig.setProfile("autoSpin"):"STOPPED_USER"===n||"QUEUE_CLEARED"===n?this._animationConfig.setProfile("normal"):"STOPPED_NO_ENERGY"===n&&(this._animationConfig.setProfile("normal"),this.spinButtonLabel&&(this.spinButtonLabel.string="NO ENERGY",this.scheduleOnce((function(){e.updateSpinButton()}),2)))},u.onAnimationProfileChanged=function(){for(var t,e=s(this.reelComponents);!(t=e()).done;){t.value.updateConfig()}},u.onBetMultiplierIncreaseBlocked=function(t){var e=this;this.betIncreaseButton&&(this.betIncreaseButton.interactable=!1,this.scheduleOnce((function(){e.betIncreaseButton&&e._viewModel&&!e._viewModel.isSpinning&&(e.betIncreaseButton.interactable=!0)}),.5)),console.log("Bet increase blocked: Need "+t.requiredEnergy+" energy, have "+t.availableEnergy)},u.updateUI=function(){this.updateSpinButton(),this.updateBetMultiplierDisplay(),this.updateAutoSpinDisplay()},u.updateAutoSpinDisplay=function(){if(this._viewModel&&this.autoSpinButton){var t=this._viewModel.isAutoSpinning,e=this._viewModel.isAutoSpinPending;this.autoSpinButton.interactable=!0;var n=this.autoSpinButton.getComponentInChildren(c);n&&(n.string=t?"STOP":e?"QUEUED":"AUTO")}},u.updateSpinButton=function(){if(this._viewModel&&this.spinButton&&this.spinButtonLabel){var t=this._viewModel.spinEnergyCost,e=this._viewModel.currentEnergy>=t,n=this._viewModel.isSpinning,i=this._viewModel.isAutoSpinning;this.spinButton.interactable=e&&!n&&!i,this.spinButtonLabel.string=i?"AUTO-SPINNING":n?"SPINNING...":e?"SPIN ("+t+" Energy)":"NOT ENOUGH ENERGY"}},u.updateBetMultiplierDisplay=function(){if(this._viewModel){var t=this._viewModel.currentBetMultiplier,e=this._viewModel.isSpinning,n=this._viewModel.isAutoSpinning;this.betMultiplierLabel&&(this.betMultiplierLabel.string="x"+t);var i=this._viewModel.availableBetMultipliers,o=i.indexOf(t),s=!e&&!n&&o<i.length-1,a=!e&&!n&&o>0;this.betIncreaseButton&&(this.betIncreaseButton.interactable=s),this.betDecreaseButton&&(this.betDecreaseButton.interactable=a)}},u.showWinResults=function(t){if(this.winLabel)if(t.totalPayout>0){S("Show win results ",t),this.winLabel.string=this._viewModel.getDisplayResultText(t),this.winLabel.node.active=!0;var e=this._animationConfig.getUIConfig().winAnimationDuration;v(this.winLabel.node).to(e,{scale:new B(1.2,1.2,1)}).to(e,{scale:new B(1,1,1)}).start()}else this.winLabel.string="",this.winLabel.node.active=!1},u.hasEnoughEnergy=function(){var t=this._viewModel.spinEnergyCost,e=this._viewModel.currentEnergy>=t;return e},e}(_)).prototype,"reelsContainer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(k.prototype,"spinButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(k.prototype,"spinButtonLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(k.prototype,"betIncreaseButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(k.prototype,"betDecreaseButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(k.prototype,"betMultiplierLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(k.prototype,"betChangeButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(k.prototype,"winLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(k.prototype,"autoSpinButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(k.prototype,"autoSpinButtonOpacity",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(k.prototype,"autoSpinWave",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=k))||U));u._RF.pop()}}}));

System.register("chunks:///_virtual/SlotMachineConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SlotMachineUtils.ts"],(function(n){var e,t,o,r,i,a;return{setters:[function(n){e=n.asyncToGenerator,t=n.regeneratorRuntime},function(n){o=n.cclegacy,r=n.resources,i=n.JsonAsset},function(n){a=n.SlotMachineUtils}],execute:function(){o._RF.push({},"1c7fbhMBLNP+ptX5IN4N+2p","SlotMachineConfig",void 0),n("SlotMachineConfig",function(){function n(){this.symbols=[],this.paytable=[]}n.getInstance=function(){return n._instance||(n._instance=new n),n._instance};var o=n.prototype;return o.loadConfig=function(){var n=e(t().mark((function n(){var e=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!window.symbols||!window.paytable){n.next=4;break}return this.symbols=window.symbols.filter((function(n){return 0!=n.id})),this.paytable=window.paytable,n.abrupt("return");case 4:return n.abrupt("return",new Promise((function(n,t){r.loadDir("config",i,(function(o,r){if(o)return console.error("Failed to load config files:",o),t(o);var i=r.find((function(n){return"symbols"===n.name})),a=r.find((function(n){return"paytable"===n.name}));i&&i.json?e.symbols=i.json.filter((function(n){return 0!=n.id})):console.error("symbols.json not found or is empty."),a&&a.json?e.paytable=a.json:console.error("paytable.json not found or is empty."),n()}))})));case 5:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}(),o.getDefaultConfig=function(){return{reelCount:3,rowCount:1,symbols:this.symbols,energyCostPerSpin:1,availableMultipliers:[1,2,5,10,20,40,50,100,250],paytable:this.paytable}},o.getConfigForLevel=function(n){var e=this.getDefaultConfig();return n>=10&&(e.availableMultipliers=[1,2,5,10,20,40,50,100,250]),n>=20&&(e.energyCostPerSpin=1),e},o.validateConfig=function(n){return a.validateConfiguration(n.symbols,n.paytable,n.reelCount,n.rowCount)},o.getTestConfig=function(){var n=this.getDefaultConfig();return n.energyCostPerSpin=1,n.availableMultipliers=[1,2,5,10,20,40,50,100,250],n},o.createConfigFromServerData=function(n){try{return{reelCount:n.reelCount||3,rowCount:n.rowCount||1,symbols:n.symbols||[],energyCostPerSpin:n.energyCostPerSpin||1,availableMultipliers:n.availableMultipliers||[1,2,5,10,20,40,50,100,250],paytable:n.paytable||[]}}catch(n){return console.warn("Failed to parse server config, using default:",n),this.getDefaultConfig()}},n}())._instance=null,o._RF.pop()}}}));

System.register("chunks:///_virtual/SlotMachineModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseModel.ts"],(function(t){var e,i,n,a,s,l;return{setters:[function(t){e=t.inheritsLoose,i=t.extends,n=t.createForOfIteratorHelperLoose,a=t.createClass},function(t){s=t.cclegacy},function(t){l=t.BaseModel}],execute:function(){s._RF.push({},"d03bdpQG8pJ8bT6/mW1ZKaV","SlotMachineModel",void 0);var r=t("SlotRewardType",function(t){return t.ATTACK="Attack",t.STEAL="Steal",t.SHIELD="Shield",t.GOLD="Gold",t.ENERGY="Energy",t.TOKEN="Token",t}({}));t("SlotMachineModel",function(t){function s(){var e;return(e=t.call(this)||this).DEFAULT_ENERGY_COST=1,e.DEFAULT_MULTIPLIERS=[1,2,5,10,20,40,50,100,250],e.DEFAULT_REEL_COUNT=3,e.DEFAULT_ROW_COUNT=1,e.initializeDefaults(),e}e(s,t);var l=s.prototype;return l.initializeDefaults=function(){this.setData("reelCount",this.DEFAULT_REEL_COUNT),this.setData("rowCount",this.DEFAULT_ROW_COUNT),this.setData("symbols",[]),this.setData("energyCostPerSpin",this.DEFAULT_ENERGY_COST),this.setData("availableMultipliers",[].concat(this.DEFAULT_MULTIPLIERS)),this.setData("selectedMultiplier",1),this.setData("isSpinning",!1),this.setData("lastSpinResult",null),this.setData("paytable",[]),this.setData("autoSpinState",{isActive:!1,isPending:!1})},l.getTotalEnergyCost=function(){return this.energyCostPerSpin*this.selectedMultiplier},l.canAffordSpin=function(t){return t>=this.getTotalEnergyCost()},l.startSpin=function(t){this.isSpinning||(this.setData("isSpinning",!0),this.setData("lastSpinResult",t),this.emit("spinStarted",t))},l.processSpinResult=function(t){var e={type:t.finalReward.type,amount:t.totalPayout*t.betMultiplier,multiplier:t.betMultiplier},n=i({},t,{finalReward:e});this.setData("lastSpinResult",n),this.setData("isSpinning",!1),this.emit("spinCompleted",n)},l.generateSpinResult=function(){for(var t,e=this.paytable,i=e.reduce((function(t,e){return t+e.weight}),0),a=Math.random()*i,s=null,l=n(e);!(t=l()).done;){var r=t.value;if((a-=r.weight)<=0){s=r;break}}s||(s=e[e.length-1]);for(var u=[[]],o=this.symbols,S=o.filter((function(t){return 0===t.priority})),p=[s.slot1,s.slot2,s.slot3],h=function(){var t=p[c];if("?"===t){var e=S[Math.floor(Math.random()*S.length)];t=e.type}var i=o.find((function(e){return e.type===t}));i&&u[0].push(i)},c=0;c<p.length;c++)h();return{reelResults:u,totalPayout:s.rewardAmount,betMultiplier:this.selectedMultiplier,finalReward:{type:s.rewardType,amount:s.rewardAmount}}},l.loadConfiguration=function(t){this.setData("reelCount",t.reelCount),this.setData("rowCount",t.rowCount),this.symbols=t.symbols,this.energyCostPerSpin=t.energyCostPerSpin,this.availableMultipliers=t.availableMultipliers,this.paytable=t.paytable,t.availableMultipliers.length>0&&(this.selectedMultiplier=t.availableMultipliers[0]),this.emit("configurationLoaded",t)},l.resetSpin=function(){this.setData("isSpinning",!1),this.setData("lastSpinResult",null),this.emit("spinReset")},l.getRewardDisplayText=function(t){switch(t.type){case r.GOLD:return t.amount+" Gold";case r.ENERGY:return t.amount+" Energy";case r.TOKEN:return t.amount+" Event Items";case r.ATTACK:return"Attack";case r.STEAL:return"Raid";case r.SHIELD:return"Shield";default:return"Unknown Reward"}},l.validate=function(){var t=this.symbols,e=this.paytable,i=this.energyCostPerSpin,a=this.availableMultipliers,s=this.selectedMultiplier;if(i<=0||!Array.isArray(t)||!Array.isArray(e)||!Array.isArray(a))return!1;if(0===t.length)return!1;for(var l,r=n(t);!(l=r()).done;){var u=l.value;if(void 0===u.id||!u.type)return!1}for(var o,S=n(e);!(o=S()).done;){var p=o.value;if(!p.payId||!p.slot1||!p.slot2||!p.slot3||p.weight<=0)return!1}return!(0===a.length||!a.includes(s))},l.toJSON=function(){return{reelCount:this.reelCount,rowCount:this.rowCount,symbols:this.symbols,energyCostPerSpin:this.energyCostPerSpin,availableMultipliers:this.availableMultipliers,selectedMultiplier:this.selectedMultiplier,isSpinning:this.isSpinning,lastSpinResult:this.lastSpinResult,paytable:this.paytable,autoSpinState:this.autoSpinState}},l.fromJSON=function(t){this.setData("reelCount",t.reelCount||this.DEFAULT_REEL_COUNT),this.setData("rowCount",t.rowCount||this.DEFAULT_ROW_COUNT),this.symbols=t.symbols||[],this.energyCostPerSpin=t.energyCostPerSpin||this.DEFAULT_ENERGY_COST,this.availableMultipliers=t.availableMultipliers||[].concat(this.DEFAULT_MULTIPLIERS),this.selectedMultiplier=t.selectedMultiplier||1,this.setData("isSpinning",t.isSpinning||!1),this.setData("lastSpinResult",t.lastSpinResult||null),this.paytable=t.paytable||[],this.autoSpinState=t.autoSpinState||null},l.startAutoSpin=function(){var t;null!=(t=this.autoSpinState)&&t.isActive||this.isSpinning||(this.autoSpinState={isActive:!0,isPending:!1},this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"STARTED"}))},l.stopAutoSpin=function(){var t;null!=(t=this.autoSpinState)&&t.isActive&&this.autoSpinState&&(this.autoSpinState.isActive=!1,this.autoSpinState.isPending=!1,this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"STOPPED_USER"}))},l.stopAutoSpinDueToInsufficientEnergy=function(){var t;null!=(t=this.autoSpinState)&&t.isActive&&this.autoSpinState&&(this.autoSpinState.isActive=!1,this.autoSpinState.isPending=!1,this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"STOPPED_NO_ENERGY"}))},l.canContinueAutoSpin=function(t){var e;return!(null==(e=this.autoSpinState)||!e.isActive)&&this.canAffordSpin(t)},l.queueAutoSpin=function(){this.autoSpinState||(this.autoSpinState={isActive:!1,isPending:!1}),this.autoSpinState.isActive||(this.autoSpinState.isPending=!0,this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"QUEUED"}))},l.activatePendingAutoSpin=function(){var t;return!(null==(t=this.autoSpinState)||!t.isPending)&&(!this.isSpinning&&(this.autoSpinState.isActive=!0,this.autoSpinState.isPending=!1,this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"STARTED"}),!0))},l.clearPendingAutoSpin=function(){var t;null!=(t=this.autoSpinState)&&t.isPending&&(this.autoSpinState.isPending=!1,this.emit("autoSpinStateChanged",{newState:this.autoSpinState,reason:"QUEUE_CLEARED"}))},a(s,[{key:"reelCount",get:function(){return this.getData("reelCount")||this.DEFAULT_REEL_COUNT}},{key:"rowCount",get:function(){return this.getData("rowCount")||this.DEFAULT_ROW_COUNT}},{key:"symbols",get:function(){return this.getData("symbols")||[]},set:function(t){this.setData("symbols",[].concat(t))}},{key:"energyCostPerSpin",get:function(){return this.getData("energyCostPerSpin")||this.DEFAULT_ENERGY_COST},set:function(t){this.setData("energyCostPerSpin",Math.max(1,t))}},{key:"availableMultipliers",get:function(){return this.getData("availableMultipliers")||[].concat(this.DEFAULT_MULTIPLIERS)},set:function(t){this.setData("availableMultipliers",[].concat(t))}},{key:"selectedMultiplier",get:function(){return this.getData("selectedMultiplier")||1},set:function(t){this.availableMultipliers.includes(t)&&this.setData("selectedMultiplier",t)}},{key:"isSpinning",get:function(){return this.getData("isSpinning")||!1}},{key:"lastSpinResult",get:function(){return this.getData("lastSpinResult")||null}},{key:"paytable",get:function(){return this.getData("paytable")||[]},set:function(t){this.setData("paytable",[].concat(t))}},{key:"autoSpinState",get:function(){return this.getData("autoSpinState")||null},set:function(t){this.setData("autoSpinState",t)}},{key:"isAutoSpinPending",get:function(){var t;return(null==(t=this.autoSpinState)?void 0:t.isPending)||!1}}]),s}(l));s._RF.pop()}}}));

System.register("chunks:///_virtual/SlotMachineUtils.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy}],execute:function(){o._RF.push({},"ab7baA9PCBP6rZYHjYdbVUm","SlotMachineUtils",void 0);e("SlotMachineUtils",function(){function e(){}return e.formatPayoutText=function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},e.formatPayoutSeperated=function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},e.validateConfiguration=function(e,o,n,r){var i=[];if(e&&0!==e.length)for(var a,l=t(e);!(a=l()).done;){var u=a.value;void 0!==u.id&&u.type||i.push("Invalid symbol: "+JSON.stringify(u))}else i.push("No symbols defined");if(o&&0!==o.length)for(var s,d=t(o);!(s=d()).done;){var c=s.value;c.payId&&c.slot1&&c.slot2&&c.slot3&&!(c.weight<=0)||i.push("Invalid paytable entry: "+c.payId)}else i.push("No paytable defined");return(n<=0||r<=0)&&i.push("Invalid reel or row count"),{isValid:0===i.length,errors:i}},e}());o._RF.pop()}}}));

System.register("chunks:///_virtual/StringUtils.ts",["cc"],(function(t){var r,n;return{setters:[function(t){r=t.cclegacy,n=t._decorator}],execute:function(){var e;r._RF.push({},"f4eb29pLYxA/5xwy6jF3nUT","StringUtils",void 0);var i=n.ccclass;n.property,t("StringUtils",i("StringUtils")(e=function(){function t(){}return t.formatNumberWithCommas=function(t){return t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},t.formatNumberWithDot=function(t){return t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")},t}())||e);r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});